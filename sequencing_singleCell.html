<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Lieven Clement and Koen Van den Berge" />


<title>Sequencing: Single Cell RNA-seq</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>


<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">SGA</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-chalkboard-teacher"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">---- INTRODUCTION ----</li>
    <li>
      <a href="intro.html">1.1 Position</a>
    </li>
    <li>
      <a href="recapGeneralLinearModel.html">1.2 Recap linear model</a>
    </li>
    <li class="dropdown-header">---- MODULE I PROTEOMICS ----</li>
    <li>
      <a href="docs/martens_proteomics_bioinformatics.pdf">1. Proteomics Bioinformatics</a>
    </li>
    <li>
      <a href="TargetDecoy.html">2.1 Identification - FDR - QC</a>
    </li>
    <li>
      <a href="pda_quantification_preprocessing.html">2.2.1. Quantification - Preprocessing</a>
    </li>
    <li>
      <a href="pda_robustSummarisation_peptideModels.html">2.2.2. Wrap-up Preprocessing - Peptide-Level-Models</a>
    </li>
    <li>
      <a href="pda_quantification_inference.html">2.3.1. Quantification - Differential Abundance Analysis</a>
    </li>
    <li>
      <a href="pda_blocking_wrapup.html">2.3.2. Wrap-up DA - Blocking</a>
    </li>
    <li>
      <a href="technicalDetailsProteomics.html">2.3.3 Technical Details</a>
    </li>
    <li class="dropdown-header">---- MODULE II RNA-seq ----</li>
    <li>
      <a href="sequencing_intro.html">1.  Introduction to RNA-seq</a>
    </li>
    <li>
      <a href="sequencing_countData.html">2.  Working with count data and GLMs</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-laptop"></span>
     
    tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">---- INTRODUCTION ----</li>
    <li>
      <a href="multipleRegression_KPNA2.html">1 Intro KPNA2</a>
    </li>
    <li class="dropdown-header">---- MODULE I PROTEOMICS ----</li>
    <li>
      <a href="https://www.compomics.com/bioinformatics-for-proteomics/">1. Bioinformatics for Proteomics</a>
    </li>
    <li>
      <a href="TargetDecoyTutorial.html">2.1. Target Decoy QC</a>
    </li>
    <li>
      <a href="pda_tutorialPreprocessing.html">2.2. Quantification - Preprocessing</a>
    </li>
    <li>
      <a href="pda_tutorialDesign.html">2.3. Quantification - Design</a>
    </li>
    <li class="dropdown-header">---- MODULE II RNA-seq ----</li>
    <li>
      <a href="sequencingTutorial1_mapping.html">1. Read mapping</a>
    </li>
    <li>
      <a href="sequencingTutorial2_DE.html">2. Working with Count Data</a>
    </li>
    <li>
      <a href="scRNA-seq-Tutorial.html">3. Single Cell RNA-seq Data Analysis</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Sequencing: Single Cell RNA-seq</h1>
<h4 class="author">Lieven Clement and Koen Van den Berge</h4>
<h4 class="date">Last edited on 16 September, 2024</h4>

</div>


<div id="introduction" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<div id="evolution-of-gene-expression-measurements"
class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Evolution of gene
expression measurements</h2>
<div class="figure">
<img src="sequencing_singleCell_files/figure-html/lar-1.png" alt="Image credit: @BoXia7" width="100%" />
<p class="caption">
Image credit: <span class="citation">@BoXia7</span>
</p>
</div>
<p><br/><br/></p>
</div>
<div id="exciting-applications" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Exciting
applications</h2>
<div class="figure">
<img src="images_sequencing/Applications-of-scRNA.png" alt="Hwang et al. 2018, doi: 10.1038/s12276-018-0071-8" width="100%" />
<p class="caption">
Hwang et al. 2018, doi: 10.1038/s12276-018-0071-8
</p>
</div>
<p><br/><br/></p>
</div>
<div id="bulk-vs-single-cell" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Bulk vs single
cell</h2>
<div id="protocol" class="section level3" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> Protocol</h3>
<div class="figure">
<img src="images_sequencing/owensSingleCell.png" alt="Owens, 2012, doi: 10.1038/491027a" width="100%" />
<p class="caption">
Owens, 2012, doi: 10.1038/491027a
</p>
</div>
<p><br/></p>
<ul>
<li><p>Bulk RNA-seq datasets are typically characterized by a high
sequencing depth, i.e., typically millions of reads are sequenced for
each individual sample. This is possible since there are often only a
limited number of samples being sequenced.</p></li>
<li><p>This is different for single-cell RNA-sequencing (scRNA-seq),
where many individual cells (thousands to millions) are sequenced. Due
to this high cell number, only a limited number of sequencing reads are
typically available for each individual cell.</p></li>
</ul>
<p>This difference in wetlab protocol will have a significant impact on
the statistical analysis of the data. The data analysis is affected by
the data-generating protocol, and one must carefully take this into
consideration.</p>
<p><br/><br/></p>
</div>
<div id="variability-in-data" class="section level3" number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> Variability in
data</h3>
<div class="figure">
<img src="images_sequencing/increaseVariabilityRisso.png" alt="Image credit: Davide Risso" width="100%" />
<p class="caption">
Image credit: Davide Risso
</p>
</div>
<p><br/><br/></p>
</div>
</div>
<div id="scrna-seq-protocols" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> scRNA-seq
Protocols</h2>
<div class="figure">
<img src="images_sequencing/scRNA-seqTechnologies.png" alt="Griffiths et al., 2018, doi.org/10.15252/msb.20178046" width="100%" />
<p class="caption">
Griffiths et al., 2018, doi.org/10.15252/msb.20178046
</p>
</div>
<p><br/><br/></p>
<div class="figure">
<img src="images_sequencing/umiVsFullLenghtRisso.png" alt="Image credit: Davide Risso" width="100%" />
<p class="caption">
Image credit: Davide Risso
</p>
</div>
<p><br/><br/></p>
<ul>
<li><p>Full-length protocols (typically plate-based). Here, a count has
a similar interpretation to bulk RNA-seq: the number of sequenced reads
that mapped back to that genomic locus. The count is a proxy for the
concentration of mRNA molecules in the cell.</p></li>
<li><p>UMI-based protocols (typically droplet-based). Here, one count
corresponds to one observed mRNA molecule present in the cell. Thanks to
the use of UMI barcodes, PCR artifacts are reduced. However, no full
length information on transcript because with fragmentation based
protocols only one fragment would have the UMI!</p></li>
</ul>
<p>Both protocols suffer from a low ‘capture frequency’, i.e., the
number of molecules present in the cell that have actually been captured
and may therefore be observed.</p>
<p><br/><br/></p>
</div>
<div id="multiplexing" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> Multiplexing</h2>
<div class="figure">
<img src="images_sequencing/kangMultiplexing.png" alt="Kang et al. 2018, doi: 10.1038/nbt.4042" width="100%" />
<p class="caption">
Kang et al. 2018, doi: 10.1038/nbt.4042
</p>
</div>
<p><br/><br/></p>
<p>Experimental Design!!!</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>eh <span class="ot">&lt;-</span> <span class="fu">ExperimentHub</span>()</span></code></pre></div>
<pre><code>## snapshotDate(): 2022-04-26</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>sce <span class="ot">&lt;-</span> eh[[<span class="st">&quot;EH2259&quot;</span>]]</span></code></pre></div>
<pre><code>## &#39;getOption(&quot;repos&quot;)&#39; replaces Bioconductor standard repositories, see
## &#39;?repositories&#39; for details
## 
## replacement repositories:
##     CRAN: https://cran.rstudio.com</code></pre>
<pre><code>## Bioconductor version 3.15 (BiocManager 1.30.18), R 4.2.3 (2023-03-15)</code></pre>
<pre><code>## Installing package(s) &#39;muscData&#39;</code></pre>
<pre><code>## Installation paths not writeable, unable to update packages
##   path: /opt/R/4.2.3/lib/R/library
##   packages:
##     class, KernSmooth, lattice, rpart, spatial</code></pre>
<pre><code>## Old packages: &#39;abind&#39;, &#39;askpass&#39;, &#39;backports&#39;, &#39;BH&#39;, &#39;BiocManager&#39;,
##   &#39;BiocParallel&#39;, &#39;Biostrings&#39;, &#39;bit&#39;, &#39;bitops&#39;, &#39;blob&#39;, &#39;bookdown&#39;, &#39;boot&#39;,
##   &#39;brio&#39;, &#39;broom&#39;, &#39;bslib&#39;, &#39;cachem&#39;, &#39;callr&#39;, &#39;car&#39;, &#39;cli&#39;, &#39;clue&#39;, &#39;cluster&#39;,
##   &#39;codetools&#39;, &#39;colorspace&#39;, &#39;commonmark&#39;, &#39;corrplot&#39;, &#39;cowplot&#39;, &#39;cpp11&#39;,
##   &#39;crayon&#39;, &#39;crosstalk&#39;, &#39;curl&#39;, &#39;data.table&#39;, &#39;DBI&#39;, &#39;dbplyr&#39;,
##   &#39;DelayedMatrixStats&#39;, &#39;deldir&#39;, &#39;desc&#39;, &#39;digest&#39;, &#39;dplyr&#39;, &#39;dqrng&#39;, &#39;DT&#39;,
##   &#39;dtplyr&#39;, &#39;ensembldb&#39;, &#39;evaluate&#39;, &#39;fansi&#39;, &#39;farver&#39;, &#39;fastmap&#39;, &#39;filelock&#39;,
##   &#39;fontawesome&#39;, &#39;forcats&#39;, &#39;foreign&#39;, &#39;formatR&#39;, &#39;fs&#39;, &#39;gargle&#39;, &#39;generics&#39;,
##   &#39;GenomeInfoDb&#39;, &#39;GenomicAlignments&#39;, &#39;GenomicFeatures&#39;, &#39;ggbeeswarm&#39;,
##   &#39;ggplot2&#39;, &#39;ggpubr&#39;, &#39;ggrepel&#39;, &#39;ggsci&#39;, &#39;ggsignif&#39;, &#39;glue&#39;, &#39;googledrive&#39;,
##   &#39;googlesheets4&#39;, &#39;gtable&#39;, &#39;haven&#39;, &#39;highr&#39;, &#39;hms&#39;, &#39;htmltools&#39;,
##   &#39;htmlwidgets&#39;, &#39;httpuv&#39;, &#39;httr&#39;, &#39;igraph&#39;, &#39;interp&#39;, &#39;IRanges&#39;, &#39;isoband&#39;,
##   &#39;jpeg&#39;, &#39;jsonlite&#39;, &#39;KEGGREST&#39;, &#39;knitr&#39;, &#39;labeling&#39;, &#39;later&#39;, &#39;lifecycle&#39;,
##   &#39;limma&#39;, &#39;lme4&#39;, &#39;locfit&#39;, &#39;lubridate&#39;, &#39;MatrixGenerics&#39;, &#39;MatrixModels&#39;,
##   &#39;matrixStats&#39;, &#39;mgcv&#39;, &#39;minqa&#39;, &#39;modelr&#39;, &#39;multcomp&#39;, &#39;munsell&#39;, &#39;mvtnorm&#39;,
##   &#39;ncdf4&#39;, &#39;nlme&#39;, &#39;nloptr&#39;, &#39;nnet&#39;, &#39;openssl&#39;, &#39;pbkrtest&#39;, &#39;pillar&#39;,
##   &#39;pkgload&#39;, &#39;plotly&#39;, &#39;plyr&#39;, &#39;png&#39;, &#39;prettyunits&#39;, &#39;printr&#39;, &#39;processx&#39;,
##   &#39;progress&#39;, &#39;promises&#39;, &#39;ps&#39;, &#39;purrr&#39;, &#39;quantreg&#39;, &#39;R.methodsS3&#39;, &#39;R.oo&#39;,
##   &#39;R.utils&#39;, &#39;Rcpp&#39;, &#39;RcppArmadillo&#39;, &#39;RcppEigen&#39;, &#39;RcppHNSW&#39;, &#39;RCurl&#39;,
##   &#39;readr&#39;, &#39;readxl&#39;, &#39;rematch&#39;, &#39;renv&#39;, &#39;reprex&#39;, &#39;restfulr&#39;, &#39;rintrojs&#39;,
##   &#39;rlang&#39;, &#39;rmarkdown&#39;, &#39;rprojroot&#39;, &#39;RSQLite&#39;, &#39;rstatix&#39;, &#39;rstudioapi&#39;,
##   &#39;rtracklayer&#39;, &#39;Rtsne&#39;, &#39;RUnit&#39;, &#39;rvest&#39;, &#39;sandwich&#39;, &#39;sass&#39;, &#39;ScaledMatrix&#39;,
##   &#39;scales&#39;, &#39;scuttle&#39;, &#39;shiny&#39;, &#39;SingleCellExperiment&#39;, &#39;sourcetools&#39;, &#39;sp&#39;,
##   &#39;SparseM&#39;, &#39;statmod&#39;, &#39;stringi&#39;, &#39;stringr&#39;, &#39;survival&#39;, &#39;sys&#39;, &#39;testthat&#39;,
##   &#39;TH.data&#39;, &#39;tibble&#39;, &#39;tidyr&#39;, &#39;tidyselect&#39;, &#39;tidyverse&#39;, &#39;tinytex&#39;, &#39;tzdb&#39;,
##   &#39;utf8&#39;, &#39;uuid&#39;, &#39;vctrs&#39;, &#39;vipor&#39;, &#39;viridis&#39;, &#39;viridisLite&#39;, &#39;vroom&#39;, &#39;waldo&#39;,
##   &#39;withr&#39;, &#39;xfun&#39;, &#39;xgboost&#39;, &#39;XML&#39;, &#39;xml2&#39;, &#39;yaml&#39;, &#39;zoo&#39;</code></pre>
<pre><code>## snapshotDate(): 2022-04-26</code></pre>
<pre><code>## see ?muscData and browseVignettes(&#39;muscData&#39;) for documentation</code></pre>
<pre><code>## downloading 1 resources</code></pre>
<pre><code>## retrieving 1 resource</code></pre>
<pre><code>## loading from cache</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>sce</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 35635 29065 
## metadata(0):
## assays(1): counts
## rownames(35635): MIR1302-10 FAM138A ... MT-ND6 MT-CYB
## rowData names(2): ENSEMBL SYMBOL
## colnames(29065): AAACATACAATGCC-1 AAACATACATTTCC-1 ... TTTGCATGGTTTGG-1
##   TTTGCATGTCTTAC-1
## colData names(5): ind stim cluster cell multiplets
## reducedDimNames(1): TSNE
## mainExpName: NULL
## altExpNames(0):</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce, <span class="at">dimred=</span><span class="st">&quot;TSNE&quot;</span>, <span class="at">colour_by=</span><span class="st">&quot;cell&quot;</span>)</span></code></pre></div>
<p><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce, <span class="at">dimred=</span><span class="st">&quot;TSNE&quot;</span>, <span class="at">colour_by=</span><span class="st">&quot;stim&quot;</span>)</span></code></pre></div>
<p><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
<p><br/></p>
<ul>
<li><p>Note, that we see huge effect of treatment. If we see such large
effects we always have to be on our guard!</p></li>
<li><p>Cells of 8 patients were not stimulated or stimulated.</p></li>
<li><p>Cells of different patients could be hashed.</p></li>
<li><p>So all control cells were sequenced in a first run and all
stimulated cells were on a second sequencing run.</p></li>
<li><p>So the large effect might be an effect of batch!</p></li>
</ul>
<p><br/><br/></p>
</div>
</div>
<div id="typical-workflow" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Typical Workflow</h1>
<p>See <a href="https://github.com/OSCA-source/OSCA">OSCA book</a></p>
<div class="figure">
<img src="images_sequencing/scRNA-data-workflow.png" alt="Image credit: OSCA book" width="100%" />
<p class="caption">
Image credit: OSCA book
</p>
</div>
<p><br/><br/></p>
<div id="preprocessing" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Preprocessing</h2>
<p>Additional challenges arise as compared to bulk RNA-seq.</p>
<ul>
<li><p>Cellular barcode identification: Errors occurring during PCR
amplification and sequencing can corrupt the cellular barcode
sequence.</p>
<ul>
<li><p>Alevin-fry only quantifies cells reliably assigned as non-empty
droplets by looking for the “knee” inflection point in the CDF of the
total number of UMIs for each droplet.</p></li>
<li><p>Once this list of barcodes is generated, reads with cellular
barcodes not in this set are “corrected” against it by checking if they
are within one edit of the set.</p></li>
</ul></li>
<li><p>Cell demultiplexing:</p>
<ul>
<li>Cell Hashing: Cellular barcode identification from HTO counts.</li>
<li>Biological variation: Model-based clustering of cells to
individuals.</li>
</ul></li>
<li><p>Processing thousands-millions of cells</p></li>
<li><p>UMI identification and collapsing:</p>
<ul>
<li>Determine the set of genes corresponding to all reads of a
particular UMI.</li>
<li>Often, a UMI count is assigned to the gene with highest frequency
amongst all reads having that UMI. Also here, UMI barcodes may become
corrupted.</li>
</ul></li>
</ul>
<p><br/><br/></p>
</div>
<div id="single-cell-experiment-class" class="section level2"
number="2.2">
<h2><span class="header-section-number">2.2</span> Single cell
experiment class</h2>
<div class="figure">
<img src="images_sequencing/SingleCellExperiment.png" alt="Image credit: OSCA book" width="100%" />
<p class="caption">
Image credit: OSCA book
</p>
</div>
<p><br/><br/></p>
<p>Why use a SingleCellExperiment object?</p>
<ul>
<li>Convenient framework to store all essential (meta)data in one
object.</li>
<li>All different (meta)data structures are linked: avoids confusion on
whether, e.g., the cluster labels and the count matrix are identically
sorted.</li>
<li>Filtering of genes or cells immediately also filters the
corresponding metadata.</li>
<li>Most Bioconductor software accepts a SingleCellExperiment object as
input, and outputs a SingleCellExperiment object $ rightarrow$ one
common infrastructure across entire analysis workflow.</li>
<li>Please see the <a
href="http://bioconductor.org/books/3.14/OSCA.intro/the-singlecellexperiment-class.html">OSCA
chapter on SingleCellExperiment class</a> for more information and how
to use it (please try and get familiar!).</li>
</ul>
<p><br/><br/></p>
<div id="example" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Example</h3>
<p>We illustrate these steps using a dataset on Peripheral Blood
Mononuclear Cell (PBMC) data from a healthy donor provided by 10X
Genomics. We use the DropletTestFiles Bioconductor package to download
the raw (i.e., unfiltered) count matrix that contains the UMI counts of
all genes in all droplets.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>raw.path <span class="ot">&lt;-</span> <span class="fu">getTestFile</span>(<span class="st">&quot;tenx-2.1.0-pbmc4k/1.0.0/raw.tar.gz&quot;</span>)</span></code></pre></div>
<pre><code>## snapshotDate(): 2022-04-26</code></pre>
<pre><code>## see ?DropletTestFiles and browseVignettes(&#39;DropletTestFiles&#39;) for documentation</code></pre>
<pre><code>## downloading 1 resources</code></pre>
<pre><code>## retrieving 1 resource</code></pre>
<pre><code>## loading from cache</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>out.path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;pbmc4k&quot;</span>)</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="fu">untar</span>(raw.path, <span class="at">exdir=</span>out.path)</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(out.path, <span class="st">&quot;raw_gene_bc_matrices/GRCh38&quot;</span>)</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>sce <span class="ot">&lt;-</span> <span class="fu">read10xCounts</span>(fname, <span class="at">col.names=</span><span class="cn">TRUE</span>)</span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>sce</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 33694 737280 
## metadata(1): Samples
## assays(1): counts
## rownames(33694): ENSG00000243485 ENSG00000237613 ... ENSG00000277475
##   ENSG00000268674
## rowData names(2): ID Symbol
## colnames(737280): AAACCTGAGAAACCAT-1 AAACCTGAGAAACCGC-1 ...
##   TTTGTCATCTTTAGTC-1 TTTGTCATCTTTCCTC-1
## colData names(2): Sample Barcode
## reducedDimNames(0):
## mainExpName: NULL
## altExpNames(0):</code></pre>
<p>The read10xCounts function starts from the output of the Cell Ranger
software and imports the data into R as an object of class
SingleCellExperiment.</p>
<p>We can notice that the dimension of the matrix is very big; in fact
this matrix includes the UMI that have been detected in all the droplets
that have been sequenced, including the empty droplets that may contain
only ambient RNA.</p>
<p>This is a very sparse matrix, with a large fraction of zeros;
read10xCounts is aware of this and stores the counts as a sparse matrix,
which has a very small memory footprint.</p>
<p><br/><br/></p>
</div>
<div id="explore-singlecellexperiment-object" class="section level3"
number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Explore
SingleCellExperiment object</h3>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>sce <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>  counts <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">6</span>))</span></code></pre></div>
<pre><code>## 6 x 6 sparse Matrix of class &quot;dgCMatrix&quot;
##                 AAACCTGAGAAACCAT-1 AAACCTGAGAAACCGC-1 AAACCTGAGAAACCTA-1
## ENSG00000243485                  .                  .                  .
## ENSG00000237613                  .                  .                  .
## ENSG00000186092                  .                  .                  .
## ENSG00000238009                  .                  .                  .
## ENSG00000239945                  .                  .                  .
## ENSG00000239906                  .                  .                  .
##                 AAACCTGAGAAACGAG-1 AAACCTGAGAAACGCC-1 AAACCTGAGAAAGTGG-1
## ENSG00000243485                  .                  .                  .
## ENSG00000237613                  .                  .                  .
## ENSG00000186092                  .                  .                  .
## ENSG00000238009                  .                  .                  .
## ENSG00000239945                  .                  .                  .
## ENSG00000239906                  .                  .                  .</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>sce <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>  counts <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>  class</span></code></pre></div>
<pre><code>## [1] &quot;dgCMatrix&quot;
## attr(,&quot;package&quot;)
## [1] &quot;Matrix&quot;</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>sce <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>  assays</span></code></pre></div>
<pre><code>## List of length 1
## names(1): counts</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>sce <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>  rowData <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>  head</span></code></pre></div>
<pre><code>## DataFrame with 6 rows and 2 columns
##                              ID        Symbol
##                     &lt;character&gt;   &lt;character&gt;
## ENSG00000243485 ENSG00000243485  RP11-34P13.3
## ENSG00000237613 ENSG00000237613       FAM138A
## ENSG00000186092 ENSG00000186092         OR4F5
## ENSG00000238009 ENSG00000238009  RP11-34P13.7
## ENSG00000239945 ENSG00000239945  RP11-34P13.8
## ENSG00000239906 ENSG00000239906 RP11-34P13.14</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>sce <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>  colData <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>  head</span></code></pre></div>
<pre><code>## DataFrame with 6 rows and 2 columns
##                                    Sample            Barcode
##                               &lt;character&gt;        &lt;character&gt;
## AAACCTGAGAAACCAT-1 /tmp/RtmpnZH8nv/pbmc.. AAACCTGAGAAACCAT-1
## AAACCTGAGAAACCGC-1 /tmp/RtmpnZH8nv/pbmc.. AAACCTGAGAAACCGC-1
## AAACCTGAGAAACCTA-1 /tmp/RtmpnZH8nv/pbmc.. AAACCTGAGAAACCTA-1
## AAACCTGAGAAACGAG-1 /tmp/RtmpnZH8nv/pbmc.. AAACCTGAGAAACGAG-1
## AAACCTGAGAAACGCC-1 /tmp/RtmpnZH8nv/pbmc.. AAACCTGAGAAACGCC-1
## AAACCTGAGAAAGTGG-1 /tmp/RtmpnZH8nv/pbmc.. AAACCTGAGAAAGTGG-1</code></pre>
<p><br/><br/></p>
</div>
<div id="use-sensible-gene-names" class="section level3" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Use sensible gene
names</h3>
<p>Before starting the analysis, it may be a good idea to store the
names of the genes in a more human-friendly ID system. We can also
include information on the chromosome location of the genes; this will
be useful for e.g. identifying mitochondrial genes.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="fu">library</span>(scuttle)</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a><span class="fu">rownames</span>(sce) <span class="ot">&lt;-</span> <span class="fu">uniquifyFeatureNames</span>(</span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>    <span class="fu">rowData</span>(sce)<span class="sc">$</span>ID, <span class="fu">rowData</span>(sce)<span class="sc">$</span>Symbol)</span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a><span class="fu">rowData</span>(sce)<span class="sc">$</span>location <span class="ot">&lt;-</span> <span class="fu">mapIds</span>(EnsDb.Hsapiens.v86,</span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a>                                     <span class="at">keys=</span><span class="fu">rowData</span>(sce)<span class="sc">$</span>ID, </span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a>                                     <span class="at">column=</span><span class="st">&quot;SEQNAME&quot;</span>, <span class="at">keytype=</span><span class="st">&quot;GENEID&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Unable to map 144 of 33694 requested IDs.</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="fu">rowData</span>(sce)<span class="sc">$</span>location[<span class="fu">is.na</span>(<span class="fu">rowData</span>(sce)<span class="sc">$</span>location)] <span class="ot">&lt;-</span> <span class="st">&quot;NA&quot;</span></span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a><span class="fu">rowData</span>(sce)</span></code></pre></div>
<pre><code>## DataFrame with 33694 rows and 3 columns
##                           ID       Symbol    location
##                  &lt;character&gt;  &lt;character&gt; &lt;character&gt;
## RP11-34P13.3 ENSG00000243485 RP11-34P13.3           1
## FAM138A      ENSG00000237613      FAM138A           1
## OR4F5        ENSG00000186092        OR4F5           1
## RP11-34P13.7 ENSG00000238009 RP11-34P13.7           1
## RP11-34P13.8 ENSG00000239945 RP11-34P13.8           1
## ...                      ...          ...         ...
## AC233755.2   ENSG00000277856   AC233755.2  KI270726.1
## AC233755.1   ENSG00000275063   AC233755.1  KI270726.1
## AC240274.1   ENSG00000271254   AC240274.1  KI270711.1
## AC213203.1   ENSG00000277475   AC213203.1  KI270713.1
## FAM231B      ENSG00000268674      FAM231B  KI270713.1</code></pre>
<p><br/><br/></p>
</div>
</div>
<div id="filter-non-informative-genes" class="section level2"
number="2.3">
<h2><span class="header-section-number">2.3</span> Filter
non-informative genes</h2>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">assays</span>(sce)<span class="sc">$</span>counts <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">&gt;</span> <span class="dv">10</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a><span class="fu">table</span>(keep)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">FALSE</th>
<th align="right">TRUE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">19706</td>
<td align="right">13988</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a>sce <span class="ot">&lt;-</span> sce[keep,]</span></code></pre></div>
<p><br/><br/></p>
</div>
<div id="detection-and-removal-of-empty-droplets" class="section level2"
number="2.4">
<h2><span class="header-section-number">2.4</span> Detection and removal
of empty droplets</h2>
<p>The first step is the identification of droplets that do not contain
any live cell.</p>
<p>The reason why these droplets contain some RNA is that there may be
some ambient RNA due to some cell leaking or they may contain dead or
dying cells.</p>
<p><br/><br/></p>
<div id="example-1" class="section level3" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Example</h3>
<p>The barcodeRanks function can be used to rank the barcodes by number
of UMIs and to estimate the knee and inflection point of the
distribution.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>bcrank <span class="ot">&lt;-</span> <span class="fu">barcodeRanks</span>(<span class="fu">counts</span>(sce))</span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a><span class="co"># Only showing unique points for plotting speed.</span></span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>uniq <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">duplicated</span>(bcrank<span class="sc">$</span>rank)</span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a><span class="fu">plot</span>(bcrank<span class="sc">$</span>rank[uniq], bcrank<span class="sc">$</span>total[uniq], <span class="at">log=</span><span class="st">&quot;xy&quot;</span>,</span>
<span id="cb42-6"><a href="#cb42-6" tabindex="-1"></a>    <span class="at">xlab=</span><span class="st">&quot;Rank&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Total UMI count&quot;</span>, <span class="at">cex.lab=</span><span class="fl">1.2</span>)</span></code></pre></div>
<pre><code>## Warning in xy.coords(x, y, xlabel, ylabel, log): 1 y value &lt;= 0 omitted from
## logarithmic plot</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">metadata</span>(bcrank)<span class="sc">$</span>inflection, <span class="at">col=</span><span class="st">&quot;darkgreen&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">metadata</span>(bcrank)<span class="sc">$</span>knee, <span class="at">col=</span><span class="st">&quot;dodgerblue&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Inflection&quot;</span>, <span class="st">&quot;Knee&quot;</span>), </span>
<span id="cb44-5"><a href="#cb44-5" tabindex="-1"></a>        <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;darkgreen&quot;</span>, <span class="st">&quot;dodgerblue&quot;</span>), <span class="at">lty=</span><span class="dv">2</span>, <span class="at">cex=</span><span class="fl">1.2</span>)</span></code></pre></div>
<p><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p><br/></p>
<ul>
<li><p>There is a sharp distinction between droplets with very high
counts, very likely to contain a live cell, and droplets with very low
counts, very likely to be empty.</p></li>
<li><p>However, it is not straightforward to classify the droplets in
the middle of the distribution.</p></li>
<li><p>We can apply a statistical test of hypothesis to decide, for each
droplet, if its RNA profile is significantly different from the profile
of ambient RNA, estimated from the very low counts (Aaron TL Lun et
al. 2019).</p></li>
<li><p>We use a very low threshold on the False Discovery Rate to have
very few false positive cells.</p></li>
</ul>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>e.out <span class="ot">&lt;-</span> <span class="fu">emptyDrops</span>(<span class="fu">counts</span>(sce))</span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a><span class="fu">summary</span>(e.out<span class="sc">$</span>FDR <span class="sc">&lt;=</span> <span class="fl">0.001</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Mode</th>
<th align="left">FALSE</th>
<th align="left">TRUE</th>
<th align="left">NA’s</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">logical</td>
<td align="left">988</td>
<td align="left">4300</td>
<td align="left">731992</td>
</tr>
</tbody>
</table>
<p><br/><br/></p>
<p>The large majority of droplets are not tested, since by default all
droplets with fewer than 100 UMIs are considered empty.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">colSums</span>(<span class="fu">counts</span>(sce))<span class="sc">&gt;</span><span class="dv">100</span>, e.out<span class="sc">$</span>FDR<span class="sc">&lt;=</span><span class="fl">0.001</span>, <span class="at">useNA =</span> <span class="st">&quot;ifany&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">/</th>
<th align="right">FALSE</th>
<th align="right">TRUE</th>
<th align="right">NA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">731992</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="right">988</td>
<td align="right">4300</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><br/><br/></p>
<p>We can now proceed by removing the empty droplets and keep only the
ones identified to be cells.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a>sce <span class="ot">&lt;-</span> sce[,<span class="fu">which</span>(e.out<span class="sc">$</span>FDR <span class="sc">&lt;=</span> <span class="fl">0.001</span>)]</span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a>sce</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 13988 4300 
## metadata(1): Samples
## assays(1): counts
## rownames(13988): FO538757.2 AP006222.2 ... AC004556.1 AC240274.1
## rowData names(3): ID Symbol location
## colnames(4300): AAACCTGAGAAGGCCT-1 AAACCTGAGACAGACC-1 ...
##   TTTGTCAGTTAAGACA-1 TTTGTCATCCCAAGAT-1
## colData names(2): Sample Barcode
## reducedDimNames(0):
## mainExpName: NULL
## altExpNames(0):</code></pre>
<p><br/><br/></p>
</div>
</div>
<div id="quality-control" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Quality control</h2>
<p>Some cells have poor quality (e.g., damaged or stressed cells).</p>
<ul>
<li>Expression of mitochondrial genes, total number of genes expressed,
read distribution across genes and library size are good indicators for
a cell’s quality.</li>
</ul>
<p><br/><br/></p>
<div id="concerns" class="section level3" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Concerns</h3>
<p>One concern is that we would inadvertently remove, e.g., an entire
cell type from the downstream analysis. QC variables may not be
independent of biological state. There is a trade-off between only
working with high-quality cells and risk of removing biological
signal.</p>
<p><br/></p>
</div>
<div id="criteria" class="section level3" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> Criteria</h3>
<ul>
<li><p>A high-quality cell should have</p>
<ul>
<li>A high number of genes expressed</li>
<li>A fair library size</li>
<li>No major expression of mitochondrial genes, relative to other
genes</li>
</ul></li>
<li><p>Based on this information, we could set a fixed threshold, e.g.,
“keep cells with 4000 genes expressed, a library size of at least 10000
and fewer than 5% of the total output coming from mitochondrial
genes”.</p>
<ul>
<li>Requires substantial experience with the biological system and
scRNA-seq data, e.g., tumors typically express a relatively higher
amount of mitochondrial genes.</li>
</ul></li>
<li><p>A better approach is to use an adaptive threshold.</p>
<ul>
<li>Again assumes most cells are high-quality cells <span
class="math inline">\(\rightarrow\)</span> identification of outliers
allows identification of low-quality cells.</li>
<li>For example, for removing low library size cells in the OSCA book
they use</li>
</ul></li>
</ul>
<p><span class="math display">\[I(N_i &lt; median(\mathbf{N})-3 \times
MAD(\mathbf{N}))\]</span> with <span class="math inline">\(N_i\)</span>
the library size of cell i and <span
class="math inline">\(\mathbf{N}=[N_1,\ldots,N_m]\)</span> with <span
class="math inline">\(m\)</span> the number of cells.</p>
<p><br/><br/></p>
</div>
<div id="example-2" class="section level3" number="2.5.3">
<h3><span class="header-section-number">2.5.3</span> Example</h3>
<p>The <code>perCellQCMetrics</code> function can be used to compute a
set of metrics useful to evaluate the quality of the samples. The
<code>isOutlier</code> function uses a data driven threshold to define
cells of lower quality compared to the rest of the dataset.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a>stats <span class="ot">&lt;-</span> <span class="fu">perCellQCMetrics</span>(sce,</span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a>            <span class="at">subsets=</span><span class="fu">list</span>(<span class="at">Mito=</span><span class="fu">which</span>(<span class="fu">rowData</span>(sce)<span class="sc">$</span>location<span class="sc">==</span><span class="st">&quot;MT&quot;</span>)))</span></code></pre></div>
<p>High-quality cells should have many features expressed, and a low
contribution of mitochondrial genes. Here, we see that several cells
have a very low number of expressed genes, and where most of the
molecules are derived from mitochondrial genes. This indicates likely
damaged cells, presumably because of loss of cytoplasmic RNA from
perforated cells, so they have to be removed for the downstream
analysis.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="fu">colData</span>(sce) <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">colData</span>(sce), stats)</span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a><span class="fu">plotColData</span>(sce, <span class="at">x =</span> <span class="st">&quot;sum&quot;</span>, <span class="at">y=</span><span class="st">&quot;detected&quot;</span>)</span></code></pre></div>
<p><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="fu">plotColData</span>(sce, <span class="at">x =</span> <span class="st">&quot;detected&quot;</span>, <span class="at">y=</span><span class="st">&quot;subsets_Mito_percent&quot;</span>)</span></code></pre></div>
<p><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-15-2.png" width="672" /></p>
<p><br/></p>
<p>We normally remove cells that are outlying with respect to</p>
<ol style="list-style-type: decimal">
<li>A low sequencing depth (number of UMIs);</li>
<li>A low number of genes detected;</li>
<li>A high percentage of reads from mitochondrial genes.</li>
</ol>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a>lowFeatures <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(stats<span class="sc">$</span>detected, <span class="at">type=</span><span class="st">&quot;lower&quot;</span>, <span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a>lowLib <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(stats<span class="sc">$</span>sum, <span class="at">type=</span><span class="st">&quot;lower&quot;</span>, <span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a>highMito <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(stats<span class="sc">$</span>subsets_Mito_percent, <span class="at">type=</span><span class="st">&quot;higher&quot;</span>)</span>
<span id="cb52-4"><a href="#cb52-4" tabindex="-1"></a><span class="fu">table</span>(lowFeatures)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">FALSE</th>
<th align="right">TRUE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">4006</td>
<td align="right">294</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="fu">table</span>(lowLib)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">FALSE</th>
<th align="right">TRUE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">3973</td>
<td align="right">327</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a><span class="fu">table</span>(highMito)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">FALSE</th>
<th align="right">TRUE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">3990</td>
<td align="right">310</td>
</tr>
</tbody>
</table>
<p><br/><br/></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a>discardCells <span class="ot">&lt;-</span> (lowLib<span class="sc">|</span>lowFeatures<span class="sc">|</span>highMito)</span>
<span id="cb55-2"><a href="#cb55-2" tabindex="-1"></a><span class="fu">table</span>(discardCells)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">FALSE</th>
<th align="right">TRUE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">3864</td>
<td align="right">436</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a><span class="fu">colData</span>(sce)<span class="sc">$</span>discardCells <span class="ot">&lt;-</span> discardCells</span></code></pre></div>
<p><br/><br/></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a>scater<span class="sc">::</span><span class="fu">plotColData</span>(sce, <span class="at">y=</span><span class="st">&quot;subsets_Mito_percent&quot;</span>,</span>
<span id="cb57-2"><a href="#cb57-2" tabindex="-1"></a>        <span class="at">colour_by=</span><span class="st">&quot;discardCells&quot;</span>)</span></code></pre></div>
<p><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a>scater<span class="sc">::</span><span class="fu">plotColData</span>(sce, <span class="at">y=</span><span class="st">&quot;detected&quot;</span>,</span>
<span id="cb58-2"><a href="#cb58-2" tabindex="-1"></a>        <span class="at">colour_by=</span><span class="st">&quot;discardCells&quot;</span>)</span></code></pre></div>
<p><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-18-2.png" width="672" /></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a>scater<span class="sc">::</span><span class="fu">plotColData</span>(sce, <span class="at">y=</span><span class="st">&quot;sum&quot;</span>,</span>
<span id="cb59-2"><a href="#cb59-2" tabindex="-1"></a>        <span class="at">colour_by=</span><span class="st">&quot;discardCells&quot;</span>)</span></code></pre></div>
<p><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-18-3.png" width="672" /></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a><span class="fu">plotColData</span>(sce, <span class="at">x =</span> <span class="st">&quot;detected&quot;</span>, <span class="at">y=</span><span class="st">&quot;subsets_Mito_percent&quot;</span>, <span class="at">colour_by =</span> <span class="st">&quot;discardCells&quot;</span>)</span></code></pre></div>
<p><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-18-4.png" width="672" /></p>
<p><br/><br/></p>
</div>
</div>
<div id="detection-and-removal-of-doublets" class="section level2"
number="2.6">
<h2><span class="header-section-number">2.6</span> Detection and removal
of doublets</h2>
<p>Not all droplets contain a single cell; some contain &gt;1 cell.</p>
<p>Doublet cell clusters may be mistaken for intermediate/transitory
states.</p>
<p><br/><br/></p>
<div id="methods" class="section level3" number="2.6.1">
<h3><span class="header-section-number">2.6.1</span> Methods</h3>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;./images_sequencing/scDblFinder.png&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="images_sequencing/scDblFinder.png" alt="Germain et al. 2021, doi: 10.12688/f1000research.73600.2" width="100%" />
<p class="caption">
Germain et al. 2021, doi: 10.12688/f1000research.73600.2
</p>
</div>
<p><br/><br/></p>
<ol style="list-style-type: decimal">
<li>PCA on log-normalized expression counts.</li>
<li>Randomly select two cells, sum their counts and normalize, and
project into PCA space.</li>
<li>Repeat step 2 many times.</li>
<li>For each cell, check its neighborhood to simulated doublets as
compared to original cells.</li>
<li>Use this information, along with other predictors, to train a
classifier for doublets.</li>
</ol>
<p><br/><br/></p>
</div>
<div id="concerns-1" class="section level3" number="2.6.2">
<h3><span class="header-section-number">2.6.2</span> Concerns</h3>
<p>A potential concern is that we would inadvertently remove biological
single cells, that may have e.g. a low transcriptome complexity. There
is a trade-off between only working with high-quality cells and risk of
removing biological signal.</p>
<p><br/></p>
</div>
<div id="example-3" class="section level3" number="2.6.3">
<h3><span class="header-section-number">2.6.3</span> Example</h3>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a>dbl.dens <span class="ot">&lt;-</span> <span class="fu">computeDoubletDensity</span>(sce)</span>
<span id="cb62-2"><a href="#cb62-2" tabindex="-1"></a>sce<span class="sc">$</span>DoubletScore <span class="ot">&lt;-</span> dbl.dens</span>
<span id="cb62-3"><a href="#cb62-3" tabindex="-1"></a><span class="fu">summary</span>(dbl.dens)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Min.</th>
<th align="right">1st Qu.</th>
<th align="right">Median</th>
<th align="right">Mean</th>
<th align="right">3rd Qu.</th>
<th align="right">Max.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">0.1548</td>
<td align="right">0.3182</td>
<td align="right">0.692634</td>
<td align="right">0.7052</td>
<td align="right">20.124</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a>dbl.calls <span class="ot">&lt;-</span> <span class="fu">doubletThresholding</span>(<span class="fu">data.frame</span>(<span class="at">score=</span>dbl.dens),</span>
<span id="cb63-2"><a href="#cb63-2" tabindex="-1"></a>    <span class="at">method=</span><span class="st">&quot;griffiths&quot;</span>, <span class="at">returnType=</span><span class="st">&quot;call&quot;</span>)</span>
<span id="cb63-3"><a href="#cb63-3" tabindex="-1"></a><span class="fu">summary</span>(dbl.calls)</span></code></pre></div>
<pre><code>## singlet doublet 
##    3651     649</code></pre>
<p><br/><br/></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a>sce <span class="ot">&lt;-</span> sce[, dbl.calls <span class="sc">==</span> <span class="st">&quot;singlet&quot;</span>]</span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a>sce</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 13988 3651 
## metadata(1): Samples
## assays(1): counts
## rownames(13988): FO538757.2 AP006222.2 ... AC004556.1 AC240274.1
## rowData names(3): ID Symbol location
## colnames(3651): AAACCTGAGAAGGCCT-1 AAACCTGAGACAGACC-1 ...
##   TTTGTCAGTTAAGACA-1 TTTGTCATCCCAAGAT-1
## colData names(10): Sample Barcode ... discardCells DoubletScore
## reducedDimNames(0):
## mainExpName: NULL
## altExpNames(0):</code></pre>
<p><br/><br/></p>
<p>Note that, similarly to what we have said for the removal of
low-quality cells, one should be careful in removing putative doublets.
Indeed, it may be difficult to distinguish between rare transient cell
populations and doublet cells.</p>
<p><br/><br/></p>
</div>
</div>
<div id="normalisation" class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> Normalisation</h2>
<p>Normalization aims to remove technical effects such as sequencing
depth so that comparisons between cells are not confounded by them.</p>
<p>As in bulk RNA-seq, the most commonly used methods are scaling
normalizations, where a scaling factor (also called size factor,
normalization factor) is estimated for each cell.</p>
<p><br/></p>
<div id="concerns-2" class="section level3" number="2.7.1">
<h3><span class="header-section-number">2.7.1</span> Concerns</h3>
<ul>
<li><p>Some cell types may naturally have fewer mRNA molecules and
therefore a lower library size. Removal of sequencing depth effects
across cells therefore also risks removing some biological
signal.</p></li>
<li><p>The assumption of a cell-specific scaling factor is that any
technical effect it supposedly accounts for, affects all genes equally
through a scaling of the mean count. This is not necessarily
realistic.</p></li>
<li><p>Scaling the data and log-transforming the data is not a good
option. Use offsets!</p></li>
</ul>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;./images_sequencing/glmPCAFig2.png&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="images_sequencing/glmPCAFig2.png" alt="Townes et al. 2019, DOI: 10.1186/s13059-019-1861-6" width="100%" />
<p class="caption">
Townes et al. 2019, DOI: 10.1186/s13059-019-1861-6
</p>
</div>
<p><br/><br/></p>
</div>
<div id="offsets" class="section level3" number="2.7.2">
<h3><span class="header-section-number">2.7.2</span> Offsets</h3>
<p>Let <span class="math inline">\(y_{gi}\)</span> be the expression for
gene <span class="math inline">\(g\)</span> in cell <span
class="math inline">\(i\)</span>. Assume, as in bulk RNA-seq that</p>
<p><span class="math inline">\(E[y_{gi}] = \mu_{gi} =  \pi_{gi}
s_iN_i\)</span></p>
<p>In the edgeR model, <span class="math inline">\(s_iN_i\)</span> is
referred to as the ‘effective library size’, which is used as offset in
the GLM, thereby effectively focussing the statistical inference on
<span class="math inline">\(\pi_{gi}\)</span>.</p>
<div class="figure">
<img src="images_sequencing/lunNormalisation.png" alt="Lun et al. 2016, DOI: 10.1186/s13059-016-0947-7" width="100%" />
<p class="caption">
Lun et al. 2016, DOI: 10.1186/s13059-016-0947-7
</p>
</div>
<p><br/></p>
<ul>
<li>TMM and DESeq2 normalisation are largely driven by a few genes
without zero counts!</li>
</ul>
<p>Popular, bespoke single-cell normalization methods attempt to
alleviate these issues.</p>
<div class="figure">
<img src="images_sequencing/lunNormalisation2.png" alt="Lun et al. 2016, DOI: 10.1186/s13059-016-0947-7" width="100%" />
<p class="caption">
Lun et al. 2016, DOI: 10.1186/s13059-016-0947-7
</p>
</div>
<p><br/><br/></p>
</div>
<div id="example-4" class="section level3" number="2.7.3">
<h3><span class="header-section-number">2.7.3</span> Example</h3>
<p>Here, we use the scran method to normalize the data for differences
in sequencing depth. This approach is based on the deconvolution of size
factors estimated from pools of cells (Lun et all. 2016).</p>
<p>Since we have a heterogeneous cell population, we perform a quick
clustering to make sure that we pool together cells that are not too
different from each other.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a><span class="fu">library</span>(scran)</span>
<span id="cb68-2"><a href="#cb68-2" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">quickCluster</span>(sce)</span>
<span id="cb68-3"><a href="#cb68-3" tabindex="-1"></a><span class="fu">table</span>(cl)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">1</th>
<th align="right">2</th>
<th align="right">3</th>
<th align="right">4</th>
<th align="right">5</th>
<th align="right">6</th>
<th align="right">7</th>
<th align="right">8</th>
<th align="right">9</th>
<th align="right">10</th>
<th align="right">11</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">204</td>
<td align="right">203</td>
<td align="right">364</td>
<td align="right">262</td>
<td align="right">547</td>
<td align="right">999</td>
<td align="right">190</td>
<td align="right">233</td>
<td align="right">399</td>
<td align="right">124</td>
<td align="right">126</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a>sce <span class="ot">&lt;-</span> <span class="fu">computeSumFactors</span>(sce, <span class="at">clusters =</span> cl)</span></code></pre></div>
<pre><code>## Warning in (function (x, sizes, min.mean = NULL, positive = FALSE, scaling =
## NULL) : encountered non-positive size factor estimates</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">sizeFactors</span>(sce))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Min.</th>
<th align="right">1st Qu.</th>
<th align="right">Median</th>
<th align="right">Mean</th>
<th align="right">3rd Qu.</th>
<th align="right">Max.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0027868</td>
<td align="right">0.7399026</td>
<td align="right">0.9211244</td>
<td align="right">1</td>
<td align="right">1.148053</td>
<td align="right">5.538119</td>
</tr>
</tbody>
</table>
<p><br/></p>
<p>We can check that the estimated library sizes are not too far from
the library size factors, estimated from the total number of counts.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">librarySizeFactors</span>(sce), <span class="fu">sizeFactors</span>(sce), <span class="at">xlab=</span><span class="st">&quot;Library size factor&quot;</span>,</span>
<span id="cb72-2"><a href="#cb72-2" tabindex="-1"></a>    <span class="at">ylab=</span><span class="st">&quot;Deconvolution size factor&quot;</span>, <span class="at">log=</span><span class="st">&#39;xy&#39;</span>, <span class="at">pch=</span><span class="dv">16</span>,</span>
<span id="cb72-3"><a href="#cb72-3" tabindex="-1"></a>    <span class="at">col=</span><span class="fu">as.integer</span>(<span class="fu">factor</span>(cl)))</span>
<span id="cb72-4"><a href="#cb72-4" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p><br/><br/></p>
</div>
</div>
<div id="feature-selection" class="section level2" number="2.8">
<h2><span class="header-section-number">2.8</span> Feature
selection</h2>
<ul>
<li><p>The curse of dimension: In high-dimensional data, all data points
appear to be dissimilar (i.e., they are far apart), as the data become
sparse in the high-dimensional space as dimensions increase (e.g.,
Euclidean distance).</p></li>
<li><p>What does this mean for scRNA-seq? Trying to recover the global
structure of a dataset using all genes is not a good idea. Often, we
perform a variable selection step, selecting genes which we believe to
be highly informative for a dataset’s structure. One may view this as a
first simple step of dimension reduction.</p></li>
</ul>
<p>We will thus select genes which we hope are informative for
recovering the biological structure. Prior to visualisation.</p>
<p><br/></p>
<div id="concerns-3" class="section level3" number="2.8.1">
<h3><span class="header-section-number">2.8.1</span> Concerns</h3>
<p>Feature selection is crucial for dimension reduction. However, it
remains subjective and there are no clear guidelines to follow. The
amount of features to select depends on the complexity of your dataset,
and the informativeness of each individual feature.</p>
<p>Many issues remain.</p>
<p><br/><br/></p>
</div>
<div id="what-defines-an-informative-gene" class="section level3"
number="2.8.2">
<h3><span class="header-section-number">2.8.2</span> What defines an
informative gene?</h3>
<ul>
<li><p>Genes that are not expressed in any cell are obviously
uninformative.</p></li>
<li><p>Neither are genes that are highly expressed at a similar level in
all cells. So what should we be looking for?</p></li>
<li><p>Genes with high variance. But note our previous observations on
the mean-variance relationship.</p></li>
<li><p>Simply selecting features on high variance is common, but
possibly not optimal.</p></li>
<li><p>Genes with high variance relative to their mean. A (rightly so)
popular approach is to select genes that have a high variance with
respect to their mean. Often, first an empirical mean-variance trend is
fitted, upon which genes with the highest positive residuals are
selected. Being intuitive, reasonable and fairly straight-forward, this
method is widely used.</p></li>
<li><p>Genes with high deviance. See Townes et al. (2019) for feature
selection based on Binomial deviance. Genes with a high deviance will
most poorly fit a null model where the relative abundance is equal for
all cells, which therefore are informative.</p></li>
</ul>
<p><br/><br/></p>
</div>
<div id="example-feature-selection-based-on-high-variance-wrt-mean"
class="section level3" number="2.8.3">
<h3><span class="header-section-number">2.8.3</span> Example: feature
selection based on high variance wrt mean</h3>
<p>You need an assay log counts for this.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a>sce <span class="ot">&lt;-</span> <span class="fu">logNormCounts</span>(sce)</span>
<span id="cb73-2"><a href="#cb73-2" tabindex="-1"></a>dec <span class="ot">&lt;-</span> <span class="fu">modelGeneVar</span>(sce)</span>
<span id="cb73-3"><a href="#cb73-3" tabindex="-1"></a>varfit <span class="ot">&lt;-</span> <span class="fu">metadata</span>(dec)</span>
<span id="cb73-4"><a href="#cb73-4" tabindex="-1"></a><span class="fu">plot</span>(varfit<span class="sc">$</span>mean, varfit<span class="sc">$</span>var, </span>
<span id="cb73-5"><a href="#cb73-5" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Mean of log-expression&quot;</span>,</span>
<span id="cb73-6"><a href="#cb73-6" tabindex="-1"></a>    <span class="at">ylab=</span><span class="st">&quot;Variance of log-expression&quot;</span>)</span>
<span id="cb73-7"><a href="#cb73-7" tabindex="-1"></a><span class="fu">curve</span>(varfit<span class="sc">$</span><span class="fu">trend</span>(x), <span class="at">col=</span><span class="st">&quot;dodgerblue&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p><br/><br/></p>
<p>Select highly variable genes with variance larger than expected based
on the mean variance trend. We then have to select the top number of
most variable genes. We can for instance take the top 10% of the most
variable genes</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" tabindex="-1"></a>hvg <span class="ot">&lt;-</span> <span class="fu">getTopHVGs</span>(dec, <span class="at">prop=</span><span class="fl">0.1</span>)</span>
<span id="cb74-2"><a href="#cb74-2" tabindex="-1"></a><span class="fu">head</span>(hvg)</span></code></pre></div>
<pre><code>## [1] &quot;LYZ&quot;     &quot;S100A9&quot;  &quot;S100A8&quot;  &quot;HLA-DRA&quot; &quot;CD74&quot;    &quot;TYROBP&quot;</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" tabindex="-1"></a><span class="fu">plot</span>(varfit<span class="sc">$</span>mean, varfit<span class="sc">$</span>var, </span>
<span id="cb76-2"><a href="#cb76-2" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;orange&quot;</span>, <span class="st">&quot;darkseagreen3&quot;</span>)[(<span class="fu">names</span>(varfit<span class="sc">$</span>mean) <span class="sc">%in%</span> hvg)<span class="sc">+</span><span class="dv">1</span>],</span>
<span id="cb76-3"><a href="#cb76-3" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Mean of log-expression&quot;</span>,</span>
<span id="cb76-4"><a href="#cb76-4" tabindex="-1"></a>    <span class="at">ylab=</span><span class="st">&quot;Variance of log-expression&quot;</span>)</span>
<span id="cb76-5"><a href="#cb76-5" tabindex="-1"></a><span class="fu">curve</span>(varfit<span class="sc">$</span><span class="fu">trend</span>(x), <span class="at">col=</span><span class="st">&quot;dodgerblue&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb76-6"><a href="#cb76-6" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, </span>
<span id="cb76-7"><a href="#cb76-7" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Selected&quot;</span>, <span class="st">&quot;Not selected&quot;</span>), </span>
<span id="cb76-8"><a href="#cb76-8" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;darkseagreen3&quot;</span>, <span class="st">&quot;orange&quot;</span>),</span>
<span id="cb76-9"><a href="#cb76-9" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb76-10"><a href="#cb76-10" tabindex="-1"></a>       <span class="at">bty=</span><span class="st">&#39;n&#39;</span>)</span></code></pre></div>
<p><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p><br/><br/></p>
</div>
<div id="genes-with-high-deviance" class="section level3"
number="2.8.4">
<h3><span class="header-section-number">2.8.4</span> Genes with high
deviance</h3>
<p>See Townes et al. (2019) for feature selection based on Binomial
deviance. Genes with a high deviance will most poorly fit a null model
where the relative abundance is equal for all cells, which therefore are
informative.</p>
<p>Note that the deviance for a GLM is defined as:</p>
<p><span class="math display">\[
D = 2 [l(\mathbf{y},\mathbf{y}) - l(\mathbf{y},\hat{\mathbf{\mu}})]
\]</span></p>
<p>which is follows a <span class="math inline">\(\chi^2\)</span>
distribution with n degrees of freedom. Indeed, it is a LR test between
the best model with a perfect model fit and the current model.</p>
<p>If the difference is significant, there is lack of fit.</p>
<div class="figure">
<img src="images_sequencing/glmPCADeviance.png" alt="Townes et al. 2019, DOI: 10.1186/s13059-019-1861-6" width="50%" />
<p class="caption">
Townes et al. 2019, DOI: 10.1186/s13059-019-1861-6
</p>
</div>
<p><br/><br/></p>
</div>
<div
id="variance-stabilizing-transformation-vst-using-pearson-residuals"
class="section level3" number="2.8.5">
<h3><span class="header-section-number">2.8.5</span>
Variance-stabilizing transformation (VST) using Pearson residuals</h3>
<p>Lause et al. 2021 introduced the use of Pearson residuals to
stabilize the variance (doi: 10.1186/s13059-021-02451-7).</p>
<ul>
<li><p>When a model is fitted to each gene we can construct pearson
residuals that correct for the mean variance relation.</p></li>
<li><p>Here we model <span class="math inline">\(y_{ig} \sim
NB(\mu_{ig}=\pi_gs_iN_i,\phi_g)\)</span></p></li>
<li><p>Pearson residuals are then defined as</p></li>
</ul>
<p><span class="math display">\[
e_i = \frac{y_{ig} - \mu_{g}}{\sqrt{\mu_{g} + \phi\mu_{g}^2}}
\]</span></p>
<p>Indeed, the residuals are corrected for the mean variance
relationship.</p>
<p>We can then assess if the residuals exhibit over excess variance with
respect to the trend. If this is the case, the gene is informative.
There is more variance than we expect under the intercept model.</p>
<p><span class="math display">\[
\hat\sigma^2 = \sum\limits_{i=1}^n \frac{e_i^2}{n-p}
\]</span> Note, that this one of the variance estimator of the
quasi-negative binomial model (See Lund et al., 2012, DOI
10.1515/1544-6115.1826).</p>
<p>Genes with high variance are informative.</p>
<p>Note, that there is also a close connection to the method of Townes.
Another type of residuals for GLMs are deviance residuals, i.e. </p>
<p><span class="math display">\[
e_i^d = \sqrt{2 [l(y_{ig},y_{ig})-l(y_{ig},\hat\mu_{ig})]}
\]</span></p>
<p>Another variance estimator is</p>
<p><span class="math display">\[
\hat\sigma^2 = \sum\limits_{i=1}^n \frac{(e_i^d)^2}{n-p} = \frac{D}{n-p}
\]</span> Note, that this is the other excess variance estimator for the
quasi-negative binomial model. See Lund et al., 2012 (DOI
10.1515/1544-6115.1826).</p>
<p><br/><br/></p>
</div>
</div>
<div id="dimension-reduction" class="section level2" number="2.9">
<h2><span class="header-section-number">2.9</span> Dimension
reduction</h2>
<p>We would like to be able to project the data to a low-dimensional
space, while retaining as much information as possible. This will be
useful downstream for, e.g., visualization, identification of batch
effects, clustering, trajectory inference.</p>
<p>Many dimension reduction methods exist and this is a very active area
of research in scRNA-seq. We will discuss the most common methods such
as PCA, GLM-PCA, t-SNE and UMAP.</p>
<p><br/></p>
<div id="concerns-4" class="section level3" number="2.9.1">
<h3><span class="header-section-number">2.9.1</span> Concerns</h3>
<p>Like feature selection, this remains a subjective step in the
analysis. Several choices have to be made: input data, e.g.,
log-transformed data or not?; number of components to retain; parameter
tuning; etc..</p>
<p><br/><br/></p>
</div>
<div id="principal-component-analysis" class="section level3"
number="2.9.2">
<h3><span class="header-section-number">2.9.2</span> Principal Component
Analysis</h3>
<ul>
<li><p>A DR method is linear when the reduced dimensions are a linear
function of the original variables.</p></li>
<li><p>In PCA, each principal component is a linear combination of
genes. See here for a <a
href="https://statomics.github.io/HDDA/svd.html#3_Geometric_interpretation">geometric
interpretation of PCA</a> and for a <a
href="https://statomics.github.io/HDDA/svd.html#8_SVD_and_principal_component_analysis_(PCA)">PCA
details</a></p></li>
<li><p>Typically, PCA is performed on log-transformed normalized counts.
The log-transformation helps somewhat, but not completely, to account
for the mean-variance relationship.</p></li>
<li><p>PCA works well for bulk RNA-seq data. However, the structure of
scRNA-seq data is often too complex to be visualized by a small number
of PCs.</p></li>
</ul>
<p><br/><br/></p>
<div id="example-5" class="section level4" number="2.9.2.1">
<h4><span class="header-section-number">2.9.2.1</span> Example</h4>
<p>We do PCA on the highly variable genes.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a>sce <span class="ot">&lt;-</span> <span class="fu">runPCA</span>(sce, <span class="at">subset_row =</span> hvg)</span>
<span id="cb77-2"><a href="#cb77-2" tabindex="-1"></a><span class="fu">plotPCA</span>(sce)</span></code></pre></div>
<p><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Note that the subset_row argument ensures that we use the previously
selected HVGs to compute the PCs. Also note that by default runPCA will
store the PCs in the PCA slot, hence overwriting the previous PCs. In
the tutorials we will see that we already use PCA during the QC for
visualisation purposes. These results are based on a quick normalization
and prior to removing noisy genes and cells. Hence, it is ok to
overwrite them. In other cases, it may be reasonable to keep more than
one set of PCs: this can be achieved by specifying a different slot name
via the name argument.</p>
<p>Finally, note that by default scater will compute the top 50 PCs.
This is a reasonable choice, but it may be a good idea to explore the
variance explained by each component to decide the number of components
to retain. An alternative is to use the denoisePCA function from scran
that aims at selecting the number of PCs that explain biological
variability.</p>
<p><br/><br/></p>
</div>
</div>
<div id="glm-pca" class="section level3" number="2.9.3">
<h3><span class="header-section-number">2.9.3</span> GLM-PCA</h3>
<p>A generalization of PCA to exponential family distributions is
provide by Townes et al. 2019. PCA is based on squared/Euclidean
distances (e.g.Townes et al. 2019), which has a close link to Gaussian
likelihood, which is inappropriate for count data due to the
mean-variance relationship. Therefore, PCA results risks to be dominated
by highly expressed genes, which have large variance.</p>
<div class="figure">
<img src="images_sequencing/glmPCAFig2.png" alt="Townes et al. 2019, DOI: 10.1186/s13059-019-1861-6" width="100%" />
<p class="caption">
Townes et al. 2019, DOI: 10.1186/s13059-019-1861-6
</p>
</div>
<p><br/></p>
<p>They argue that UMI data are multinomially distributed, which can be
approximated by a Poisson distribution when conditioning on the library
size and propose a generalisation of PCA.</p>
<div class="figure">
<img src="images_sequencing/glmPCADerivation.png" alt="Townes et al. 2019, DOI: 10.1186/s13059-019-1861-6" width="50%" />
<p class="caption">
Townes et al. 2019, DOI: 10.1186/s13059-019-1861-6
</p>
</div>
<p><br/><br/></p>
<div class="figure">
<img src="images_sequencing/glmPCA_OnDevianceResiduals.png" alt="Townes et al. 2019, DOI: 10.1186/s13059-019-1861-6" width="80%" />
<p class="caption">
Townes et al. 2019, DOI: 10.1186/s13059-019-1861-6
</p>
</div>
<p><br/><br/></p>
<ul>
<li>Note, that full length plate based data scRNA-seq data are over
disperse with respect to the Poisson distribution and therefore NB-PCA
would be better.</li>
</ul>
<p><br/><br/></p>
</div>
<div id="glm-pca-example" class="section level3" number="2.9.4">
<h3><span class="header-section-number">2.9.4</span> GLM-PCA
Example</h3>
<p>GLM-PCA is implemented in the <code>scry</code> Bioconductor package;
it uses a Poisson model by default, but this can be changed to use
negative binomial, multinomial or binomial.</p>
<p>Unlike runPCA, the GLM-PCA function does not allow for a selection of
genes. Hence, we will first create a filtered SingleCellExperiment
object that contains only the HVGs.</p>
<p>Similarly to PCA, GLM-PCA needs the number of components (factors)
that need to be calculated. Here, we compute 10 latent factors.</p>
<p>We use the minibatch argument to use only a random subset of
observations to compute the gradient in the optimization algorithm. This
speeds up computations and avoids memory problems in big datasets.</p>
<p><br/></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb78-2"><a href="#cb78-2" tabindex="-1"></a>  <span class="fu">library</span>(scry)</span>
<span id="cb78-3"><a href="#cb78-3" tabindex="-1"></a>})</span>
<span id="cb78-4"><a href="#cb78-4" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100000</span>)</span>
<span id="cb78-5"><a href="#cb78-5" tabindex="-1"></a>filtered <span class="ot">&lt;-</span> sce[hvg,]</span>
<span id="cb78-6"><a href="#cb78-6" tabindex="-1"></a>filtered <span class="ot">&lt;-</span> <span class="fu">GLMPCA</span>(filtered, <span class="at">L=</span><span class="dv">10</span>, <span class="at">minibatch =</span> <span class="st">&quot;stochastic&quot;</span>)</span>
<span id="cb78-7"><a href="#cb78-7" tabindex="-1"></a>filtered</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 874 3651 
## metadata(2): Samples glmpca
## assays(2): counts logcounts
## rownames(874): LYZ S100A9 ... RBAK-RBAKDN WRB
## rowData names(3): ID Symbol location
## colnames(3651): AAACCTGAGAAGGCCT-1 AAACCTGAGACAGACC-1 ...
##   TTTGTCAGTTAAGACA-1 TTTGTCATCCCAAGAT-1
## colData names(11): Sample Barcode ... DoubletScore sizeFactor
## reducedDimNames(2): PCA GLMPCA
## mainExpName: NULL
## altExpNames(0):</code></pre>
<p><br/></p>
<p>To visualize the first two components of GLM-PCA, we can use the
plotReducedDim function from <code>scater</code>.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" tabindex="-1"></a><span class="fu">plotReducedDim</span>(filtered, <span class="st">&quot;GLMPCA&quot;</span>)</span></code></pre></div>
<p><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p><br/><br/></p>
</div>
<div id="newwave" class="section level3" number="2.9.5">
<h3><span class="header-section-number">2.9.5</span> NewWave</h3>
<p>An alternative method is implemented in the NewWave package, which
implements a negative binomial factor analysis model and uses a
penalized likelihood to estimate the latent factors (Agostinis et
al. 2022 DOI: 10.1093/bioinformatics/btac149).</p>
<p><br/></p>
<div id="newwave-example" class="section level4" number="2.9.5.1">
<h4><span class="header-section-number">2.9.5.1</span> NewWave
Example</h4>
<p>NewWave can also use minibatches, and if multiple CPUs are available
parallel computing, to speed up computations. The n_gene_par,
n_cell_par, and n_gene_disp arguments allow the user to choose how many
observations to use to estimate the gene- and cell-specific parameters.
The children argument allows one to use multiple cores; here we use
four, but you should change it depending on how many cores your computer
has (see parallel::detectCores()).</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb81-2"><a href="#cb81-2" tabindex="-1"></a>  <span class="fu">library</span>(NewWave)</span>
<span id="cb81-3"><a href="#cb81-3" tabindex="-1"></a>})</span>
<span id="cb81-4"><a href="#cb81-4" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100000</span>)</span>
<span id="cb81-5"><a href="#cb81-5" tabindex="-1"></a>filtered <span class="ot">&lt;-</span> <span class="fu">newWave</span>(filtered, <span class="at">K=</span><span class="dv">10</span>, <span class="at">children=</span><span class="dv">4</span>,</span>
<span id="cb81-6"><a href="#cb81-6" tabindex="-1"></a>                    <span class="at">n_gene_disp =</span> <span class="dv">100</span>, <span class="at">n_gene_par =</span> <span class="dv">100</span>, </span>
<span id="cb81-7"><a href="#cb81-7" tabindex="-1"></a>                    <span class="at">n_cell_par =</span> <span class="dv">100</span>)</span>
<span id="cb81-8"><a href="#cb81-8" tabindex="-1"></a>filtered</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 874 3651 
## metadata(2): Samples glmpca
## assays(2): counts logcounts
## rownames(874): LYZ S100A9 ... RBAK-RBAKDN WRB
## rowData names(3): ID Symbol location
## colnames(3651): AAACCTGAGAAGGCCT-1 AAACCTGAGACAGACC-1 ...
##   TTTGTCAGTTAAGACA-1 TTTGTCATCCCAAGAT-1
## colData names(11): Sample Barcode ... DoubletScore sizeFactor
## reducedDimNames(3): PCA GLMPCA newWave
## mainExpName: NULL
## altExpNames(0):</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a><span class="fu">plotReducedDim</span>(filtered, <span class="st">&quot;newWave&quot;</span>)</span></code></pre></div>
<p><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p><br/><br/></p>
</div>
</div>
<div id="tsne-and-umap" class="section level3" number="2.9.6">
<h3><span class="header-section-number">2.9.6</span> TSNE and UMAP</h3>
<ul>
<li><p>Non-linear dimension reduction methods</p></li>
<li><p>Visualizations of reduced dimensions from linear dimension
reduction methods are often ‘overcrowded’, and it is hard to see
structure.</p></li>
<li><p>Non-linear dimension reduction methods can overcome this problem.
As the name suggests, the reduced dimensions are a non-linear function
of the observed data. We will not go into detail as to how these work
under the hood, but provide a few guidelines for the most popular
methods. Often, the top (10-50) PCs are provided as input.</p></li>
<li><p>t-SNE: Preserving local rather than global distances. Therefore,
distances on a t-SNE reduced dimension plot can only be interpreted
locally, i.e., cells that are close together in reduced dimension will
have a similar transcriptome, but cells that are far away may not
necessarily have a very distinct transcriptome.</p></li>
<li><p>UMAP: Claimed to be better than t-SNE on preserving global
differences. Therefore, UMAP is also often used in analyses such as
trajectory inference, where this is important.</p></li>
</ul>
<p><br/></p>
<div id="example-6" class="section level4" number="2.9.6.1">
<h4><span class="header-section-number">2.9.6.1</span> Example</h4>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" tabindex="-1"></a>sce <span class="ot">&lt;-</span> <span class="fu">runTSNE</span>(sce, <span class="at">dimred=</span><span class="st">&quot;PCA&quot;</span>)</span>
<span id="cb84-2"><a href="#cb84-2" tabindex="-1"></a><span class="fu">plotTSNE</span>(sce)</span></code></pre></div>
<p><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p><br/></p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="st">&quot;uwot&quot;</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="dv">1</span>]) BiocManager<span class="sc">::</span><span class="fu">install</span>(<span class="st">&quot;uwot&quot;</span>)</span></code></pre></div>
<pre><code>## &#39;getOption(&quot;repos&quot;)&#39; replaces Bioconductor standard repositories, see
## &#39;?repositories&#39; for details
## 
## replacement repositories:
##     CRAN: https://cran.rstudio.com</code></pre>
<pre><code>## Bioconductor version 3.15 (BiocManager 1.30.18), R 4.2.3 (2023-03-15)</code></pre>
<pre><code>## Installing package(s) &#39;uwot&#39;</code></pre>
<pre><code>## also installing the dependencies &#39;FNN&#39;, &#39;RcppAnnoy&#39;, &#39;RSpectra&#39;, &#39;RcppProgress&#39;</code></pre>
<pre><code>## Installation paths not writeable, unable to update packages
##   path: /opt/R/4.2.3/lib/R/library
##   packages:
##     class, KernSmooth, lattice, rpart, spatial</code></pre>
<pre><code>## Old packages: &#39;abind&#39;, &#39;askpass&#39;, &#39;backports&#39;, &#39;BH&#39;, &#39;BiocManager&#39;,
##   &#39;BiocParallel&#39;, &#39;Biostrings&#39;, &#39;bit&#39;, &#39;bitops&#39;, &#39;blob&#39;, &#39;bookdown&#39;, &#39;boot&#39;,
##   &#39;brio&#39;, &#39;broom&#39;, &#39;bslib&#39;, &#39;cachem&#39;, &#39;callr&#39;, &#39;car&#39;, &#39;cli&#39;, &#39;clue&#39;, &#39;cluster&#39;,
##   &#39;codetools&#39;, &#39;colorspace&#39;, &#39;commonmark&#39;, &#39;corrplot&#39;, &#39;cowplot&#39;, &#39;cpp11&#39;,
##   &#39;crayon&#39;, &#39;crosstalk&#39;, &#39;curl&#39;, &#39;data.table&#39;, &#39;DBI&#39;, &#39;dbplyr&#39;,
##   &#39;DelayedMatrixStats&#39;, &#39;deldir&#39;, &#39;desc&#39;, &#39;digest&#39;, &#39;dplyr&#39;, &#39;dqrng&#39;, &#39;DT&#39;,
##   &#39;dtplyr&#39;, &#39;ensembldb&#39;, &#39;evaluate&#39;, &#39;fansi&#39;, &#39;farver&#39;, &#39;fastmap&#39;, &#39;filelock&#39;,
##   &#39;fontawesome&#39;, &#39;forcats&#39;, &#39;foreign&#39;, &#39;formatR&#39;, &#39;fs&#39;, &#39;gargle&#39;, &#39;generics&#39;,
##   &#39;GenomeInfoDb&#39;, &#39;GenomicAlignments&#39;, &#39;GenomicFeatures&#39;, &#39;ggbeeswarm&#39;,
##   &#39;ggplot2&#39;, &#39;ggpubr&#39;, &#39;ggrepel&#39;, &#39;ggsci&#39;, &#39;ggsignif&#39;, &#39;glue&#39;, &#39;googledrive&#39;,
##   &#39;googlesheets4&#39;, &#39;gtable&#39;, &#39;haven&#39;, &#39;highr&#39;, &#39;hms&#39;, &#39;htmltools&#39;,
##   &#39;htmlwidgets&#39;, &#39;httpuv&#39;, &#39;httr&#39;, &#39;igraph&#39;, &#39;interp&#39;, &#39;IRanges&#39;, &#39;isoband&#39;,
##   &#39;jpeg&#39;, &#39;jsonlite&#39;, &#39;KEGGREST&#39;, &#39;knitr&#39;, &#39;labeling&#39;, &#39;later&#39;, &#39;lifecycle&#39;,
##   &#39;limma&#39;, &#39;lme4&#39;, &#39;locfit&#39;, &#39;lubridate&#39;, &#39;MatrixGenerics&#39;, &#39;MatrixModels&#39;,
##   &#39;matrixStats&#39;, &#39;mgcv&#39;, &#39;minqa&#39;, &#39;modelr&#39;, &#39;multcomp&#39;, &#39;munsell&#39;, &#39;mvtnorm&#39;,
##   &#39;ncdf4&#39;, &#39;nlme&#39;, &#39;nloptr&#39;, &#39;nnet&#39;, &#39;openssl&#39;, &#39;pbkrtest&#39;, &#39;pillar&#39;,
##   &#39;pkgload&#39;, &#39;plotly&#39;, &#39;plyr&#39;, &#39;png&#39;, &#39;prettyunits&#39;, &#39;printr&#39;, &#39;processx&#39;,
##   &#39;progress&#39;, &#39;promises&#39;, &#39;ps&#39;, &#39;purrr&#39;, &#39;quantreg&#39;, &#39;R.methodsS3&#39;, &#39;R.oo&#39;,
##   &#39;R.utils&#39;, &#39;Rcpp&#39;, &#39;RcppArmadillo&#39;, &#39;RcppEigen&#39;, &#39;RcppHNSW&#39;, &#39;RCurl&#39;,
##   &#39;readr&#39;, &#39;readxl&#39;, &#39;rematch&#39;, &#39;renv&#39;, &#39;reprex&#39;, &#39;restfulr&#39;, &#39;rintrojs&#39;,
##   &#39;rlang&#39;, &#39;rmarkdown&#39;, &#39;rprojroot&#39;, &#39;RSQLite&#39;, &#39;rstatix&#39;, &#39;rstudioapi&#39;,
##   &#39;rtracklayer&#39;, &#39;Rtsne&#39;, &#39;RUnit&#39;, &#39;rvest&#39;, &#39;sandwich&#39;, &#39;sass&#39;, &#39;ScaledMatrix&#39;,
##   &#39;scales&#39;, &#39;scuttle&#39;, &#39;shiny&#39;, &#39;SingleCellExperiment&#39;, &#39;sourcetools&#39;, &#39;sp&#39;,
##   &#39;SparseM&#39;, &#39;statmod&#39;, &#39;stringi&#39;, &#39;stringr&#39;, &#39;survival&#39;, &#39;sys&#39;, &#39;testthat&#39;,
##   &#39;TH.data&#39;, &#39;tibble&#39;, &#39;tidyr&#39;, &#39;tidyselect&#39;, &#39;tidyverse&#39;, &#39;tinytex&#39;, &#39;tzdb&#39;,
##   &#39;utf8&#39;, &#39;uuid&#39;, &#39;vctrs&#39;, &#39;vipor&#39;, &#39;viridis&#39;, &#39;viridisLite&#39;, &#39;vroom&#39;, &#39;waldo&#39;,
##   &#39;withr&#39;, &#39;xfun&#39;, &#39;xgboost&#39;, &#39;XML&#39;, &#39;xml2&#39;, &#39;yaml&#39;, &#39;zoo&#39;</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" tabindex="-1"></a>sce <span class="ot">&lt;-</span> <span class="fu">runUMAP</span>(sce, <span class="at">dimred =</span> <span class="st">&#39;PCA&#39;</span>, <span class="at">external_neighbors=</span><span class="cn">TRUE</span>)</span>
<span id="cb92-2"><a href="#cb92-2" tabindex="-1"></a><span class="fu">plotUMAP</span>(sce)</span></code></pre></div>
<p><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p><br/><br/></p>
</div>
</div>
</div>
<div id="clustering-unsupervised-cell-type-identification"
class="section level2" number="2.10">
<h2><span class="header-section-number">2.10</span> Clustering:
unsupervised cell type identification</h2>
<ul>
<li><p>The identification of homogeneous, biologically relevant entities
that define a common cell identity.</p></li>
<li><p>Traditional clustering methods do not perform great, often
graph-based clustering or ensemble methods are used.</p></li>
</ul>
<p><br/></p>
<div id="concerns-5" class="section level3" number="2.10.1">
<h3><span class="header-section-number">2.10.1</span> Concerns</h3>
<ul>
<li>There are many resolutions at which this can be done, and there is
no such thing as an optimal cell type resolution; cells can be described
by a hierarchy of different cell types and states. More clusters may
result in higher resolution cell types, but can hamper replicability of
the results across datasets. <br/><br/></li>
</ul>
</div>
</div>
<div id="semi-supervised-cell-type-identification"
class="section level2" number="2.11">
<h2><span class="header-section-number">2.11</span> (Semi-)supervised
cell type identification</h2>
<ul>
<li><p>We can use prior knowledge to reliably identify cell clusters and
annotate them.</p></li>
<li><p>We can annotate a new scRNA-seq dataset by training a classifier
that predicts cell type label based on existing data.</p>
<ol style="list-style-type: decimal">
<li>Gather reference data that are relevant for your current dataset you
would like to annotate.</li>
<li>Train a classifier (lasso/ridge, SVM, neural net, kNN, …) to
classify cells into cell types, given gene expression data.</li>
<li>Use pre-trained classifier to estimate, for each cell, P(cell i is
cell type Z | gene expression of cell i).</li>
</ol></li>
</ul>
<p><br/></p>
<div id="concerns-6" class="section level3" number="2.11.1">
<h3><span class="header-section-number">2.11.1</span> Concerns</h3>
<p>The reference data used for training the classifier must be
representative for the dataset we would like to annotate. Problems may
occur if e.g., different technologies are used, or particular (rare)
cell types are not present in the reference data.</p>
<p><br/><br/></p>
</div>
</div>
</div>
<div id="differential-expression-de-discovery-of-marker-genes"
class="section level1" number="3">
<h1><span class="header-section-number">3</span> Differential expression
(DE), discovery of marker genes</h1>
<ul>
<li><p>DE is often a first step towards interpreting differences between
cell groups, and provides a basis for further biological
validation.</p></li>
<li><p>DE analysis in scRNA-seq is typically similar to bulk RNA-seq,
e.g. edgeR analysis. In fact, due to the high number of cells, often
simpler methods may be used, e.g. Wilcoxon tests.</p></li>
</ul>
<p><br/></p>
<div id="concerns-7" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Concerns</h2>
<ul>
<li><p>There is an ongoing debate in the community about the appropriate
noise model for scRNA-seq data. For example, are the data zero
inflated?</p></li>
<li><p>Post-selection inference problem, the data are used twice</p>
<ol style="list-style-type: decimal">
<li>Cluster</li>
<li>Find biomarkers between clusters</li>
</ol></li>
<li><p>Pseudo-replication in multi-subject-multi-cell
experiments!</p></li>
</ul>
<p><br/></p>
</div>
<div id="zero-inflation" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Zero-inflation</h2>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;./images_sequencing/zeroInflation.png&quot;</span>)</span></code></pre></div>
<p><img src="images_sequencing/zeroInflation.png" width="100%" /></p>
<p><br/><br/></p>
<p><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-32-1.png" width="50%" /><img src="sequencing_singleCell_files/figure-html/unnamed-chunk-32-2.png" width="50%" /></p>
<p><br/></p>
<ul>
<li><p>Motivation for zero-inflation is that we may consider two types
of zeros in scRNA-seq data:</p>
<ul>
<li>Biological zeros: We observe a zero count because the gene is not
expressed in that cell.</li>
<li>Technical zeros: Even though the gene was expressed in that cell, we
do not observe any molecules due to technical reasons (e.g., low capture
efficiency / sequencing depth).</li>
</ul></li>
<li><p>A zero-inflated count distribution is a mixture distribution that
consists of a point mass at zero and a count component. For example, a
zero-inflated negative binomial (ZINB) distribution.</p></li>
</ul>
<p><span class="math display">\[
\begin{array}{lcl}
Y_{ig} &amp; \sim &amp; ZINB(\mu_{ig}, \phi_g, \pi_{ig})\\\\
f(Y_{ig}) &amp;=&amp; \pi_{ig} \delta_0 + (1-\pi_{ig})
f_{NB}(\mu_{ig},\pi_{ig})
\end{array}
\]</span></p>
<p>Our take:</p>
<ul>
<li><p>Data from full-length protocols consist of high counts and many
zeros, and are more likely to be zero inflated.</p></li>
<li><p>Instead, data from UMI droplet-based protocols consist of low
counts with manyzeros. This seems to reasonably fit under a negative
binomial distribution, and zero inflation may not be necessary.</p></li>
</ul>
<p><br/></p>
</div>
<div id="pseudo-replication-in-multi-cell-multi-patient-scrna-seq-data"
class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Pseudo-replication in
multi-cell-multi-patient scRNA-seq data</h2>
<ul>
<li><p>In multi-patient datasets, we have a hierarchical correlation
structure.</p></li>
<li><p>Cells are nested within patient <span
class="math inline">\(\rightarrow\)</span> Expect correlation between
cells from the same patient.</p></li>
</ul>
<div class="figure">
<img src="images_sequencing/multi-cell-multi-patient.png" alt="Image credit Milan Malfait" width="100%" />
<p class="caption">
Image credit Milan Malfait
</p>
</div>
<p><br/></p>
<ul>
<li><p>When assessing differences in means within cell types between
different treatments, we can bulk the cells of the same cell types to
perform pseudobulks per subject.</p></li>
<li><p>These pseudobulk samples can than be assessed using conventional
bulk RNA-seq tools.</p></li>
</ul>
<div class="figure" style="text-align: center">
<img src="images_sequencing/muscat.png" alt="Crowell et al. 2020 (DOI: 10.1038/s41467-020-19894-4)" width="80%" />
<p class="caption">
Crowell et al. 2020 (DOI: 10.1038/s41467-020-19894-4)
</p>
</div>
<p><br/></p>
<div class="figure">
<img src="images_sequencing/pseudoReplicationFalsePositives.png" alt="Juntilla et al. 2022 (DOI 10.1093/bib/bbac286)" width="100%" />
<p class="caption">
Juntilla et al. 2022 (DOI 10.1093/bib/bbac286)
</p>
</div>
<p><br/></p>
<div class="figure">
<img src="images_sequencing/pseudoreplicationComparison.png" alt="Squair et al. 2021 (DOI 10.1038/s41467-021-25960-2)" width="100%" />
<p class="caption">
Squair et al. 2021 (DOI 10.1038/s41467-021-25960-2)
</p>
</div>
<p><br/></p>
<ul>
<li>Implementation see <a
href="http://bioconductor.org/books/3.16/OSCA.multisample/multi-sample-comparisons.html#creating-pseudo-bulk-samples">OSCA
Book</a></li>
</ul>
<p><br/><br/></p>
</div>
<div id="differential-distributions" class="section level2"
number="3.4">
<h2><span class="header-section-number">3.4</span> Differential
Distributions</h2>
<ul>
<li><p>A few methods exist that compare distributions between
treatments.</p></li>
<li><p>But, they do not allow to interpret the difference in the
distributions.</p></li>
</ul>
</div>
</div>
<div id="acknowledgements" class="section level1 unnumbered">
<h1 class="unnumbered">Acknowledgements</h1>
<p>Thanks to Davide Risso for sharing his materials from the CSAMA 2022
workshop, which I used as the starting point for the R code in this
document.</p>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAnU2VxdWVuY2luZzogU2luZ2xlIENlbGwgUk5BLXNlcScKYXV0aG9yOiAiTGlldmVuIENsZW1lbnQgYW5kIEtvZW4gVmFuIGRlbiBCZXJnZSIKZGF0ZTogIkxhc3QgZWRpdGVkIG9uIGByIGZvcm1hdChTeXMudGltZSgpLCAnJWQgJUIsICVZJylgIgpvdXRwdXQ6IAogIGh0bWxfZG9jdW1lbnQ6CiAgICB0b2M6IHRydWUKICAgIHRvY19mbG9hdDogdHJ1ZQogIHBkZl9kb2N1bWVudDoKICAgIHRvYzogdHJ1ZQogICAgbnVtYmVyX3NlY3Rpb25zOiB0cnVlCiAgICBsYXRleF9lbmdpbmU6IHhlbGF0ZXgKYWx3YXlzX2FsbG93X2h0bWw6IHRydWUKbGlua2NvbG9yOiBibHVlCnVybGNvbG9yOiBibHVlIApjaXRlY29sb3I6IGJsdWUKbGluay1jaXRhdGlvbnM6IHllcwoKLS0tCgpgYGB7ciBmdW5jdGlvbnMsIGluY2x1ZGU9RkFMU0V9CiMgQSBmdW5jdGlvbiBmb3IgY2FwdGlvbmluZyBhbmQgcmVmZXJlbmNpbmcgaW1hZ2VzCmZpZyA8LSBsb2NhbCh7CiAgICBpIDwtIDAKICAgIHJlZiA8LSBsaXN0KCkKICAgIGxpc3QoCiAgICAgICAgY2FwPWZ1bmN0aW9uKHJlZk5hbWUsIHRleHQpIHsKICAgICAgICAgICAgaSA8PC0gaSArIDEKICAgICAgICAgICAgcmVmW1tyZWZOYW1lXV0gPDwtIGkKICAgICAgICAgICAgcGFzdGUoIkZpZ3VyZSAiLCBpLCAiOiAiLCB0ZXh0LCBzZXA9IiIpCiAgICAgICAgfSwKICAgICAgICByZWY9ZnVuY3Rpb24ocmVmTmFtZSkgewogICAgICAgICAgICByZWZbW3JlZk5hbWVdXQogICAgICAgIH0pCn0pCmBgYAoKYGBge3IsIGVjaG89RkFMU0UsIG1lc3NhZ2U9RkFMU0UsIGV2YWw9VFJVRX0Kc3VwcHJlc3NQYWNrYWdlU3RhcnR1cE1lc3NhZ2VzKHsKICBsaWJyYXJ5KGtuaXRyKQogIGxpYnJhcnkocm1hcmtkb3duKQogIGxpYnJhcnkoZ2dwbG90MikKICBsaWJyYXJ5KHByaW50cikKICBsaWJyYXJ5KGdyaWRFeHRyYSkKICBsaWJyYXJ5KHRpZHl2ZXJzZSkKICBsaWJyYXJ5KHBsb3RseSkKICBsaWJyYXJ5KGpwZWcpCiAgbGlicmFyeShncmlkKQogIGxpYnJhcnkoZ2dwdWJyKQogIGlmKCEic2NEYmxGaW5kZXIiICVpbiUgaW5zdGFsbGVkLnBhY2thZ2VzKClbLDFdKSBCaW9jTWFuYWdlcjo6aW5zdGFsbCgic2NEYmxGaW5kZXIiKQogIGxpYnJhcnkoc2NEYmxGaW5kZXIpCn0pCmBgYAoKIyBJbnRyb2R1Y3Rpb24gCgojIyBFdm9sdXRpb24gb2YgZ2VuZSBleHByZXNzaW9uIG1lYXN1cmVtZW50cwoKYGBge3IgbGFyLCBmaWcuY2FwPSJJbWFnZSBjcmVkaXQ6IEBCb1hpYTciLCBvdXQud2lkdGg9IjEwMCUiLCBlY2hvPUZBTFNFfQpvcmdhbiA8LSByZWFkSlBFRygiLi9pbWFnZXNfc2VxdWVuY2luZy9zY1JOQS1zZXFfZnVsbE9yZ2FuLmpwZWciKQpidWxrIDwtIHJlYWRKUEVHKCIuL2ltYWdlc19zZXF1ZW5jaW5nL3NjUk5BLWJ1bGtSTkFzZXEuanBlZyIpCnNjIDwtIHJlYWRKUEVHKCIuL2ltYWdlc19zZXF1ZW5jaW5nL3NjUk5BLXNjUk5BLmpwZWciKQpzcGF0IDwtIHJlYWRKUEVHKCIuL2ltYWdlc19zZXF1ZW5jaW5nL3NjUk5BLXNwYXRpYWxSTkFzZXEuanBlZyIpCgpnIDwtIGdyaWRFeHRyYTo6Z3JpZC5hcnJhbmdlKAogIHJhc3Rlckdyb2Iob3JnYW4sIGludGVycG9sYXRlPVRSVUUpLAogIHJhc3Rlckdyb2IoYnVsaywgaW50ZXJwb2xhdGU9VFJVRSksCiAgcmFzdGVyR3JvYihzYywgaW50ZXJwb2xhdGU9VFJVRSksCiAgcmFzdGVyR3JvYihzcGF0LCBpbnRlcnBvbGF0ZT1UUlVFKSwKICB0b3AgPSAib3JnYW4iLAogIGJvdHRvbSA9ICJCdWxrIFJOQS1zZXEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NSTkEtc2VxICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BhdGlhbCBSTkEtc2VxIiwKICBuY29sPTExLAogIG5yb3c9MiwKICBsYXlvdXRfbWF0cml4ID0gcmJpbmQoCiAgICBjKE5BLCBOQSwgTkEsIE5BLCAxLCAxLCAxLCBOQSwgTkEsIE5BLCBOQSksCiAgICBjKDIsIDIsIDIsIE5BLCAzLCAzLCAzLCBOQSwgNCwgNCwgNCkpKSAKYGBgCgo8YnIvPjxici8+CgojIyBFeGNpdGluZyBhcHBsaWNhdGlvbnMgCgpgYGB7ciBhcHBsaWNhdGlvbnMsIG91dC53aWR0aD0iMTAwJSIsIGZpZy5jYXA9Ikh3YW5nIGV0IGFsLiAyMDE4LCBkb2k6IDEwLjEwMzgvczEyMjc2LTAxOC0wMDcxLTgiLCBlY2hvPUZBTFNFLCBvdXQud2lkdGg9IjEwMCUifQppbmNsdWRlX2dyYXBoaWNzKCIuL2ltYWdlc19zZXF1ZW5jaW5nL0FwcGxpY2F0aW9ucy1vZi1zY1JOQS5wbmciKQpgYGAKPGJyLz48YnIvPgoKIyMgQnVsayB2cyBzaW5nbGUgY2VsbAoKIyMjIFByb3RvY29sCgpgYGB7ciBidWxrVnNTYzEsIGZpZy5jYXA9Ik93ZW5zLCAyMDEyLCBkb2k6IDEwLjEwMzgvNDkxMDI3YSIsIGVjaG89RkFMU0UsIG91dC53aWR0aD0iMTAwJSJ9CmluY2x1ZGVfZ3JhcGhpY3MoIi4vaW1hZ2VzX3NlcXVlbmNpbmcvb3dlbnNTaW5nbGVDZWxsLnBuZyIpCmBgYAo8YnIvPgoKLSBCdWxrIFJOQS1zZXEgZGF0YXNldHMgYXJlIHR5cGljYWxseSBjaGFyYWN0ZXJpemVkIGJ5IGEgaGlnaCBzZXF1ZW5jaW5nIGRlcHRoLCBpLmUuLCB0eXBpY2FsbHkgbWlsbGlvbnMgb2YgcmVhZHMgYXJlIHNlcXVlbmNlZCBmb3IgZWFjaCBpbmRpdmlkdWFsIHNhbXBsZS4gVGhpcyBpcyBwb3NzaWJsZSBzaW5jZSB0aGVyZSBhcmUgb2Z0ZW4gb25seSBhIGxpbWl0ZWQgbnVtYmVyIG9mIHNhbXBsZXMgYmVpbmcgc2VxdWVuY2VkLgoKLSBUaGlzIGlzIGRpZmZlcmVudCBmb3Igc2luZ2xlLWNlbGwgUk5BLXNlcXVlbmNpbmcgKHNjUk5BLXNlcSksIHdoZXJlIG1hbnkgaW5kaXZpZHVhbCBjZWxscyAodGhvdXNhbmRzIHRvIG1pbGxpb25zKSBhcmUgc2VxdWVuY2VkLiBEdWUgdG8gdGhpcyBoaWdoIGNlbGwgbnVtYmVyLCBvbmx5IGEgbGltaXRlZCBudW1iZXIgb2Ygc2VxdWVuY2luZyByZWFkcyBhcmUgdHlwaWNhbGx5IGF2YWlsYWJsZSBmb3IgZWFjaCBpbmRpdmlkdWFsIGNlbGwuCgpUaGlzIGRpZmZlcmVuY2UgaW4gd2V0bGFiIHByb3RvY29sIHdpbGwgaGF2ZSBhIHNpZ25pZmljYW50IGltcGFjdCBvbiB0aGUgc3RhdGlzdGljYWwgYW5hbHlzaXMgb2YgdGhlIGRhdGEuIFRoZSBkYXRhIGFuYWx5c2lzIGlzIGFmZmVjdGVkIGJ5IHRoZSBkYXRhLWdlbmVyYXRpbmcgcHJvdG9jb2wsIGFuZCBvbmUgbXVzdCBjYXJlZnVsbHkgdGFrZSB0aGlzIGludG8gY29uc2lkZXJhdGlvbi4KCjxici8+PGJyLz4KCiMjIyBWYXJpYWJpbGl0eSBpbiBkYXRhCgpgYGB7ciBidWxrVnNTYzIsIGZpZy5jYXA9IkltYWdlIGNyZWRpdDogRGF2aWRlIFJpc3NvIiwgZWNobz1GQUxTRSwgb3V0LndpZHRoPSIxMDAlIn0KaW5jbHVkZV9ncmFwaGljcygiLi9pbWFnZXNfc2VxdWVuY2luZy9pbmNyZWFzZVZhcmlhYmlsaXR5Umlzc28ucG5nIikKYGBgCjxici8+PGJyLz4KCiMjIHNjUk5BLXNlcSBQcm90b2NvbHMKCmBgYHtyIHByb3RvY29scywgZmlnLmNhcD0iR3JpZmZpdGhzIGV0IGFsLiwgMjAxOCwgZG9pLm9yZy8xMC4xNTI1Mi9tc2IuMjAxNzgwNDYiLCBlY2hvPUZBTFNFLCBvdXQud2lkdGg9IjEwMCUifQppbmNsdWRlX2dyYXBoaWNzKCIuL2ltYWdlc19zZXF1ZW5jaW5nL3NjUk5BLXNlcVRlY2hub2xvZ2llcy5wbmciKQpgYGAKCjxici8+PGJyLz4KCmBgYHtyIHVtaTIsIGZpZy5jYXA9IkltYWdlIGNyZWRpdDogRGF2aWRlIFJpc3NvIiwgZWNobz1GQUxTRSwgb3V0LndpZHRoPSIxMDAlIn0KaW5jbHVkZV9ncmFwaGljcygiLi9pbWFnZXNfc2VxdWVuY2luZy91bWlWc0Z1bGxMZW5naHRSaXNzby5wbmciKQpgYGAKCjxici8+PGJyLz4KCgotIEZ1bGwtbGVuZ3RoIHByb3RvY29scyAodHlwaWNhbGx5IHBsYXRlLWJhc2VkKS4gSGVyZSwgYSBjb3VudCBoYXMgYSBzaW1pbGFyIGludGVycHJldGF0aW9uIHRvIGJ1bGsgUk5BLXNlcTogdGhlIG51bWJlciBvZiBzZXF1ZW5jZWQgcmVhZHMgdGhhdCBtYXBwZWQgYmFjayB0byB0aGF0IGdlbm9taWMgbG9jdXMuIFRoZSBjb3VudCBpcyBhIHByb3h5IGZvciB0aGUgY29uY2VudHJhdGlvbiBvZiBtUk5BIG1vbGVjdWxlcyBpbiB0aGUgY2VsbC4KCi0gVU1JLWJhc2VkIHByb3RvY29scyAodHlwaWNhbGx5IGRyb3BsZXQtYmFzZWQpLiBIZXJlLCBvbmUgY291bnQgY29ycmVzcG9uZHMgdG8gb25lIG9ic2VydmVkIG1STkEgbW9sZWN1bGUgcHJlc2VudCBpbiB0aGUgY2VsbC4gVGhhbmtzIHRvIHRoZSB1c2Ugb2YgVU1JIGJhcmNvZGVzLCBQQ1IgYXJ0aWZhY3RzIGFyZSByZWR1Y2VkLiBIb3dldmVyLCBubyBmdWxsIGxlbmd0aCBpbmZvcm1hdGlvbiBvbiB0cmFuc2NyaXB0IGJlY2F1c2Ugd2l0aCBmcmFnbWVudGF0aW9uIGJhc2VkIHByb3RvY29scyBvbmx5IG9uZSBmcmFnbWVudCB3b3VsZCBoYXZlIHRoZSBVTUkhCgpCb3RoIHByb3RvY29scyBzdWZmZXIgZnJvbSBhIGxvdyDigJhjYXB0dXJlIGZyZXF1ZW5jeeKAmSwgaS5lLiwgdGhlIG51bWJlciBvZiBtb2xlY3VsZXMgcHJlc2VudCBpbiB0aGUgY2VsbCB0aGF0IGhhdmUgYWN0dWFsbHkgYmVlbiBjYXB0dXJlZCBhbmQgbWF5IHRoZXJlZm9yZSBiZSBvYnNlcnZlZC4KCjxici8+PGJyLz4KCiMjIE11bHRpcGxleGluZyAKCmBgYHtyIGthbmdNdWx0aXBsZXgsIGZpZy5jYXA9IkthbmcgZXQgYWwuIDIwMTgsIGRvaTogMTAuMTAzOC9uYnQuNDA0MiIsIGVjaG89RkFMU0UsIG91dC53aWR0aD0iMTAwJSJ9CmluY2x1ZGVfZ3JhcGhpY3MoIi4vaW1hZ2VzX3NlcXVlbmNpbmcva2FuZ011bHRpcGxleGluZy5wbmciKQpgYGAKCjxici8+PGJyLz4KCkV4cGVyaW1lbnRhbCBEZXNpZ24hISEKCmBgYHtyIGVjaG89RkFMU0V9CnN1cHByZXNzUGFja2FnZVN0YXJ0dXBNZXNzYWdlcyh7CmxpYnJhcnkoRXhwZXJpbWVudEh1YikKbGlicmFyeShzY2F0ZXIpCn0pCmBgYAoKYGBge3J9CmVoIDwtIEV4cGVyaW1lbnRIdWIoKQpzY2UgPC0gZWhbWyJFSDIyNTkiXV0Kc2NlCmBgYAoKYGBge3J9CnBsb3RSZWR1Y2VkRGltKHNjZSwgZGltcmVkPSJUU05FIiwgY29sb3VyX2J5PSJjZWxsIikKcGxvdFJlZHVjZWREaW0oc2NlLCBkaW1yZWQ9IlRTTkUiLCBjb2xvdXJfYnk9InN0aW0iKQpgYGAKCjxici8+CgotIE5vdGUsIHRoYXQgd2Ugc2VlIGh1Z2UgZWZmZWN0IG9mIHRyZWF0bWVudC4gSWYgd2Ugc2VlIHN1Y2ggbGFyZ2UgZWZmZWN0cyB3ZSBhbHdheXMgaGF2ZSB0byBiZSBvbiBvdXIgZ3VhcmQhCgotIENlbGxzIG9mIDggcGF0aWVudHMgd2VyZSBub3Qgc3RpbXVsYXRlZCAgb3Igc3RpbXVsYXRlZC4gCgotIENlbGxzIG9mIGRpZmZlcmVudCBwYXRpZW50cyBjb3VsZCBiZSBoYXNoZWQuIAoKLSBTbyBhbGwgY29udHJvbCBjZWxscyB3ZXJlIHNlcXVlbmNlZCBpbiBhIGZpcnN0IHJ1biBhbmQgYWxsIHN0aW11bGF0ZWQgY2VsbHMgd2VyZSBvbiBhIHNlY29uZCBzZXF1ZW5jaW5nIHJ1bi4gCgotIFNvIHRoZSBsYXJnZSBlZmZlY3QgbWlnaHQgYmUgYW4gZWZmZWN0IG9mIGJhdGNoIQoKPGJyLz48YnIvPgoKCiMgVHlwaWNhbCBXb3JrZmxvdwoKU2VlIFtPU0NBIGJvb2tdKGh0dHBzOi8vZ2l0aHViLmNvbS9PU0NBLXNvdXJjZS9PU0NBKQoKYGBge3Igb3NjYXdvcmtmbG93LCBmaWcuY2FwPSJJbWFnZSBjcmVkaXQ6IE9TQ0EgYm9vayIsIGVjaG89RkFMU0UsIG91dC53aWR0aD0iMTAwJSJ9CmluY2x1ZGVfZ3JhcGhpY3MoIi4vaW1hZ2VzX3NlcXVlbmNpbmcvc2NSTkEtZGF0YS13b3JrZmxvdy5wbmciKQpgYGAKCjxici8+PGJyLz4KCiMjIFByZXByb2Nlc3NpbmcgCgpBZGRpdGlvbmFsIGNoYWxsZW5nZXMgYXJpc2UgYXMgY29tcGFyZWQgdG8gYnVsayBSTkEtc2VxLgoKLSBDZWxsdWxhciBiYXJjb2RlIGlkZW50aWZpY2F0aW9uOiBFcnJvcnMgb2NjdXJyaW5nIGR1cmluZyBQQ1IgYW1wbGlmaWNhdGlvbiBhbmQgc2VxdWVuY2luZyBjYW4gY29ycnVwdCB0aGUgY2VsbHVsYXIgYmFyY29kZSBzZXF1ZW5jZS4KCiAgLSBBbGV2aW4tZnJ5IG9ubHkgcXVhbnRpZmllcyBjZWxscyByZWxpYWJseSBhc3NpZ25lZCBhcyBub24tZW1wdHkgZHJvcGxldHMgYnkgbG9va2luZyBmb3IgdGhlIOKAnGtuZWXigJ0gaW5mbGVjdGlvbiBwb2ludCBpbiB0aGUgQ0RGIG9mIHRoZSB0b3RhbCBudW1iZXIgb2YgVU1JcyBmb3IgZWFjaCBkcm9wbGV0LgoKICAtIE9uY2UgdGhpcyBsaXN0IG9mIGJhcmNvZGVzIGlzIGdlbmVyYXRlZCwgcmVhZHMgd2l0aCBjZWxsdWxhciBiYXJjb2RlcyBub3QgaW4gdGhpcyBzZXQgYXJlIOKAnGNvcnJlY3RlZOKAnSBhZ2FpbnN0IGl0IGJ5IGNoZWNraW5nIGlmIHRoZXkgYXJlIHdpdGhpbiBvbmUgZWRpdCBvZiB0aGUgc2V0LgoKLSBDZWxsIGRlbXVsdGlwbGV4aW5nOiAKCiAgLSBDZWxsIEhhc2hpbmc6IENlbGx1bGFyIGJhcmNvZGUgaWRlbnRpZmljYXRpb24gZnJvbSBIVE8gY291bnRzLgogIC0gQmlvbG9naWNhbCB2YXJpYXRpb246IE1vZGVsLWJhc2VkIGNsdXN0ZXJpbmcgb2YgY2VsbHMgdG8gaW5kaXZpZHVhbHMuCgotIFByb2Nlc3NpbmcgdGhvdXNhbmRzLW1pbGxpb25zIG9mIGNlbGxzCgotIFVNSSBpZGVudGlmaWNhdGlvbiBhbmQgY29sbGFwc2luZzoKCiAgLSBEZXRlcm1pbmUgdGhlIHNldCBvZiBnZW5lcyBjb3JyZXNwb25kaW5nIHRvIGFsbCByZWFkcyBvZiBhIHBhcnRpY3VsYXIgVU1JLgogIC0gT2Z0ZW4sIGEgVU1JIGNvdW50IGlzIGFzc2lnbmVkIHRvIHRoZSBnZW5lIHdpdGggaGlnaGVzdCBmcmVxdWVuY3kgYW1vbmdzdCBhbGwgcmVhZHMgaGF2aW5nIHRoYXQgVU1JLiBBbHNvIGhlcmUsIFVNSSBiYXJjb2RlcyBtYXkgYmVjb21lIGNvcnJ1cHRlZC4KCjxici8+PGJyLz4KCiMjIFNpbmdsZSBjZWxsIGV4cGVyaW1lbnQgY2xhc3MgCgpgYGB7ciBzaW5nbGVDZWxsRXhwZXJpbWVudCwgZmlnLmNhcD0iSW1hZ2UgY3JlZGl0OiBPU0NBIGJvb2siLCBlY2hvPUZBTFNFLCBvdXQud2lkdGg9IjEwMCUifQppbmNsdWRlX2dyYXBoaWNzKCIuL2ltYWdlc19zZXF1ZW5jaW5nL1NpbmdsZUNlbGxFeHBlcmltZW50LnBuZyIpCmBgYAoKPGJyLz48YnIvPgoKV2h5IHVzZSBhIFNpbmdsZUNlbGxFeHBlcmltZW50IG9iamVjdD8KCi0gQ29udmVuaWVudCBmcmFtZXdvcmsgdG8gc3RvcmUgYWxsIGVzc2VudGlhbCAobWV0YSlkYXRhIGluIG9uZSBvYmplY3QuCi0gQWxsIGRpZmZlcmVudCAobWV0YSlkYXRhIHN0cnVjdHVyZXMgYXJlIGxpbmtlZDogYXZvaWRzIGNvbmZ1c2lvbiBvbiB3aGV0aGVyLCBlLmcuLCB0aGUgY2x1c3RlciBsYWJlbHMgYW5kIHRoZSBjb3VudCBtYXRyaXggYXJlIGlkZW50aWNhbGx5IHNvcnRlZC4KLSBGaWx0ZXJpbmcgb2YgZ2VuZXMgb3IgY2VsbHMgaW1tZWRpYXRlbHkgYWxzbyBmaWx0ZXJzIHRoZSBjb3JyZXNwb25kaW5nIG1ldGFkYXRhLgotIE1vc3QgQmlvY29uZHVjdG9yIHNvZnR3YXJlIGFjY2VwdHMgYSBTaW5nbGVDZWxsRXhwZXJpbWVudCBvYmplY3QgYXMgaW5wdXQsIGFuZCBvdXRwdXRzIGEgU2luZ2xlQ2VsbEV4cGVyaW1lbnQgb2JqZWN0ICQKcmlnaHRhcnJvdyQgb25lIGNvbW1vbiBpbmZyYXN0cnVjdHVyZSBhY3Jvc3MgZW50aXJlIGFuYWx5c2lzIHdvcmtmbG93LgotIFBsZWFzZSBzZWUgdGhlIFtPU0NBIGNoYXB0ZXIgb24gU2luZ2xlQ2VsbEV4cGVyaW1lbnQgY2xhc3NdKGh0dHA6Ly9iaW9jb25kdWN0b3Iub3JnL2Jvb2tzLzMuMTQvT1NDQS5pbnRyby90aGUtc2luZ2xlY2VsbGV4cGVyaW1lbnQtY2xhc3MuaHRtbCkgZm9yIG1vcmUgaW5mb3JtYXRpb24gYW5kIGhvdyB0byB1c2UgaXQgKHBsZWFzZSB0cnkgYW5kIGdldCBmYW1pbGlhciEpLgoKPGJyLz48YnIvPgoKIyMjIEV4YW1wbGUgCgpXZSBpbGx1c3RyYXRlIHRoZXNlIHN0ZXBzIHVzaW5nIGEgZGF0YXNldCBvbiBQZXJpcGhlcmFsIEJsb29kIE1vbm9udWNsZWFyIENlbGwgKFBCTUMpIGRhdGEgZnJvbSBhIGhlYWx0aHkgZG9ub3IgcHJvdmlkZWQgYnkgMTBYIEdlbm9taWNzLiBXZSB1c2UgdGhlIERyb3BsZXRUZXN0RmlsZXMgQmlvY29uZHVjdG9yIHBhY2thZ2UgdG8gZG93bmxvYWQgdGhlIHJhdyAoaS5lLiwgdW5maWx0ZXJlZCkgY291bnQgbWF0cml4IHRoYXQgY29udGFpbnMgdGhlIFVNSSBjb3VudHMgb2YgYWxsIGdlbmVzIGluIGFsbCBkcm9wbGV0cy4KCgpgYGB7ciBlY2hvPUZBTFNFfQpzdXBwcmVzc1BhY2thZ2VTdGFydHVwTWVzc2FnZXMoewogIGlmKCEiRHJvcGxldFRlc3RGaWxlcyIgJWluJSBpbnN0YWxsZWQucGFja2FnZXMoKVssMV0pIEJpb2NNYW5hZ2VyOjppbnN0YWxsKCJEcm9wbGV0VGVzdEZpbGVzIikKICBsaWJyYXJ5KERyb3BsZXRUZXN0RmlsZXMpCiAgCiAgaWYoISJEcm9wbGV0VXRpbHMiICVpbiUgaW5zdGFsbGVkLnBhY2thZ2VzKClbLDFdKSBCaW9jTWFuYWdlcjo6aW5zdGFsbCgiRHJvcGxldFV0aWxzIikKICBsaWJyYXJ5KERyb3BsZXRVdGlscykKICAKICBpZighIkVuc0RiLkhzYXBpZW5zLnY4NiIgJWluJSBpbnN0YWxsZWQucGFja2FnZXMoKVssMV0pIEJpb2NNYW5hZ2VyOjppbnN0YWxsKCJFbnNEYi5Ic2FwaWVucy52ODYiKQogIGxpYnJhcnkoRW5zRGIuSHNhcGllbnMudjg2KQoKfSkKYGBgCgpgYGB7cn0KcmF3LnBhdGggPC0gZ2V0VGVzdEZpbGUoInRlbngtMi4xLjAtcGJtYzRrLzEuMC4wL3Jhdy50YXIuZ3oiKQpvdXQucGF0aCA8LSBmaWxlLnBhdGgodGVtcGRpcigpLCAicGJtYzRrIikKdW50YXIocmF3LnBhdGgsIGV4ZGlyPW91dC5wYXRoKQoKZm5hbWUgPC0gZmlsZS5wYXRoKG91dC5wYXRoLCAicmF3X2dlbmVfYmNfbWF0cmljZXMvR1JDaDM4IikKc2NlIDwtIHJlYWQxMHhDb3VudHMoZm5hbWUsIGNvbC5uYW1lcz1UUlVFKQpzY2UKYGBgCgpUaGUgcmVhZDEweENvdW50cyBmdW5jdGlvbiBzdGFydHMgZnJvbSB0aGUgb3V0cHV0IG9mIHRoZSBDZWxsIFJhbmdlciBzb2Z0d2FyZSBhbmQgaW1wb3J0cyB0aGUgZGF0YSBpbnRvIFIgYXMgYW4gb2JqZWN0IG9mIGNsYXNzIFNpbmdsZUNlbGxFeHBlcmltZW50LgoKV2UgY2FuIG5vdGljZSB0aGF0IHRoZSBkaW1lbnNpb24gb2YgdGhlIG1hdHJpeCBpcyB2ZXJ5IGJpZzsgaW4gZmFjdCB0aGlzIG1hdHJpeCBpbmNsdWRlcyB0aGUgVU1JIHRoYXQgaGF2ZSBiZWVuIGRldGVjdGVkIGluIGFsbCB0aGUgZHJvcGxldHMgdGhhdCBoYXZlIGJlZW4gc2VxdWVuY2VkLCBpbmNsdWRpbmcgdGhlIGVtcHR5IGRyb3BsZXRzIHRoYXQgbWF5IGNvbnRhaW4gb25seSBhbWJpZW50IFJOQS4KClRoaXMgaXMgYSB2ZXJ5IHNwYXJzZSBtYXRyaXgsIHdpdGggYSBsYXJnZSBmcmFjdGlvbiBvZiB6ZXJvczsgcmVhZDEweENvdW50cyBpcyBhd2FyZSBvZiB0aGlzIGFuZCBzdG9yZXMgdGhlIGNvdW50cyBhcyBhIHNwYXJzZSBtYXRyaXgsIHdoaWNoIGhhcyBhIHZlcnkgc21hbGwgbWVtb3J5IGZvb3RwcmludC4KCjxici8+PGJyLz4KCiMjIyBFeHBsb3JlIFNpbmdsZUNlbGxFeHBlcmltZW50IG9iamVjdAoKYGBge3J9CnNjZSAlPiUgCiAgY291bnRzICU+JSAKICBoZWFkKG49Yyg2LDYpKQoKc2NlICU+JSAKICBjb3VudHMgJT4lIAogIGNsYXNzCgpzY2UgJT4lIAogIGFzc2F5cwoKc2NlICU+JSAKICByb3dEYXRhICU+JSAKICBoZWFkCgpzY2UgJT4lIAogIGNvbERhdGEgJT4lIAogIGhlYWQKYGBgCgo8YnIvPjxici8+CgojIyMgVXNlIHNlbnNpYmxlIGdlbmUgbmFtZXMKCkJlZm9yZSBzdGFydGluZyB0aGUgYW5hbHlzaXMsIGl0IG1heSBiZSBhIGdvb2QgaWRlYSB0byBzdG9yZSB0aGUgbmFtZXMgb2YgdGhlIGdlbmVzIGluIGEgbW9yZSBodW1hbi1mcmllbmRseSBJRCBzeXN0ZW0uIFdlIGNhbiBhbHNvIGluY2x1ZGUgaW5mb3JtYXRpb24gb24gdGhlIGNocm9tb3NvbWUgbG9jYXRpb24gb2YgdGhlIGdlbmVzOyB0aGlzIHdpbGwgYmUgdXNlZnVsIGZvciBlLmcuIGlkZW50aWZ5aW5nIG1pdG9jaG9uZHJpYWwgZ2VuZXMuCgoKYGBge3J9CmxpYnJhcnkoc2N1dHRsZSkKcm93bmFtZXMoc2NlKSA8LSB1bmlxdWlmeUZlYXR1cmVOYW1lcygKICAgIHJvd0RhdGEoc2NlKSRJRCwgcm93RGF0YShzY2UpJFN5bWJvbCkKCnJvd0RhdGEoc2NlKSRsb2NhdGlvbiA8LSBtYXBJZHMoRW5zRGIuSHNhcGllbnMudjg2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5cz1yb3dEYXRhKHNjZSkkSUQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uPSJTRVFOQU1FIiwga2V5dHlwZT0iR0VORUlEIikKcm93RGF0YShzY2UpJGxvY2F0aW9uW2lzLm5hKHJvd0RhdGEoc2NlKSRsb2NhdGlvbildIDwtICJOQSIKcm93RGF0YShzY2UpCmBgYAoKPGJyLz48YnIvPgoKIyMgRmlsdGVyIG5vbi1pbmZvcm1hdGl2ZSBnZW5lcwoKYGBge3J9CmtlZXAgPC0gcm93U3Vtcyhhc3NheXMoc2NlKSRjb3VudHMgPiAwKSA+IDEwCnRhYmxlKGtlZXApCnNjZSA8LSBzY2Vba2VlcCxdCmBgYAoKPGJyLz48YnIvPgoKIyMgRGV0ZWN0aW9uIGFuZCByZW1vdmFsIG9mIGVtcHR5IGRyb3BsZXRzIAoKVGhlIGZpcnN0IHN0ZXAgaXMgdGhlIGlkZW50aWZpY2F0aW9uIG9mIGRyb3BsZXRzIHRoYXQgZG8gbm90IGNvbnRhaW4gYW55IGxpdmUgY2VsbC4KClRoZSByZWFzb24gd2h5IHRoZXNlIGRyb3BsZXRzIGNvbnRhaW4gc29tZSBSTkEgaXMgdGhhdCB0aGVyZSBtYXkgYmUgc29tZSBhbWJpZW50IFJOQSBkdWUgdG8gc29tZSBjZWxsIGxlYWtpbmcgb3IgdGhleSBtYXkgY29udGFpbiBkZWFkIG9yIGR5aW5nIGNlbGxzLgoKPGJyLz48YnIvPgoKIyMjIEV4YW1wbGUgCgpUaGUgYmFyY29kZVJhbmtzIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHRvIHJhbmsgdGhlIGJhcmNvZGVzIGJ5IG51bWJlciBvZiBVTUlzIGFuZCB0byBlc3RpbWF0ZSB0aGUga25lZSBhbmQgaW5mbGVjdGlvbiBwb2ludCBvZiB0aGUgZGlzdHJpYnV0aW9uLgoKCmBgYHtyfQpiY3JhbmsgPC0gYmFyY29kZVJhbmtzKGNvdW50cyhzY2UpKQoKIyBPbmx5IHNob3dpbmcgdW5pcXVlIHBvaW50cyBmb3IgcGxvdHRpbmcgc3BlZWQuCnVuaXEgPC0gIWR1cGxpY2F0ZWQoYmNyYW5rJHJhbmspCnBsb3QoYmNyYW5rJHJhbmtbdW5pcV0sIGJjcmFuayR0b3RhbFt1bmlxXSwgbG9nPSJ4eSIsCiAgICB4bGFiPSJSYW5rIiwgeWxhYj0iVG90YWwgVU1JIGNvdW50IiwgY2V4LmxhYj0xLjIpCgphYmxpbmUoaD1tZXRhZGF0YShiY3JhbmspJGluZmxlY3Rpb24sIGNvbD0iZGFya2dyZWVuIiwgbHR5PTIpCmFibGluZShoPW1ldGFkYXRhKGJjcmFuaykka25lZSwgY29sPSJkb2RnZXJibHVlIiwgbHR5PTIpCgpsZWdlbmQoImJvdHRvbWxlZnQiLCBsZWdlbmQ9YygiSW5mbGVjdGlvbiIsICJLbmVlIiksIAogICAgICAgIGNvbD1jKCJkYXJrZ3JlZW4iLCAiZG9kZ2VyYmx1ZSIpLCBsdHk9MiwgY2V4PTEuMikKYGBgCgo8YnIvPgoKLSBUaGVyZSBpcyBhIHNoYXJwIGRpc3RpbmN0aW9uIGJldHdlZW4gZHJvcGxldHMgd2l0aCB2ZXJ5IGhpZ2ggY291bnRzLCB2ZXJ5IGxpa2VseSB0byBjb250YWluIGEgbGl2ZSBjZWxsLCBhbmQgZHJvcGxldHMgd2l0aCB2ZXJ5IGxvdyBjb3VudHMsIHZlcnkgbGlrZWx5IHRvIGJlIGVtcHR5LgoKLSBIb3dldmVyLCBpdCBpcyBub3Qgc3RyYWlnaHRmb3J3YXJkIHRvIGNsYXNzaWZ5IHRoZSBkcm9wbGV0cyBpbiB0aGUgbWlkZGxlIG9mIHRoZSBkaXN0cmlidXRpb24uCgotIFdlIGNhbiBhcHBseSBhIHN0YXRpc3RpY2FsIHRlc3Qgb2YgaHlwb3RoZXNpcyB0byBkZWNpZGUsIGZvciBlYWNoIGRyb3BsZXQsIGlmIGl0cyBSTkEgcHJvZmlsZSBpcyBzaWduaWZpY2FudGx5IGRpZmZlcmVudCBmcm9tIHRoZSBwcm9maWxlIG9mIGFtYmllbnQgUk5BLCBlc3RpbWF0ZWQgZnJvbSB0aGUgdmVyeSBsb3cgY291bnRzIChBYXJvbiBUTCBMdW4gZXQgYWwuIDIwMTkpLgoKLSBXZSB1c2UgYSB2ZXJ5IGxvdyB0aHJlc2hvbGQgb24gdGhlIEZhbHNlIERpc2NvdmVyeSBSYXRlIHRvIGhhdmUgdmVyeSBmZXcgZmFsc2UgcG9zaXRpdmUgY2VsbHMuCgpgYGB7cn0Kc2V0LnNlZWQoMTAwKQplLm91dCA8LSBlbXB0eURyb3BzKGNvdW50cyhzY2UpKQpzdW1tYXJ5KGUub3V0JEZEUiA8PSAwLjAwMSkKYGBgCgo8YnIvPjxici8+CgpUaGUgbGFyZ2UgbWFqb3JpdHkgb2YgZHJvcGxldHMgYXJlIG5vdCB0ZXN0ZWQsIHNpbmNlIGJ5IGRlZmF1bHQgYWxsIGRyb3BsZXRzIHdpdGggZmV3ZXIgdGhhbiAxMDAgVU1JcyBhcmUgY29uc2lkZXJlZCBlbXB0eS4KCmBgYHtyfQp0YWJsZShjb2xTdW1zKGNvdW50cyhzY2UpKT4xMDAsIGUub3V0JEZEUjw9MC4wMDEsIHVzZU5BID0gImlmYW55IikKYGBgCgo8YnIvPjxici8+CgpXZSBjYW4gbm93IHByb2NlZWQgYnkgcmVtb3ZpbmcgdGhlIGVtcHR5IGRyb3BsZXRzIGFuZCBrZWVwIG9ubHkgdGhlIG9uZXMgaWRlbnRpZmllZCB0byBiZSBjZWxscy4KCmBgYHtyfQpzY2UgPC0gc2NlWyx3aGljaChlLm91dCRGRFIgPD0gMC4wMDEpXQpzY2UKYGBgCgo8YnIvPjxici8+CgojIyBRdWFsaXR5IGNvbnRyb2wKClNvbWUgY2VsbHMgaGF2ZSBwb29yIHF1YWxpdHkgKGUuZy4sIGRhbWFnZWQgb3Igc3RyZXNzZWQgY2VsbHMpLgoKLSBFeHByZXNzaW9uIG9mIG1pdG9jaG9uZHJpYWwgZ2VuZXMsIHRvdGFsIG51bWJlciBvZiBnZW5lcyBleHByZXNzZWQsIHJlYWQgZGlzdHJpYnV0aW9uIGFjcm9zcyBnZW5lcyBhbmQgbGlicmFyeSBzaXplIGFyZSBnb29kIGluZGljYXRvcnMgZm9yIGEgY2VsbOKAmXMgcXVhbGl0eS4KCjxici8+PGJyLz4KCiMjIyBDb25jZXJucyAKCk9uZSBjb25jZXJuIGlzIHRoYXQgd2Ugd291bGQgaW5hZHZlcnRlbnRseSByZW1vdmUsIGUuZy4sIGFuIGVudGlyZSBjZWxsIHR5cGUgZnJvbSB0aGUgZG93bnN0cmVhbSBhbmFseXNpcy4gUUMgdmFyaWFibGVzIG1heSBub3QgYmUgaW5kZXBlbmRlbnQgb2YgYmlvbG9naWNhbCBzdGF0ZS4gVGhlcmUgaXMgYSB0cmFkZS1vZmYgYmV0d2VlbiBvbmx5IHdvcmtpbmcgd2l0aCBoaWdoLXF1YWxpdHkgY2VsbHMgYW5kIHJpc2sgb2YgcmVtb3ZpbmcgYmlvbG9naWNhbCBzaWduYWwuCgo8YnIvPgoKIyMjIENyaXRlcmlhCgotIEEgaGlnaC1xdWFsaXR5IGNlbGwgc2hvdWxkIGhhdmUKCiAgLSBBIGhpZ2ggbnVtYmVyIG9mIGdlbmVzIGV4cHJlc3NlZAogIC0gQSBmYWlyIGxpYnJhcnkgc2l6ZQogIC0gTm8gbWFqb3IgZXhwcmVzc2lvbiBvZiBtaXRvY2hvbmRyaWFsIGdlbmVzLCByZWxhdGl2ZSB0byBvdGhlciBnZW5lcwoKLSBCYXNlZCBvbiB0aGlzIGluZm9ybWF0aW9uLCB3ZSBjb3VsZCBzZXQgYSBmaXhlZCB0aHJlc2hvbGQsIGUuZy4sICJrZWVwIGNlbGxzIHdpdGggNDAwMCBnZW5lcyBleHByZXNzZWQsIGEgbGlicmFyeSBzaXplIG9mIGF0IGxlYXN0IDEwMDAwIGFuZCBmZXdlciB0aGFuIDUlIG9mIHRoZSB0b3RhbCBvdXRwdXQgY29taW5nIGZyb20gbWl0b2Nob25kcmlhbCBnZW5lcyIuCgogIC0gUmVxdWlyZXMgc3Vic3RhbnRpYWwgZXhwZXJpZW5jZSB3aXRoIHRoZSBiaW9sb2dpY2FsIHN5c3RlbSBhbmQgc2NSTkEtc2VxIGRhdGEsIGUuZy4sIHR1bW9ycyB0eXBpY2FsbHkgZXhwcmVzcyBhIHJlbGF0aXZlbHkgaGlnaGVyIGFtb3VudCBvZiBtaXRvY2hvbmRyaWFsIGdlbmVzLgoKLSBBIGJldHRlciBhcHByb2FjaCBpcyB0byB1c2UgYW4gYWRhcHRpdmUgdGhyZXNob2xkLgoKICAtIEFnYWluIGFzc3VtZXMgbW9zdCBjZWxscyBhcmUgaGlnaC1xdWFsaXR5IGNlbGxzICRccmlnaHRhcnJvdyQgaWRlbnRpZmljYXRpb24gb2Ygb3V0bGllcnMgYWxsb3dzIGlkZW50aWZpY2F0aW9uIG9mIGxvdy1xdWFsaXR5IGNlbGxzLgogIC0gRm9yIGV4YW1wbGUsIGZvciByZW1vdmluZyBsb3cgbGlicmFyeSBzaXplIGNlbGxzIGluIHRoZSBPU0NBIGJvb2sgdGhleSB1c2UKCiQkSShOX2kgPCBtZWRpYW4oXG1hdGhiZntOfSktMyBcdGltZXMgTUFEKFxtYXRoYmZ7Tn0pKSQkCndpdGggJE5faSQgdGhlIGxpYnJhcnkgc2l6ZSBvZiBjZWxsIGkgYW5kICRcbWF0aGJme059PVtOXzEsXGxkb3RzLE5fbV0kIHdpdGggJG0kIHRoZSBudW1iZXIgb2YgY2VsbHMuCgo8YnIvPjxici8+CgoKIyMjIEV4YW1wbGUgCgpUaGUgYHBlckNlbGxRQ01ldHJpY3NgIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHRvIGNvbXB1dGUgYSBzZXQgb2YgbWV0cmljcyB1c2VmdWwgdG8gZXZhbHVhdGUgdGhlIHF1YWxpdHkgb2YgdGhlIHNhbXBsZXMuIFRoZSBgaXNPdXRsaWVyYCBmdW5jdGlvbiB1c2VzIGEgZGF0YSBkcml2ZW4gdGhyZXNob2xkIHRvIGRlZmluZSBjZWxscyBvZiBsb3dlciBxdWFsaXR5IGNvbXBhcmVkIHRvIHRoZSByZXN0IG9mIHRoZSBkYXRhc2V0LgoKYGBge3J9CnN0YXRzIDwtIHBlckNlbGxRQ01ldHJpY3Moc2NlLAogICAgICAgICAgICBzdWJzZXRzPWxpc3QoTWl0bz13aGljaChyb3dEYXRhKHNjZSkkbG9jYXRpb249PSJNVCIpKSkKYGBgCgpIaWdoLXF1YWxpdHkgY2VsbHMgc2hvdWxkIGhhdmUgbWFueSBmZWF0dXJlcyBleHByZXNzZWQsIGFuZCBhIGxvdyBjb250cmlidXRpb24gb2YgbWl0b2Nob25kcmlhbCBnZW5lcy4gSGVyZSwgd2Ugc2VlIHRoYXQgc2V2ZXJhbCBjZWxscyBoYXZlIGEgdmVyeSBsb3cgbnVtYmVyIG9mIGV4cHJlc3NlZCBnZW5lcywgYW5kIHdoZXJlIG1vc3Qgb2YgdGhlIG1vbGVjdWxlcyBhcmUgZGVyaXZlZCBmcm9tIG1pdG9jaG9uZHJpYWwgZ2VuZXMuIFRoaXMgaW5kaWNhdGVzIGxpa2VseSBkYW1hZ2VkIGNlbGxzLCBwcmVzdW1hYmx5IGJlY2F1c2Ugb2YgbG9zcyBvZiBjeXRvcGxhc21pYyBSTkEgZnJvbSBwZXJmb3JhdGVkIGNlbGxzLCBzbyB0aGV5IGhhdmUgdG8gYmUgcmVtb3ZlZCBmb3IgdGhlIGRvd25zdHJlYW0gYW5hbHlzaXMuCgpgYGB7cn0KY29sRGF0YShzY2UpIDwtIGNiaW5kKGNvbERhdGEoc2NlKSwgc3RhdHMpCnBsb3RDb2xEYXRhKHNjZSwgeCA9ICJzdW0iLCB5PSJkZXRlY3RlZCIpCnBsb3RDb2xEYXRhKHNjZSwgeCA9ICJkZXRlY3RlZCIsIHk9InN1YnNldHNfTWl0b19wZXJjZW50IikKYGBgCgo8YnIvPgoKV2Ugbm9ybWFsbHkgcmVtb3ZlIGNlbGxzIHRoYXQgYXJlIG91dGx5aW5nIHdpdGggcmVzcGVjdCB0bwoKMS4gQSBsb3cgc2VxdWVuY2luZyBkZXB0aCAobnVtYmVyIG9mIFVNSXMpOwoyLiBBIGxvdyBudW1iZXIgb2YgZ2VuZXMgZGV0ZWN0ZWQ7CjMuIEEgaGlnaCBwZXJjZW50YWdlIG9mIHJlYWRzIGZyb20gbWl0b2Nob25kcmlhbCBnZW5lcy4KCmBgYHtyfQpsb3dGZWF0dXJlcyA8LSBpc091dGxpZXIoc3RhdHMkZGV0ZWN0ZWQsIHR5cGU9Imxvd2VyIiwgbG9nPVRSVUUpCmxvd0xpYiA8LSBpc091dGxpZXIoc3RhdHMkc3VtLCB0eXBlPSJsb3dlciIsIGxvZz1UUlVFKQpoaWdoTWl0byA8LSBpc091dGxpZXIoc3RhdHMkc3Vic2V0c19NaXRvX3BlcmNlbnQsIHR5cGU9ImhpZ2hlciIpCnRhYmxlKGxvd0ZlYXR1cmVzKQp0YWJsZShsb3dMaWIpCnRhYmxlKGhpZ2hNaXRvKQpgYGAKCjxici8+PGJyLz4KCmBgYHtyfQpkaXNjYXJkQ2VsbHMgPC0gKGxvd0xpYnxsb3dGZWF0dXJlc3xoaWdoTWl0bykKdGFibGUoZGlzY2FyZENlbGxzKQpjb2xEYXRhKHNjZSkkZGlzY2FyZENlbGxzIDwtIGRpc2NhcmRDZWxscwpgYGAKCjxici8+PGJyLz4KCmBgYHtyfQpzY2F0ZXI6OnBsb3RDb2xEYXRhKHNjZSwgeT0ic3Vic2V0c19NaXRvX3BlcmNlbnQiLAogICAgICAgIGNvbG91cl9ieT0iZGlzY2FyZENlbGxzIikKc2NhdGVyOjpwbG90Q29sRGF0YShzY2UsIHk9ImRldGVjdGVkIiwKICAgICAgICBjb2xvdXJfYnk9ImRpc2NhcmRDZWxscyIpCnNjYXRlcjo6cGxvdENvbERhdGEoc2NlLCB5PSJzdW0iLAogICAgICAgIGNvbG91cl9ieT0iZGlzY2FyZENlbGxzIikKcGxvdENvbERhdGEoc2NlLCB4ID0gImRldGVjdGVkIiwgeT0ic3Vic2V0c19NaXRvX3BlcmNlbnQiLCBjb2xvdXJfYnkgPSAiZGlzY2FyZENlbGxzIikKYGBgCgo8YnIvPjxici8+CgojIyBEZXRlY3Rpb24gYW5kIHJlbW92YWwgb2YgZG91YmxldHMKCk5vdCBhbGwgZHJvcGxldHMgY29udGFpbiBhIHNpbmdsZSBjZWxsOyBzb21lIGNvbnRhaW4gPjEgY2VsbC4KCkRvdWJsZXQgY2VsbCBjbHVzdGVycyBtYXkgYmUgbWlzdGFrZW4gZm9yIGludGVybWVkaWF0ZS90cmFuc2l0b3J5IHN0YXRlcy4KCjxici8+PGJyLz4KCiMjIyBNZXRob2RzCgoKYGBge3Igc2NEYmlGaW5kZXIsIGZpZy5jYXA9Ikdlcm1haW4gZXQgYWwuIDIwMjEsIGRvaTogMTAuMTI2ODgvZjEwMDByZXNlYXJjaC43MzYwMC4yIiwgb3V0LndpZHRoPSIxMDAlIn0Ka25pdHI6OmluY2x1ZGVfZ3JhcGhpY3MoIi4vaW1hZ2VzX3NlcXVlbmNpbmcvc2NEYmxGaW5kZXIucG5nIikKYGBgCgo8YnIvPjxici8+CgoxLiBQQ0Egb24gbG9nLW5vcm1hbGl6ZWQgZXhwcmVzc2lvbiBjb3VudHMuCjIuIFJhbmRvbWx5IHNlbGVjdCB0d28gY2VsbHMsIHN1bSB0aGVpciBjb3VudHMgYW5kIG5vcm1hbGl6ZSwgYW5kIHByb2plY3QgaW50byBQQ0Egc3BhY2UuCjMuIFJlcGVhdCBzdGVwIDIgbWFueSB0aW1lcy4KNC4gRm9yIGVhY2ggY2VsbCwgY2hlY2sgaXRzIG5laWdoYm9yaG9vZCB0byBzaW11bGF0ZWQgZG91YmxldHMgYXMgY29tcGFyZWQgdG8gb3JpZ2luYWwgY2VsbHMuCjUuIFVzZSB0aGlzIGluZm9ybWF0aW9uLCBhbG9uZyB3aXRoIG90aGVyIHByZWRpY3RvcnMsIHRvIHRyYWluIGEgY2xhc3NpZmllciBmb3IgZG91YmxldHMuCgo8YnIvPjxici8+CgojIyMgQ29uY2VybnMKCkEgcG90ZW50aWFsIGNvbmNlcm4gaXMgdGhhdCB3ZSB3b3VsZCBpbmFkdmVydGVudGx5IHJlbW92ZSBiaW9sb2dpY2FsIHNpbmdsZSBjZWxscywgdGhhdCBtYXkgaGF2ZSBlLmcuIGEgbG93IHRyYW5zY3JpcHRvbWUgY29tcGxleGl0eS4gVGhlcmUgaXMgYSB0cmFkZS1vZmYgYmV0d2VlbiBvbmx5IHdvcmtpbmcgd2l0aCBoaWdoLXF1YWxpdHkgY2VsbHMgYW5kIHJpc2sgb2YgcmVtb3ZpbmcgYmlvbG9naWNhbCBzaWduYWwuCgo8YnIvPiAKCiMjIyBFeGFtcGxlCgpgYGB7cn0KZGJsLmRlbnMgPC0gY29tcHV0ZURvdWJsZXREZW5zaXR5KHNjZSkKc2NlJERvdWJsZXRTY29yZSA8LSBkYmwuZGVucwpzdW1tYXJ5KGRibC5kZW5zKQoKZGJsLmNhbGxzIDwtIGRvdWJsZXRUaHJlc2hvbGRpbmcoZGF0YS5mcmFtZShzY29yZT1kYmwuZGVucyksCiAgICBtZXRob2Q9ImdyaWZmaXRocyIsIHJldHVyblR5cGU9ImNhbGwiKQpzdW1tYXJ5KGRibC5jYWxscykKYGBgCgo8YnIvPjxici8+CgpgYGB7cn0Kc2NlIDwtIHNjZVssIGRibC5jYWxscyA9PSAic2luZ2xldCJdCnNjZQpgYGAKCjxici8+PGJyLz4KCk5vdGUgdGhhdCwgc2ltaWxhcmx5IHRvIHdoYXQgd2UgaGF2ZSBzYWlkIGZvciB0aGUgcmVtb3ZhbCBvZiBsb3ctcXVhbGl0eSBjZWxscywgb25lIHNob3VsZCBiZSBjYXJlZnVsIGluIHJlbW92aW5nIHB1dGF0aXZlIGRvdWJsZXRzLiBJbmRlZWQsIGl0IG1heSBiZSBkaWZmaWN1bHQgdG8gZGlzdGluZ3Vpc2ggYmV0d2VlbiByYXJlIHRyYW5zaWVudCBjZWxsIHBvcHVsYXRpb25zIGFuZCBkb3VibGV0IGNlbGxzLgoKPGJyLz48YnIvPgoKIyMgTm9ybWFsaXNhdGlvbgoKTm9ybWFsaXphdGlvbiBhaW1zIHRvIHJlbW92ZSB0ZWNobmljYWwgZWZmZWN0cyBzdWNoIGFzIHNlcXVlbmNpbmcgZGVwdGggc28gdGhhdCAKCWNvbXBhcmlzb25zIGJldHdlZW4gY2VsbHMgYXJlIG5vdCBjb25mb3VuZGVkIGJ5IHRoZW0uCgpBcyBpbiBidWxrIFJOQS1zZXEsIHRoZSBtb3N0IGNvbW1vbmx5IHVzZWQgbWV0aG9kcyBhcmUgc2NhbGluZyBub3JtYWxpemF0aW9ucywgd2hlcmUgYSBzY2FsaW5nIGZhY3RvciAoYWxzbyBjYWxsZWQgc2l6ZSBmYWN0b3IsIG5vcm1hbGl6YXRpb24gZmFjdG9yKSBpcyBlc3RpbWF0ZWQgZm9yIGVhY2ggY2VsbC4KCjxici8+CgojIyMgQ29uY2VybnMKCi0gU29tZSBjZWxsIHR5cGVzIG1heSBuYXR1cmFsbHkgaGF2ZSBmZXdlciBtUk5BIG1vbGVjdWxlcyBhbmQgdGhlcmVmb3JlIGEgbG93ZXIgbGlicmFyeSBzaXplLiBSZW1vdmFsIG9mIHNlcXVlbmNpbmcgZGVwdGggZWZmZWN0cyBhY3Jvc3MgY2VsbHMgdGhlcmVmb3JlIGFsc28gcmlza3MgcmVtb3Zpbmcgc29tZSBiaW9sb2dpY2FsIHNpZ25hbC4KCQotIFRoZSBhc3N1bXB0aW9uIG9mIGEgY2VsbC1zcGVjaWZpYyBzY2FsaW5nIGZhY3RvciBpcyB0aGF0IGFueSB0ZWNobmljYWwgZWZmZWN0IGl0IHN1cHBvc2VkbHkgYWNjb3VudHMgZm9yLCBhZmZlY3RzIGFsbCBnZW5lcyBlcXVhbGx5IHRocm91Z2ggYSBzY2FsaW5nIG9mIHRoZSBtZWFuIGNvdW50LiBUaGlzIGlzIG5vdCBuZWNlc3NhcmlseSByZWFsaXN0aWMuCgotIFNjYWxpbmcgdGhlIGRhdGEgYW5kIGxvZy10cmFuc2Zvcm1pbmcgdGhlIGRhdGEgaXMgbm90IGEgZ29vZCBvcHRpb24uICBVc2Ugb2Zmc2V0cyEgCgpgYGB7ciBnbG1QQ0FGaWcyLCBmaWcuY2FwPSJUb3duZXMgZXQgYWwuIDIwMTksIERPSTogMTAuMTE4Ni9zMTMwNTktMDE5LTE4NjEtNiIsIG91dC53aWR0aD0iMTAwJSJ9CmtuaXRyOjppbmNsdWRlX2dyYXBoaWNzKCIuL2ltYWdlc19zZXF1ZW5jaW5nL2dsbVBDQUZpZzIucG5nIikKYGBgCgo8YnIvPjxici8+CgojIyMgT2Zmc2V0cwoKTGV0ICR5X3tnaX0kIGJlIHRoZSBleHByZXNzaW9uIGZvciBnZW5lICRnJCBpbiBjZWxsICRpJC4gCkFzc3VtZSwgYXMgaW4gYnVsayBSTkEtc2VxIHRoYXQgCgokRVt5X3tnaX1dID0gXG11X3tnaX0gPSAgXHBpX3tnaX0gc19pTl9pJAoKSW4gdGhlIGVkZ2VSIG1vZGVsLCAkc19pTl9pJCBpcyByZWZlcnJlZCB0byBhcyB0aGUg4oCYZWZmZWN0aXZlIGxpYnJhcnkgc2l6ZeKAmSwgd2hpY2ggaXMgdXNlZCBhcyAKCW9mZnNldCBpbiB0aGUgR0xNLCB0aGVyZWJ5IGVmZmVjdGl2ZWx5IGZvY3Vzc2luZyB0aGUgc3RhdGlzdGljYWwgaW5mZXJlbmNlIG9uICRccGlfe2dpfSQuCgpgYGB7ciBsdW5Ob3JtYWxpc2F0aW9uLCBmaWcuY2FwPSJMdW4gZXQgYWwuIDIwMTYsIERPSTogMTAuMTE4Ni9zMTMwNTktMDE2LTA5NDctNyIsIGVjaG89RkFMU0UsIG91dC53aWR0aD0iMTAwJSJ9CmtuaXRyOjppbmNsdWRlX2dyYXBoaWNzKCJpbWFnZXNfc2VxdWVuY2luZy9sdW5Ob3JtYWxpc2F0aW9uLnBuZyIpCmBgYAoKPGJyLz4KCi0gVE1NIGFuZCBERVNlcTIgbm9ybWFsaXNhdGlvbiBhcmUgbGFyZ2VseSBkcml2ZW4gYnkgYSBmZXcgZ2VuZXMgd2l0aG91dCB6ZXJvIGNvdW50cyEgCgpQb3B1bGFyLCBiZXNwb2tlIHNpbmdsZS1jZWxsIG5vcm1hbGl6YXRpb24gbWV0aG9kcyBhdHRlbXB0IHRvIGFsbGV2aWF0ZSB0aGVzZSBpc3N1ZXMuCgpgYGB7ciBsdW5Ob3JtYWxpc2F0aW9uMiwgZmlnLmNhcD0iTHVuIGV0IGFsLiAyMDE2LCBET0k6IDEwLjExODYvczEzMDU5LTAxNi0wOTQ3LTciLCBlY2hvPUZBTFNFLCBvdXQud2lkdGg9IjEwMCUifQprbml0cjo6aW5jbHVkZV9ncmFwaGljcygiaW1hZ2VzX3NlcXVlbmNpbmcvbHVuTm9ybWFsaXNhdGlvbjIucG5nIikKYGBgCgo8YnIvPjxici8+CgojIyMgRXhhbXBsZSAKCkhlcmUsIHdlIHVzZSB0aGUgc2NyYW4gbWV0aG9kIHRvIG5vcm1hbGl6ZSB0aGUgZGF0YSBmb3IgZGlmZmVyZW5jZXMgaW4gc2VxdWVuY2luZyBkZXB0aC4gVGhpcyBhcHByb2FjaCBpcyBiYXNlZCBvbiB0aGUgZGVjb252b2x1dGlvbiBvZiBzaXplIGZhY3RvcnMgZXN0aW1hdGVkIGZyb20gcG9vbHMgb2YgY2VsbHMgKEx1biBldCBhbGwuIDIwMTYpLgoKU2luY2Ugd2UgaGF2ZSBhIGhldGVyb2dlbmVvdXMgY2VsbCBwb3B1bGF0aW9uLCB3ZSBwZXJmb3JtIGEgcXVpY2sgY2x1c3RlcmluZyB0byBtYWtlIHN1cmUgdGhhdCB3ZSBwb29sIHRvZ2V0aGVyIGNlbGxzIHRoYXQgYXJlIG5vdCB0b28gZGlmZmVyZW50IGZyb20gZWFjaCBvdGhlci4KCmBgYHtyfQpsaWJyYXJ5KHNjcmFuKQpjbCA8LSBxdWlja0NsdXN0ZXIoc2NlKQp0YWJsZShjbCkKc2NlIDwtIGNvbXB1dGVTdW1GYWN0b3JzKHNjZSwgY2x1c3RlcnMgPSBjbCkKc3VtbWFyeShzaXplRmFjdG9ycyhzY2UpKQpgYGAKCjxici8+CgpXZSBjYW4gY2hlY2sgdGhhdCB0aGUgZXN0aW1hdGVkIGxpYnJhcnkgc2l6ZXMgYXJlIG5vdCB0b28gZmFyIGZyb20gdGhlIGxpYnJhcnkgc2l6ZSBmYWN0b3JzLCBlc3RpbWF0ZWQgZnJvbSB0aGUgdG90YWwgbnVtYmVyIG9mIGNvdW50cy4KCmBgYHtyfQpwbG90KGxpYnJhcnlTaXplRmFjdG9ycyhzY2UpLCBzaXplRmFjdG9ycyhzY2UpLCB4bGFiPSJMaWJyYXJ5IHNpemUgZmFjdG9yIiwKICAgIHlsYWI9IkRlY29udm9sdXRpb24gc2l6ZSBmYWN0b3IiLCBsb2c9J3h5JywgcGNoPTE2LAogICAgY29sPWFzLmludGVnZXIoZmFjdG9yKGNsKSkpCmFibGluZShhPTAsIGI9MSwgY29sPSJyZWQiKQpgYGAKCjxici8+PGJyLz4KCiMjIEZlYXR1cmUgc2VsZWN0aW9uIAoKCi0gVGhlIGN1cnNlIG9mIGRpbWVuc2lvbjogSW4gaGlnaC1kaW1lbnNpb25hbCBkYXRhLCBhbGwgZGF0YSBwb2ludHMgYXBwZWFyIHRvIGJlIGRpc3NpbWlsYXIgKGkuZS4sIHRoZXkgYXJlIGZhciBhcGFydCksIGFzIHRoZSBkYXRhIGJlY29tZSBzcGFyc2UgaW4gdGhlIGhpZ2gtZGltZW5zaW9uYWwgc3BhY2UgYXMgZGltZW5zaW9ucyBpbmNyZWFzZSAoZS5nLiwgRXVjbGlkZWFuIGRpc3RhbmNlKS4gCgotIFdoYXQgZG9lcyB0aGlzIG1lYW4gZm9yIHNjUk5BLXNlcT8gVHJ5aW5nIHRvIHJlY292ZXIgdGhlIGdsb2JhbCBzdHJ1Y3R1cmUgb2YgYSBkYXRhc2V0IHVzaW5nIGFsbCBnZW5lcyBpcyBub3QgYSBnb29kIGlkZWEuIE9mdGVuLCB3ZSBwZXJmb3JtIGEgdmFyaWFibGUgc2VsZWN0aW9uIHN0ZXAsIHNlbGVjdGluZyBnZW5lcyB3aGljaCB3ZSBiZWxpZXZlIHRvIGJlIGhpZ2hseSBpbmZvcm1hdGl2ZSBmb3IgYSBkYXRhc2V04oCZcyBzdHJ1Y3R1cmUuIE9uZSBtYXkgdmlldyB0aGlzIGFzIGEgZmlyc3Qgc2ltcGxlIHN0ZXAgb2YgZGltZW5zaW9uIHJlZHVjdGlvbi4KCldlIHdpbGwgdGh1cyBzZWxlY3QgZ2VuZXMgd2hpY2ggd2UgaG9wZSBhcmUgaW5mb3JtYXRpdmUgZm9yIHJlY292ZXJpbmcgdGhlIGJpb2xvZ2ljYWwgc3RydWN0dXJlLiBQcmlvciB0byB2aXN1YWxpc2F0aW9uLgoKPGJyLz4KCiMjIyBDb25jZXJucwoKRmVhdHVyZSBzZWxlY3Rpb24gaXMgY3J1Y2lhbCBmb3IgZGltZW5zaW9uIHJlZHVjdGlvbi4gSG93ZXZlciwgaXQgcmVtYWlucyBzdWJqZWN0aXZlIGFuZCB0aGVyZSBhcmUgbm8gY2xlYXIgZ3VpZGVsaW5lcyB0byBmb2xsb3cuIFRoZSBhbW91bnQgb2YgZmVhdHVyZXMgdG8gc2VsZWN0IGRlcGVuZHMgb24gdGhlIGNvbXBsZXhpdHkgb2YgeW91ciBkYXRhc2V0LCBhbmQgdGhlIGluZm9ybWF0aXZlbmVzcyBvZiBlYWNoIGluZGl2aWR1YWwgZmVhdHVyZS4KCk1hbnkgaXNzdWVzIHJlbWFpbi4gCgo8YnIvPjxici8+CgojIyMgV2hhdCBkZWZpbmVzIGFuIGluZm9ybWF0aXZlIGdlbmU/CgotIEdlbmVzIHRoYXQgYXJlIG5vdCBleHByZXNzZWQgaW4gYW55IGNlbGwgYXJlIG9idmlvdXNseSB1bmluZm9ybWF0aXZlLiAKCi0gTmVpdGhlciBhcmUgZ2VuZXMgdGhhdCAKCWFyZSBoaWdobHkgZXhwcmVzc2VkIGF0IGEgc2ltaWxhciBsZXZlbCBpbiBhbGwgY2VsbHMuIFNvIHdoYXQgc2hvdWxkIHdlIGJlIGxvb2tpbmcgZm9yPwoKLSBHZW5lcyB3aXRoIGhpZ2ggdmFyaWFuY2UuIEJ1dCBub3RlIG91ciBwcmV2aW91cyBvYnNlcnZhdGlvbnMgb24gdGhlIG1lYW4tdmFyaWFuY2UgcmVsYXRpb25zaGlwLiAKCi0gU2ltcGx5IHNlbGVjdGluZyBmZWF0dXJlcyBvbiBoaWdoIHZhcmlhbmNlIGlzIGNvbW1vbiwgYnV0IHBvc3NpYmx5IG5vdCBvcHRpbWFsLgoKLSBHZW5lcyB3aXRoIGhpZ2ggdmFyaWFuY2UgcmVsYXRpdmUgdG8gdGhlaXIgbWVhbi4gQSAocmlnaHRseSBzbykgcG9wdWxhciBhcHByb2FjaCBpcyB0byBzZWxlY3QgZ2VuZXMgdGhhdCBoYXZlIGEgaGlnaCB2YXJpYW5jZSB3aXRoIHJlc3BlY3QgdG8gdGhlaXIgbWVhbi4gT2Z0ZW4sIGZpcnN0IGFuIGVtcGlyaWNhbCBtZWFuLXZhcmlhbmNlIHRyZW5kIGlzIGZpdHRlZCwgdXBvbiB3aGljaCBnZW5lcyB3aXRoIHRoZSBoaWdoZXN0IHBvc2l0aXZlIHJlc2lkdWFscyBhcmUgc2VsZWN0ZWQuIEJlaW5nIGludHVpdGl2ZSwgcmVhc29uYWJsZSBhbmQgZmFpcmx5IHN0cmFpZ2h0LWZvcndhcmQsIHRoaXMgbWV0aG9kIGlzIHdpZGVseSB1c2VkLgoKLSBHZW5lcyB3aXRoIGhpZ2ggZGV2aWFuY2UuIFNlZSBUb3duZXMgZXQgYWwuICgyMDE5KSBmb3IgZmVhdHVyZSBzZWxlY3Rpb24gYmFzZWQgb24gQmlub21pYWwgZGV2aWFuY2UuIEdlbmVzIHdpdGggYSBoaWdoIGRldmlhbmNlIHdpbGwgbW9zdCBwb29ybHkgZml0IGEgbnVsbCBtb2RlbCB3aGVyZSB0aGUgcmVsYXRpdmUgYWJ1bmRhbmNlIGlzIGVxdWFsIGZvciBhbGwgY2VsbHMsIHdoaWNoIHRoZXJlZm9yZSBhcmUgaW5mb3JtYXRpdmUuCgo8YnIvPjxici8+CgojIyMgRXhhbXBsZTogZmVhdHVyZSBzZWxlY3Rpb24gYmFzZWQgb24gaGlnaCB2YXJpYW5jZSB3cnQgbWVhbgoKWW91IG5lZWQgYW4gYXNzYXkgbG9nIGNvdW50cyBmb3IgdGhpcy4gCgpgYGB7cn0Kc2NlIDwtIGxvZ05vcm1Db3VudHMoc2NlKQpkZWMgPC0gbW9kZWxHZW5lVmFyKHNjZSkKdmFyZml0IDwtIG1ldGFkYXRhKGRlYykKcGxvdCh2YXJmaXQkbWVhbiwgdmFyZml0JHZhciwgCiAgICAgeGxhYj0iTWVhbiBvZiBsb2ctZXhwcmVzc2lvbiIsCiAgICB5bGFiPSJWYXJpYW5jZSBvZiBsb2ctZXhwcmVzc2lvbiIpCmN1cnZlKHZhcmZpdCR0cmVuZCh4KSwgY29sPSJkb2RnZXJibHVlIiwgYWRkPVRSVUUsIGx3ZD0yKQpgYGAKCjxici8+PGJyLz4KClNlbGVjdCBoaWdobHkgdmFyaWFibGUgZ2VuZXMgd2l0aCB2YXJpYW5jZSBsYXJnZXIgdGhhbiBleHBlY3RlZCBiYXNlZCBvbiB0aGUgbWVhbiB2YXJpYW5jZSB0cmVuZC4gV2UgdGhlbiBoYXZlIHRvIHNlbGVjdCB0aGUgdG9wIG51bWJlciBvZiBtb3N0IHZhcmlhYmxlIGdlbmVzLiBXZSBjYW4gZm9yIGluc3RhbmNlIHRha2UgdGhlIHRvcCAxMCUgb2YgdGhlIG1vc3QgdmFyaWFibGUgZ2VuZXMKCmBgYHtyfQpodmcgPC0gZ2V0VG9wSFZHcyhkZWMsIHByb3A9MC4xKQpoZWFkKGh2ZykKCnBsb3QodmFyZml0JG1lYW4sIHZhcmZpdCR2YXIsIAogICAgIGNvbCA9IGMoIm9yYW5nZSIsICJkYXJrc2VhZ3JlZW4zIilbKG5hbWVzKHZhcmZpdCRtZWFuKSAlaW4lIGh2ZykrMV0sCiAgICAgeGxhYj0iTWVhbiBvZiBsb2ctZXhwcmVzc2lvbiIsCiAgICB5bGFiPSJWYXJpYW5jZSBvZiBsb2ctZXhwcmVzc2lvbiIpCmN1cnZlKHZhcmZpdCR0cmVuZCh4KSwgY29sPSJkb2RnZXJibHVlIiwgYWRkPVRSVUUsIGx3ZD0yKQpsZWdlbmQoInRvcGxlZnQiLCAKICAgICAgIGxlZ2VuZCA9IGMoIlNlbGVjdGVkIiwgIk5vdCBzZWxlY3RlZCIpLCAKICAgICAgIGNvbCA9IGMoImRhcmtzZWFncmVlbjMiLCAib3JhbmdlIiksCiAgICAgICBwY2ggPSAxNiwKICAgICAgIGJ0eT0nbicpCmBgYAoKPGJyLz48YnIvPgoKCiMjIyBHZW5lcyB3aXRoIGhpZ2ggZGV2aWFuY2UKClNlZSBUb3duZXMgZXQgYWwuICgyMDE5KSBmb3IgZmVhdHVyZSBzZWxlY3Rpb24gYmFzZWQgb24gCglCaW5vbWlhbCBkZXZpYW5jZS4gR2VuZXMgd2l0aCBhIGhpZ2ggZGV2aWFuY2Ugd2lsbCBtb3N0IHBvb3JseSBmaXQgYSBudWxsIG1vZGVsIHdoZXJlIHRoZSByZWxhdGl2ZSBhYnVuZGFuY2UgaXMgZXF1YWwgZm9yIGFsbCBjZWxscywgd2hpY2ggdGhlcmVmb3JlIGFyZSBpbmZvcm1hdGl2ZS4KCQpOb3RlIHRoYXQgdGhlIGRldmlhbmNlIGZvciBhIEdMTSAgaXMgZGVmaW5lZCBhczogCgokJApEID0gMiBbbChcbWF0aGJme3l9LFxtYXRoYmZ7eX0pIC0gbChcbWF0aGJme3l9LFxoYXR7XG1hdGhiZntcbXV9fSldCiQkCgp3aGljaCBpcyBmb2xsb3dzIGEgJFxjaGleMiQgZGlzdHJpYnV0aW9uIHdpdGggbiBkZWdyZWVzIG9mIGZyZWVkb20uIEluZGVlZCwgaXQgaXMgYSBMUiB0ZXN0IGJldHdlZW4gdGhlIGJlc3QgbW9kZWwgd2l0aCBhIHBlcmZlY3QgbW9kZWwgZml0IGFuZCB0aGUgY3VycmVudCBtb2RlbC4gCgpJZiB0aGUgZGlmZmVyZW5jZSBpcyBzaWduaWZpY2FudCwgdGhlcmUgaXMgbGFjayBvZiBmaXQuCgpgYGB7ciBnbG1QQ0FEZXZpYW5jZSwgZmlnLmNhcD0iVG93bmVzIGV0IGFsLiAyMDE5LCBET0k6IDEwLjExODYvczEzMDU5LTAxOS0xODYxLTYiLCBvdXQud2lkdGg9IjUwJSIsZWNobz1GQUxTRX0Ka25pdHI6OmluY2x1ZGVfZ3JhcGhpY3MoIi4vaW1hZ2VzX3NlcXVlbmNpbmcvZ2xtUENBRGV2aWFuY2UucG5nIikKYGBgCgo8YnIvPjxici8+CgojIyMgVmFyaWFuY2Utc3RhYmlsaXppbmcgdHJhbnNmb3JtYXRpb24gKFZTVCkgdXNpbmcgUGVhcnNvbiByZXNpZHVhbHMKCkxhdXNlIGV0IGFsLiAyMDIxIGludHJvZHVjZWQgdGhlIHVzZSBvZiBQZWFyc29uIHJlc2lkdWFscyB0byBzdGFiaWxpemUgdGhlIHZhcmlhbmNlIChkb2k6IDEwLjExODYvczEzMDU5LTAyMS0wMjQ1MS03KS4gCgotIFdoZW4gYSBtb2RlbCBpcyBmaXR0ZWQgdG8gZWFjaCBnZW5lIHdlIGNhbiBjb25zdHJ1Y3QgcGVhcnNvbiByZXNpZHVhbHMgdGhhdCBjb3JyZWN0IGZvciB0aGUgbWVhbiB2YXJpYW5jZSByZWxhdGlvbi4gCgotIEhlcmUgd2UgbW9kZWwgJHlfe2lnfSBcc2ltIE5CKFxtdV97aWd9PVxwaV9nc19pTl9pLFxwaGlfZykkIAotIFBlYXJzb24gcmVzaWR1YWxzIGFyZSB0aGVuIGRlZmluZWQgYXMgCgokJAplX2kgPSBcZnJhY3t5X3tpZ30gLSBcbXVfe2d9fXtcc3FydHtcbXVfe2d9ICsgXHBoaVxtdV97Z31eMn19IAokJAoKSW5kZWVkLCB0aGUgcmVzaWR1YWxzIGFyZSBjb3JyZWN0ZWQgZm9yIHRoZSBtZWFuIHZhcmlhbmNlIHJlbGF0aW9uc2hpcC4KCldlIGNhbiB0aGVuIGFzc2VzcyBpZiB0aGUgcmVzaWR1YWxzIGV4aGliaXQgb3ZlciBleGNlc3MgIHZhcmlhbmNlIHdpdGggcmVzcGVjdCB0byB0aGUgdHJlbmQuIElmIHRoaXMgaXMgdGhlIGNhc2UsIHRoZSBnZW5lIGlzIGluZm9ybWF0aXZlLiBUaGVyZSBpcyBtb3JlIHZhcmlhbmNlIHRoYW4gd2UgZXhwZWN0IHVuZGVyIHRoZSBpbnRlcmNlcHQgbW9kZWwuCgokJApcaGF0XHNpZ21hXjIgPSBcc3VtXGxpbWl0c197aT0xfV5uIFxmcmFje2VfaV4yfXtuLXB9CiQkCk5vdGUsIHRoYXQgdGhpcyBvbmUgb2YgdGhlIHZhcmlhbmNlIGVzdGltYXRvciBvZiB0aGUgcXVhc2ktbmVnYXRpdmUgYmlub21pYWwgbW9kZWwgKFNlZSBMdW5kIGV0IGFsLiwgMjAxMiwgRE9JIDEwLjE1MTUvMTU0NC02MTE1LjE4MjYpLiAKCkdlbmVzIHdpdGggaGlnaCB2YXJpYW5jZSBhcmUgaW5mb3JtYXRpdmUuIAoKTm90ZSwgdGhhdCB0aGVyZSBpcyBhbHNvIGEgY2xvc2UgY29ubmVjdGlvbiB0byB0aGUgbWV0aG9kIG9mIFRvd25lcy4gQW5vdGhlciB0eXBlIG9mIHJlc2lkdWFscyBmb3IgR0xNcyBhcmUgZGV2aWFuY2UgcmVzaWR1YWxzLCBpLmUuIAoKJCQKZV9pXmQgPSBcc3FydHsyIFtsKHlfe2lnfSx5X3tpZ30pLWwoeV97aWd9LFxoYXRcbXVfe2lnfSldfQokJAoKQW5vdGhlciB2YXJpYW5jZSBlc3RpbWF0b3IgaXMgCgokJApcaGF0XHNpZ21hXjIgPSBcc3VtXGxpbWl0c197aT0xfV5uIFxmcmFjeyhlX2leZCleMn17bi1wfSA9IFxmcmFje0R9e24tcH0KJCQKTm90ZSwgdGhhdCB0aGlzIGlzIHRoZSBvdGhlciBleGNlc3MgdmFyaWFuY2UgZXN0aW1hdG9yIGZvciB0aGUgcXVhc2ktbmVnYXRpdmUgYmlub21pYWwgbW9kZWwuIFNlZSBMdW5kIGV0IGFsLiwgMjAxMiAoRE9JIDEwLjE1MTUvMTU0NC02MTE1LjE4MjYpLiAKCjxici8+PGJyLz4KCiMjIERpbWVuc2lvbiByZWR1Y3Rpb24gCgpXZSB3b3VsZCBsaWtlIHRvIGJlIGFibGUgdG8gcHJvamVjdCB0aGUgZGF0YSB0byBhIGxvdy1kaW1lbnNpb25hbCBzcGFjZSwgd2hpbGUgCnJldGFpbmluZyBhcyBtdWNoIGluZm9ybWF0aW9uIGFzIHBvc3NpYmxlLiBUaGlzIHdpbGwgYmUgdXNlZnVsIGRvd25zdHJlYW0gZm9yLCBlLmcuLCAKIHZpc3VhbGl6YXRpb24sIGlkZW50aWZpY2F0aW9uIG9mIGJhdGNoIGVmZmVjdHMsIGNsdXN0ZXJpbmcsIHRyYWplY3RvcnkgaW5mZXJlbmNlLgogCk1hbnkgZGltZW5zaW9uIHJlZHVjdGlvbiBtZXRob2RzIGV4aXN0IGFuZCB0aGlzIGlzIGEgdmVyeSBhY3RpdmUgYXJlYSBvZiByZXNlYXJjaCBpbiBzY1JOQS1zZXEuIFdlIHdpbGwgZGlzY3VzcyB0aGUgbW9zdCBjb21tb24gbWV0aG9kcyBzdWNoIGFzIFBDQSwgR0xNLVBDQSwgdC1TTkUgYW5kIFVNQVAuCgo8YnIvPgoKIyMjIENvbmNlcm5zCgpMaWtlIGZlYXR1cmUgc2VsZWN0aW9uLCB0aGlzIHJlbWFpbnMgYSBzdWJqZWN0aXZlIHN0ZXAgaW4gdGhlIGFuYWx5c2lzLiBTZXZlcmFsIGNob2ljZXMgaGF2ZSB0byBiZSBtYWRlOiBpbnB1dCBkYXRhLCBlLmcuLCBsb2ctdHJhbnNmb3JtZWQgZGF0YSBvciBub3Q/OyBudW1iZXIgb2YgY29tcG9uZW50cyB0byByZXRhaW47CiBwYXJhbWV0ZXIgdHVuaW5nOyBldGMuLgoKPGJyLz48YnIvPgoKIyMjIFByaW5jaXBhbCBDb21wb25lbnQgQW5hbHlzaXMgCgotIEEgRFIgbWV0aG9kIGlzIGxpbmVhciB3aGVuIHRoZSByZWR1Y2VkIGRpbWVuc2lvbnMgYXJlIGEgbGluZWFyIGZ1bmN0aW9uIG9mIHRoZSBvcmlnaW5hbCB2YXJpYWJsZXMuIAoKLSBJbiBQQ0EsIGVhY2ggcHJpbmNpcGFsIGNvbXBvbmVudCBpcyBhIGxpbmVhciBjb21iaW5hdGlvbiBvZiBnZW5lcy4gClNlZSBoZXJlIGZvciBhIFtnZW9tZXRyaWMgaW50ZXJwcmV0YXRpb24gb2YgUENBXShodHRwczovL3N0YXRvbWljcy5naXRodWIuaW8vSEREQS9zdmQuaHRtbCMzX0dlb21ldHJpY19pbnRlcnByZXRhdGlvbikgYW5kIGZvciBhIFtQQ0EgZGV0YWlsc10oaHR0cHM6Ly9zdGF0b21pY3MuZ2l0aHViLmlvL0hEREEvc3ZkLmh0bWwjOF9TVkRfYW5kX3ByaW5jaXBhbF9jb21wb25lbnRfYW5hbHlzaXNfKFBDQSkpCgotIFR5cGljYWxseSwgUENBIGlzIHBlcmZvcm1lZCBvbiBsb2ctdHJhbnNmb3JtZWQgbm9ybWFsaXplZCBjb3VudHMuIApUaGUgbG9nLXRyYW5zZm9ybWF0aW9uIGhlbHBzIHNvbWV3aGF0LCBidXQgbm90IGNvbXBsZXRlbHksIHRvIGFjY291bnQgZm9yIHRoZSBtZWFuLXZhcmlhbmNlIHJlbGF0aW9uc2hpcC4KCi0gUENBIHdvcmtzIHdlbGwgZm9yIGJ1bGsgUk5BLXNlcSBkYXRhLiBIb3dldmVyLCB0aGUgc3RydWN0dXJlIG9mIHNjUk5BLXNlcSBkYXRhIGlzIG9mdGVuIAoJdG9vIGNvbXBsZXggdG8gYmUgdmlzdWFsaXplZCBieSBhIHNtYWxsIG51bWJlciBvZiBQQ3MuCgo8YnIvPjxici8+CgojIyMjIEV4YW1wbGUgCgpXZSBkbyBQQ0Egb24gdGhlIGhpZ2hseSB2YXJpYWJsZSBnZW5lcy4gCgpgYGB7cn0Kc2NlIDwtIHJ1blBDQShzY2UsIHN1YnNldF9yb3cgPSBodmcpCnBsb3RQQ0Eoc2NlKQpgYGAKCk5vdGUgdGhhdCB0aGUgc3Vic2V0X3JvdyBhcmd1bWVudCBlbnN1cmVzIHRoYXQgd2UgdXNlIHRoZSBwcmV2aW91c2x5IHNlbGVjdGVkIEhWR3MgdG8gY29tcHV0ZSB0aGUgUENzLiBBbHNvIG5vdGUgdGhhdCBieSBkZWZhdWx0IHJ1blBDQSB3aWxsIHN0b3JlIHRoZSBQQ3MgaW4gdGhlIFBDQSBzbG90LCBoZW5jZSBvdmVyd3JpdGluZyB0aGUgcHJldmlvdXMgUENzLiBJbiB0aGUgdHV0b3JpYWxzIHdlIHdpbGwgc2VlIHRoYXQgd2UgYWxyZWFkeSB1c2UgUENBIGR1cmluZyB0aGUgUUMgZm9yIHZpc3VhbGlzYXRpb24gcHVycG9zZXMuIFRoZXNlIHJlc3VsdHMgYXJlIGJhc2VkIG9uIGEgcXVpY2sgbm9ybWFsaXphdGlvbiBhbmQgcHJpb3IgdG8gcmVtb3Zpbmcgbm9pc3kgZ2VuZXMgYW5kIGNlbGxzLiBIZW5jZSwgaXQgaXMgb2sgdG8gb3ZlcndyaXRlIHRoZW0uIEluIG90aGVyIGNhc2VzLCBpdCBtYXkgYmUgcmVhc29uYWJsZSB0byBrZWVwIG1vcmUgdGhhbiBvbmUgc2V0IG9mIFBDczogdGhpcyBjYW4gYmUgYWNoaWV2ZWQgYnkgc3BlY2lmeWluZyBhIGRpZmZlcmVudCBzbG90IG5hbWUgdmlhIHRoZSBuYW1lIGFyZ3VtZW50LgoKRmluYWxseSwgbm90ZSB0aGF0IGJ5IGRlZmF1bHQgc2NhdGVyIHdpbGwgY29tcHV0ZSB0aGUgdG9wIDUwIFBDcy4gVGhpcyBpcyBhIHJlYXNvbmFibGUgY2hvaWNlLCBidXQgaXQgbWF5IGJlIGEgZ29vZCBpZGVhIHRvIGV4cGxvcmUgdGhlIHZhcmlhbmNlIGV4cGxhaW5lZCBieSBlYWNoIGNvbXBvbmVudCB0byBkZWNpZGUgdGhlIG51bWJlciBvZiBjb21wb25lbnRzIHRvIHJldGFpbi4gQW4gYWx0ZXJuYXRpdmUgaXMgdG8gdXNlIHRoZSBkZW5vaXNlUENBIGZ1bmN0aW9uIGZyb20gc2NyYW4gdGhhdCBhaW1zIGF0IHNlbGVjdGluZyB0aGUgbnVtYmVyIG9mIFBDcyB0aGF0IGV4cGxhaW4gYmlvbG9naWNhbCB2YXJpYWJpbGl0eS4KCjxici8+PGJyLz4KCiMjIyBHTE0tUENBCgpBIGdlbmVyYWxpemF0aW9uIG9mIFBDQSB0byBleHBvbmVudGlhbCBmYW1pbHkgZGlzdHJpYnV0aW9ucyBpcyBwcm92aWRlIGJ5IFRvd25lcyBldCBhbC4gMjAxOS4KUENBIGlzIGJhc2VkIG9uIHNxdWFyZWQvRXVjbGlkZWFuIGRpc3RhbmNlcyAoZS5nLlRvd25lcyBldCBhbC4gMjAxOSksIHdoaWNoIGhhcyBhIGNsb3NlIGxpbmsgdG8gR2F1c3NpYW4gbGlrZWxpaG9vZCwgd2hpY2ggaXMgaW5hcHByb3ByaWF0ZSBmb3IgY291bnQgZGF0YSBkdWUgdG8gdGhlIG1lYW4tdmFyaWFuY2UgcmVsYXRpb25zaGlwLiAKVGhlcmVmb3JlLCBQQ0EgcmVzdWx0cyByaXNrcyB0byBiZSBkb21pbmF0ZWQgYnkgaGlnaGx5IGV4cHJlc3NlZCBnZW5lcywgd2hpY2ggaGF2ZSBsYXJnZSB2YXJpYW5jZS4gCgpgYGB7ciBnbG1QQ0FGaWcyUmVwLCBmaWcuY2FwPSJUb3duZXMgZXQgYWwuIDIwMTksIERPSTogMTAuMTE4Ni9zMTMwNTktMDE5LTE4NjEtNiIsIGVjaG89RkFMU0UsIG91dC53aWR0aD0iMTAwJSJ9CmtuaXRyOjppbmNsdWRlX2dyYXBoaWNzKCIuL2ltYWdlc19zZXF1ZW5jaW5nL2dsbVBDQUZpZzIucG5nIikKYGBgCgo8YnIvPgoKVGhleSBhcmd1ZSB0aGF0IFVNSSBkYXRhIGFyZSBtdWx0aW5vbWlhbGx5IGRpc3RyaWJ1dGVkLCB3aGljaCBjYW4gYmUgYXBwcm94aW1hdGVkIGJ5IGEgUG9pc3NvbiBkaXN0cmlidXRpb24gd2hlbiBjb25kaXRpb25pbmcgb24gdGhlIGxpYnJhcnkgc2l6ZSBhbmQgcHJvcG9zZSBhIGdlbmVyYWxpc2F0aW9uIG9mIFBDQS4gCgpgYGB7ciBnbG1QQ0FEZXJpdiwgZmlnLmNhcD0iVG93bmVzIGV0IGFsLiAyMDE5LCBET0k6IDEwLjExODYvczEzMDU5LTAxOS0xODYxLTYiLCBvdXQud2lkdGggPSAiNTAlIixlY2hvPUZBTFNFfQprbml0cjo6aW5jbHVkZV9ncmFwaGljcygiLi9pbWFnZXNfc2VxdWVuY2luZy9nbG1QQ0FEZXJpdmF0aW9uLnBuZyIpCmBgYAoKPGJyLz48YnIvPgoKYGBge3IgZ2xtUENBT25EZXZSZXNpZHMsIGZpZy5jYXA9IlRvd25lcyBldCBhbC4gMjAxOSwgRE9JOiAxMC4xMTg2L3MxMzA1OS0wMTktMTg2MS02IiwgZWNobz1GQUxTRSwgb3V0LndpZHRoPSI4MCUifQprbml0cjo6aW5jbHVkZV9ncmFwaGljcygiLi9pbWFnZXNfc2VxdWVuY2luZy9nbG1QQ0FfT25EZXZpYW5jZVJlc2lkdWFscy5wbmciKQpgYGAKCjxici8+PGJyLz4KCi0gTm90ZSwgdGhhdCBmdWxsIGxlbmd0aCBwbGF0ZSBiYXNlZCBkYXRhIHNjUk5BLXNlcSBkYXRhIGFyZSBvdmVyIGRpc3BlcnNlIHdpdGggcmVzcGVjdCB0byB0aGUgUG9pc3NvbiBkaXN0cmlidXRpb24gYW5kIHRoZXJlZm9yZSBOQi1QQ0Egd291bGQgYmUgYmV0dGVyLgoKPGJyLz48YnIvPgoKIyMjIEdMTS1QQ0EgRXhhbXBsZSAKCkdMTS1QQ0EgaXMgaW1wbGVtZW50ZWQgaW4gdGhlIGBzY3J5YCBCaW9jb25kdWN0b3IgcGFja2FnZTsgaXQgdXNlcyBhIFBvaXNzb24gbW9kZWwgYnkgZGVmYXVsdCwgYnV0IHRoaXMgY2FuIGJlIGNoYW5nZWQgdG8gdXNlIG5lZ2F0aXZlIGJpbm9taWFsLCBtdWx0aW5vbWlhbCBvciBiaW5vbWlhbC4KClVubGlrZSBydW5QQ0EsIHRoZSBHTE0tUENBIGZ1bmN0aW9uIGRvZXMgbm90IGFsbG93IGZvciBhIHNlbGVjdGlvbiBvZiBnZW5lcy4gSGVuY2UsIHdlIHdpbGwgZmlyc3QgY3JlYXRlIGEgZmlsdGVyZWQgU2luZ2xlQ2VsbEV4cGVyaW1lbnQgb2JqZWN0IHRoYXQgY29udGFpbnMgb25seSB0aGUgSFZHcy4KClNpbWlsYXJseSB0byBQQ0EsIEdMTS1QQ0EgbmVlZHMgdGhlIG51bWJlciBvZiBjb21wb25lbnRzIChmYWN0b3JzKSB0aGF0IG5lZWQgdG8gYmUgY2FsY3VsYXRlZC4gSGVyZSwgd2UgY29tcHV0ZSAxMCBsYXRlbnQgZmFjdG9ycy4KCldlIHVzZSB0aGUgbWluaWJhdGNoIGFyZ3VtZW50IHRvIHVzZSBvbmx5IGEgcmFuZG9tIHN1YnNldCBvZiBvYnNlcnZhdGlvbnMgdG8gY29tcHV0ZSB0aGUgZ3JhZGllbnQgaW4gdGhlIG9wdGltaXphdGlvbiBhbGdvcml0aG0uIFRoaXMgc3BlZWRzIHVwIGNvbXB1dGF0aW9ucyBhbmQgYXZvaWRzIG1lbW9yeSBwcm9ibGVtcyBpbiBiaWcgZGF0YXNldHMuCgpgYGB7ciBlY2hvPUZBTFNFLCB3YXJuaW5nPUZBTFNFLCBtZXNzYWdlPUZBTFNFfQpzdXBwcmVzc1BhY2thZ2VTdGFydHVwTWVzc2FnZXMoewogIGlmKCEiTmV3V2F2ZSIgJWluJSBpbnN0YWxsZWQucGFja2FnZXMoKVssMV0pIEJpb2NNYW5hZ2VyOjppbnN0YWxsKCJOZXdXYXZlIikKICBpZighInNjcnkiICVpbiUgaW5zdGFsbGVkLnBhY2thZ2VzKClbLDFdKSBCaW9jTWFuYWdlcjo6aW5zdGFsbCgic2NyeSIpCn0pCmBgYAoKPGJyLz4KCmBgYHtyfQpzdXBwcmVzc1BhY2thZ2VTdGFydHVwTWVzc2FnZXMoewogIGxpYnJhcnkoc2NyeSkKfSkKc2V0LnNlZWQoMTAwMDAwKQpmaWx0ZXJlZCA8LSBzY2VbaHZnLF0KZmlsdGVyZWQgPC0gR0xNUENBKGZpbHRlcmVkLCBMPTEwLCBtaW5pYmF0Y2ggPSAic3RvY2hhc3RpYyIpCmZpbHRlcmVkCmBgYAoKPGJyLz4KClRvIHZpc3VhbGl6ZSB0aGUgZmlyc3QgdHdvIGNvbXBvbmVudHMgb2YgR0xNLVBDQSwgd2UgY2FuIHVzZSB0aGUgcGxvdFJlZHVjZWREaW0gZnVuY3Rpb24gZnJvbSBgc2NhdGVyYC4KCmBgYHtyfQpwbG90UmVkdWNlZERpbShmaWx0ZXJlZCwgIkdMTVBDQSIpCmBgYAoKPGJyLz48YnIvPgoKIyMjIE5ld1dhdmUKCkFuIGFsdGVybmF0aXZlIG1ldGhvZCBpcyBpbXBsZW1lbnRlZCBpbiB0aGUgTmV3V2F2ZSBwYWNrYWdlLCB3aGljaCBpbXBsZW1lbnRzIGEgbmVnYXRpdmUgYmlub21pYWwgZmFjdG9yIGFuYWx5c2lzIG1vZGVsIGFuZCB1c2VzIGEgcGVuYWxpemVkIGxpa2VsaWhvb2QgdG8gZXN0aW1hdGUgdGhlIGxhdGVudCBmYWN0b3JzIChBZ29zdGluaXMgZXQgYWwuIDIwMjIgRE9JOiAxMC4xMDkzL2Jpb2luZm9ybWF0aWNzL2J0YWMxNDkpLiAKCjxici8+CgojIyMjIE5ld1dhdmUgRXhhbXBsZQoKTmV3V2F2ZSBjYW4gYWxzbyB1c2UgbWluaWJhdGNoZXMsIGFuZCBpZiBtdWx0aXBsZSBDUFVzIGFyZSBhdmFpbGFibGUgcGFyYWxsZWwgY29tcHV0aW5nLCB0byBzcGVlZCB1cCBjb21wdXRhdGlvbnMuIFRoZSBuX2dlbmVfcGFyLCBuX2NlbGxfcGFyLCBhbmQgbl9nZW5lX2Rpc3AgYXJndW1lbnRzIGFsbG93IHRoZSB1c2VyIHRvIGNob29zZSBob3cgbWFueSBvYnNlcnZhdGlvbnMgdG8gdXNlIHRvIGVzdGltYXRlIHRoZSBnZW5lLSBhbmQgY2VsbC1zcGVjaWZpYyBwYXJhbWV0ZXJzLiBUaGUgY2hpbGRyZW4gYXJndW1lbnQgYWxsb3dzIG9uZSB0byB1c2UgbXVsdGlwbGUgY29yZXM7IGhlcmUgd2UgdXNlIGZvdXIsIGJ1dCB5b3Ugc2hvdWxkIGNoYW5nZSBpdCBkZXBlbmRpbmcgb24gaG93IG1hbnkgY29yZXMgeW91ciBjb21wdXRlciBoYXMgKHNlZSBwYXJhbGxlbDo6ZGV0ZWN0Q29yZXMoKSkuCgoKYGBge3J9CnN1cHByZXNzUGFja2FnZVN0YXJ0dXBNZXNzYWdlcyh7CiAgbGlicmFyeShOZXdXYXZlKQp9KQpzZXQuc2VlZCgxMDAwMDApCmZpbHRlcmVkIDwtIG5ld1dhdmUoZmlsdGVyZWQsIEs9MTAsIGNoaWxkcmVuPTQsCiAgICAgICAgICAgICAgICAgICAgbl9nZW5lX2Rpc3AgPSAxMDAsIG5fZ2VuZV9wYXIgPSAxMDAsIAogICAgICAgICAgICAgICAgICAgIG5fY2VsbF9wYXIgPSAxMDApCmZpbHRlcmVkCnBsb3RSZWR1Y2VkRGltKGZpbHRlcmVkLCAibmV3V2F2ZSIpCmBgYAoKPGJyLz48YnIvPgoKIyMjIFRTTkUgYW5kIFVNQVAKCi0gTm9uLWxpbmVhciBkaW1lbnNpb24gcmVkdWN0aW9uIG1ldGhvZHMKCi0gVmlzdWFsaXphdGlvbnMgb2YgcmVkdWNlZCBkaW1lbnNpb25zIGZyb20gbGluZWFyIGRpbWVuc2lvbiByZWR1Y3Rpb24gbWV0aG9kcyBhcmUgb2Z0ZW4gCgnigJhvdmVyY3Jvd2RlZOKAmSwgYW5kIGl0IGlzIGhhcmQgdG8gc2VlIHN0cnVjdHVyZS4KCi0gTm9uLWxpbmVhciBkaW1lbnNpb24gcmVkdWN0aW9uIG1ldGhvZHMgY2FuIG92ZXJjb21lIHRoaXMgcHJvYmxlbS4gQXMgdGhlIG5hbWUgc3VnZ2VzdHMsIHRoZSByZWR1Y2VkIGRpbWVuc2lvbnMgYXJlIGEgbm9uLWxpbmVhciBmdW5jdGlvbiBvZiB0aGUgb2JzZXJ2ZWQgZGF0YS4gV2Ugd2lsbCBub3QgZ28gaW50byBkZXRhaWwgYXMgdG8gaG93IHRoZXNlIHdvcmsgdW5kZXIgdGhlIGhvb2QsIGJ1dCBwcm92aWRlIGEgZmV3IGd1aWRlbGluZXMgZm9yIHRoZSBtb3N0IHBvcHVsYXIgbWV0aG9kcy4gT2Z0ZW4sIHRoZSB0b3AgKDEwLTUwKSBQQ3MgYXJlIHByb3ZpZGVkIGFzIGlucHV0LgoJCi0gdC1TTkU6IFByZXNlcnZpbmcgbG9jYWwgcmF0aGVyIHRoYW4gZ2xvYmFsIGRpc3RhbmNlcy4gVGhlcmVmb3JlLCBkaXN0YW5jZXMgb24gYSB0LVNORSByZWR1Y2VkIGRpbWVuc2lvbiBwbG90IGNhbiBvbmx5IGJlIGludGVycHJldGVkIGxvY2FsbHksIGkuZS4sIGNlbGxzIHRoYXQgYXJlIGNsb3NlIHRvZ2V0aGVyIGluIHJlZHVjZWQgZGltZW5zaW9uIHdpbGwgaGF2ZSBhIHNpbWlsYXIgdHJhbnNjcmlwdG9tZSwgYnV0IGNlbGxzIHRoYXQgYXJlIGZhciBhd2F5IG1heSBub3QgbmVjZXNzYXJpbHkgaGF2ZSBhIHZlcnkgZGlzdGluY3QgdHJhbnNjcmlwdG9tZS4KCi0gVU1BUDogQ2xhaW1lZCB0byBiZSBiZXR0ZXIgdGhhbiB0LVNORSBvbiBwcmVzZXJ2aW5nIGdsb2JhbCBkaWZmZXJlbmNlcy4gVGhlcmVmb3JlLCBVTUFQIGlzIGFsc28gb2Z0ZW4gdXNlZCBpbiBhbmFseXNlcyBzdWNoIGFzIHRyYWplY3RvcnkgaW5mZXJlbmNlLCB3aGVyZSB0aGlzIGlzIGltcG9ydGFudC4KCjxici8+CgojIyMjIEV4YW1wbGUgCgpgYGB7cn0Kc2NlIDwtIHJ1blRTTkUoc2NlLCBkaW1yZWQ9IlBDQSIpCnBsb3RUU05FKHNjZSkKYGBgCgo8YnIvPgoKYGBge3J9CiAgaWYoISJ1d290IiAlaW4lIGluc3RhbGxlZC5wYWNrYWdlcygpWywxXSkgQmlvY01hbmFnZXI6Omluc3RhbGwoInV3b3QiKQpzY2UgPC0gcnVuVU1BUChzY2UsIGRpbXJlZCA9ICdQQ0EnLCBleHRlcm5hbF9uZWlnaGJvcnM9VFJVRSkKcGxvdFVNQVAoc2NlKQpgYGAKCjxici8+PGJyLz4KCiMjIENsdXN0ZXJpbmc6IHVuc3VwZXJ2aXNlZCBjZWxsIHR5cGUgaWRlbnRpZmljYXRpb24KCi0gVGhlIGlkZW50aWZpY2F0aW9uIG9mIGhvbW9nZW5lb3VzLCBiaW9sb2dpY2FsbHkgcmVsZXZhbnQgZW50aXRpZXMgdGhhdCBkZWZpbmUgYSBjb21tb24gY2VsbCBpZGVudGl0eS4KCi0gVHJhZGl0aW9uYWwgY2x1c3RlcmluZyBtZXRob2RzIGRvIG5vdCBwZXJmb3JtIGdyZWF0LCBvZnRlbiBncmFwaC1iYXNlZCBjbHVzdGVyaW5nIG9yIAplbnNlbWJsZSBtZXRob2RzIGFyZSB1c2VkLgoKPGJyLz4KCiMjIyBDb25jZXJucwoKLSBUaGVyZSBhcmUgbWFueSByZXNvbHV0aW9ucyBhdCB3aGljaCB0aGlzIGNhbiBiZSBkb25lLCBhbmQgdGhlcmUgaXMgbm8gc3VjaCB0aGluZyBhcyAKCWFuIG9wdGltYWwgY2VsbCB0eXBlIHJlc29sdXRpb247IGNlbGxzIGNhbiBiZSBkZXNjcmliZWQgYnkgYSBoaWVyYXJjaHkgb2YgZGlmZmVyZW50IGNlbGwgdHlwZXMgYW5kIHN0YXRlcy4gTW9yZSBjbHVzdGVycyBtYXkgcmVzdWx0IGluIGhpZ2hlciByZXNvbHV0aW9uIGNlbGwgdHlwZXMsIGJ1dCAKCWNhbiBoYW1wZXIgcmVwbGljYWJpbGl0eSBvZiB0aGUgcmVzdWx0cyBhY3Jvc3MgZGF0YXNldHMuIAo8YnIvPjxici8+CgojIyAoU2VtaS0pc3VwZXJ2aXNlZCBjZWxsIHR5cGUgaWRlbnRpZmljYXRpb24gCgotIFdlIGNhbiB1c2UgcHJpb3Iga25vd2xlZGdlIHRvIHJlbGlhYmx5IGlkZW50aWZ5IGNlbGwgY2x1c3RlcnMgYW5kIGFubm90YXRlIHRoZW0uCgotIFdlIGNhbiBhbm5vdGF0ZSBhIG5ldyBzY1JOQS1zZXEgZGF0YXNldCBieSB0cmFpbmluZyBhIGNsYXNzaWZpZXIgdGhhdCBwcmVkaWN0cyBjZWxsIHR5cGUgbGFiZWwgYmFzZWQgb24gZXhpc3RpbmcgZGF0YS4KCiAgMS4gR2F0aGVyIHJlZmVyZW5jZSBkYXRhIHRoYXQgYXJlIHJlbGV2YW50IGZvciB5b3VyIGN1cnJlbnQgZGF0YXNldCB5b3Ugd291bGQgbGlrZSB0byBhbm5vdGF0ZS4KICAyLiBUcmFpbiBhIGNsYXNzaWZpZXIgKGxhc3NvL3JpZGdlLCBTVk0sIG5ldXJhbCBuZXQsIGtOTiwg4oCmKSB0byBjbGFzc2lmeSBjZWxscyBpbnRvIGNlbGwgdHlwZXMsIGdpdmVuIGdlbmUgZXhwcmVzc2lvbiBkYXRhLgogIDMuIFVzZSBwcmUtdHJhaW5lZCBjbGFzc2lmaWVyIHRvIGVzdGltYXRlLCBmb3IgZWFjaCBjZWxsLCAKCVAoY2VsbCBpIGlzIGNlbGwgdHlwZSBaIHwgZ2VuZSBleHByZXNzaW9uIG9mIGNlbGwgaSkuCgo8YnIvPgoKIyMjIENvbmNlcm5zCgpUaGUgcmVmZXJlbmNlIGRhdGEgdXNlZCBmb3IgdHJhaW5pbmcgdGhlIGNsYXNzaWZpZXIgbXVzdCBiZSByZXByZXNlbnRhdGl2ZSBmb3IgdGhlIGRhdGFzZXQgd2Ugd291bGQgbGlrZSB0byBhbm5vdGF0ZS4gUHJvYmxlbXMgbWF5IG9jY3VyIGlmIGUuZy4sIGRpZmZlcmVudCB0ZWNobm9sb2dpZXMgYXJlIHVzZWQsIG9yIHBhcnRpY3VsYXIgKHJhcmUpIGNlbGwgdHlwZXMgYXJlIG5vdCBwcmVzZW50IGluIHRoZSByZWZlcmVuY2UgZGF0YS4KCjxici8+PGJyLz4KCiMgRGlmZmVyZW50aWFsIGV4cHJlc3Npb24gKERFKSwgZGlzY292ZXJ5IG9mIG1hcmtlciBnZW5lcwoKLSBERSBpcyBvZnRlbiBhIGZpcnN0IHN0ZXAgdG93YXJkcyBpbnRlcnByZXRpbmcgZGlmZmVyZW5jZXMgYmV0d2VlbiBjZWxsIGdyb3VwcywgYW5kIHByb3ZpZGVzIAoJYSBiYXNpcyBmb3IgZnVydGhlciBiaW9sb2dpY2FsIHZhbGlkYXRpb24uCgotIERFIGFuYWx5c2lzIGluIHNjUk5BLXNlcSBpcyB0eXBpY2FsbHkgc2ltaWxhciB0byBidWxrIFJOQS1zZXEsIGUuZy4gZWRnZVIgYW5hbHlzaXMuIEluIGZhY3QsIGR1ZSB0byB0aGUgaGlnaCBudW1iZXIgb2YgY2VsbHMsIG9mdGVuIHNpbXBsZXIgbWV0aG9kcyBtYXkgYmUgdXNlZCwgZS5nLiBXaWxjb3hvbiB0ZXN0cy4KCjxici8+CgojIyBDb25jZXJucwoKLSBUaGVyZSBpcyBhbiBvbmdvaW5nIGRlYmF0ZSBpbiB0aGUgY29tbXVuaXR5IGFib3V0IHRoZSBhcHByb3ByaWF0ZSBub2lzZSBtb2RlbCBmb3Igc2NSTkEtc2VxIGRhdGEuIEZvciBleGFtcGxlLCBhcmUgdGhlIGRhdGEgemVybyBpbmZsYXRlZD8KCi0gUG9zdC1zZWxlY3Rpb24gaW5mZXJlbmNlIHByb2JsZW0sIHRoZSBkYXRhIGFyZSB1c2VkIHR3aWNlCiAgMS4gQ2x1c3RlcgogIDIuIEZpbmQgYmlvbWFya2VycyBiZXR3ZWVuIGNsdXN0ZXJzCiAgCi0gUHNldWRvLXJlcGxpY2F0aW9uIGluIG11bHRpLXN1YmplY3QtbXVsdGktY2VsbCBleHBlcmltZW50cyEgCgo8YnIvPgoKIyMgWmVyby1pbmZsYXRpb24gCgpgYGB7ciB6ZXJvSW5mbGF0aW9uMSwgb3V0LndpZHRoPSIxMDAlIn0Ka25pdHI6OmluY2x1ZGVfZ3JhcGhpY3MoIi4vaW1hZ2VzX3NlcXVlbmNpbmcvemVyb0luZmxhdGlvbi5wbmciKQpgYGAKCjxici8+PGJyLz4KCmBgYHtyIG91dC53aWR0aD0iNTAlIiwgZWNobz1GQUxTRSwgd2FybmluZz1GQUxTRSwgbWVzc2FnZT1GQUxTRX0KbGlicmFyeShNQVNTKQojIyMjIyBGVUxMLUxFTkdUSCBQUk9UT0NPTFMgIyMjIyMjCnNldC5zZWVkKDkpCiMjIHNpbXVsYXRlIE5CCng9cm5iaW5vbShuPTQwMCwgbXU9NDMwLCBzaXplPTQpCiMjIGVzdGltYXRlIE5CIHBhcmFtCm0gPC0gZ2xtLm5iKHh+MSkKaGlzdCh4LCBmcmVxPUZBTFNFLCBicmVha3M9NDAsIG1haW49Ik5CIERhdGEiKQpncmlkIDwtIHJvdW5kKHNlcSgwLG1heCh4KSxsZW5ndGg9NTAwKSkKbGluZXMoeD1ncmlkLCB5PWRuYmlub20oZ3JpZCwgbXU9ZXhwKGNvZWYobSkpLCBzaXplPW0kdGhldGEpLCBjb2w9InJlZCIsIGx3ZD0zKQoKIyMgYWRkIFpJIGFuZCByZS1lc3RpbWF0ZQp4WzE6MTVdPTAKbU5CIDwtIGdsbS5uYih4fjEpCmhpc3QoeCwgZnJlcT1GQUxTRSwgYnJlYWtzPTQwLCBtYWluPSJaSU5CIERhdGEiKQpsaW5lcyh4PWdyaWQsIHk9ZG5iaW5vbShncmlkLCBtdT1leHAoY29lZihtTkIpKSwgc2l6ZT1tTkIkdGhldGEpLCBjb2w9Im9yYW5nZSIsIGx3ZD0zKQoKIyMgWklOQiBlc3RpbWF0aW9uCncgPC0gYyhyZXAoMCwgMTUpLCByZXAoMSwgNDAwLTE1KSkKbVpJTkIgPC0gZ2xtLm5iKHh+MSwgd2VpZ2h0cz13KQpsaW5lcyh4PWdyaWQsIHk9ZG5iaW5vbShncmlkLCBtdT1leHAoY29lZihtWklOQikpLCBzaXplPW1aSU5CJHRoZXRhKSwgY29sPSJkYXJrc2VhZ3JlZW4zIiwgbHdkPTMpCmxpbmVzKHg9cmVwKDAsIDEwKSwgeT1zZXEoMCwgMC4wMDA1LCBsZW5ndGg9MTApLCBjb2w9ImRhcmtzZWFncmVlbjMiLCBsd2Q9MykKbGVnZW5kKCJ0b3ByaWdodCIsIGMoIk5CIiwgIlpJTkIiKSwgY29sPWMoIm9yYW5nZSIsICJkYXJrc2VhZ3JlZW4zIiksIGx0eT0xLCBsd2Q9MywgYnR5PSduJykKYGBgCgo8YnIvPgoKLSBNb3RpdmF0aW9uIGZvciB6ZXJvLWluZmxhdGlvbiBpcyB0aGF0IHdlIG1heSBjb25zaWRlciB0d28gdHlwZXMgb2YgemVyb3MgaW4gc2NSTkEtc2VxIGRhdGE6CgkKCS0gIEJpb2xvZ2ljYWwgemVyb3M6IFdlIG9ic2VydmUgYSB6ZXJvIGNvdW50IGJlY2F1c2UgdGhlIGdlbmUgaXMgbm90IGV4cHJlc3NlZCBpbiB0aGF0IGNlbGwuCgktIFRlY2huaWNhbCB6ZXJvczogRXZlbiB0aG91Z2ggdGhlIGdlbmUgd2FzIGV4cHJlc3NlZCBpbiB0aGF0IGNlbGwsIHdlIGRvIG5vdCBvYnNlcnZlIGFueSAKCQltb2xlY3VsZXMgZHVlIHRvIHRlY2huaWNhbCByZWFzb25zIChlLmcuLCBsb3cgY2FwdHVyZSBlZmZpY2llbmN5IC8gc2VxdWVuY2luZyBkZXB0aCkuCgotIEEgemVyby1pbmZsYXRlZCBjb3VudCBkaXN0cmlidXRpb24gaXMgYSBtaXh0dXJlIGRpc3RyaWJ1dGlvbiB0aGF0IGNvbnNpc3RzIG9mIGEgcG9pbnQgbWFzcyBhdCB6ZXJvIGFuZCBhIGNvdW50IGNvbXBvbmVudC4gRm9yIGV4YW1wbGUsIGEgemVyby1pbmZsYXRlZCBuZWdhdGl2ZSBiaW5vbWlhbCAoWklOQikgZGlzdHJpYnV0aW9uLgoKJCQgClxiZWdpbnthcnJheX17bGNsfQpZX3tpZ30gJiBcc2ltICYgWklOQihcbXVfe2lnfSwgXHBoaV9nLCBccGlfe2lnfSlcXFxcCmYoWV97aWd9KSAmPSYgXHBpX3tpZ30gXGRlbHRhXzAgKyAoMS1ccGlfe2lnfSkgZl97TkJ9KFxtdV97aWd9LFxwaV97aWd9KQpcZW5ke2FycmF5fQokJAoKT3VyIHRha2U6IAoKLSBEYXRhIGZyb20gZnVsbC1sZW5ndGggcHJvdG9jb2xzIGNvbnNpc3Qgb2YgaGlnaCBjb3VudHMgYW5kIG1hbnkgemVyb3MsIGFuZCBhcmUgbW9yZSBsaWtlbHkgdG8gYmUgemVybyBpbmZsYXRlZC4gCgotIEluc3RlYWQsIGRhdGEgZnJvbSBVTUkgZHJvcGxldC1iYXNlZCBwcm90b2NvbHMgY29uc2lzdCBvZiBsb3cgY291bnRzIHdpdGggbWFueXplcm9zLiBUaGlzIHNlZW1zIHRvIHJlYXNvbmFibHkgZml0IHVuZGVyIGEgbmVnYXRpdmUgYmlub21pYWwgZGlzdHJpYnV0aW9uLCBhbmQgemVybyBpbmZsYXRpb24gbWF5IG5vdCBiZSBuZWNlc3NhcnkuCgo8YnIvPgoKIyMgUHNldWRvLXJlcGxpY2F0aW9uIGluIG11bHRpLWNlbGwtbXVsdGktcGF0aWVudCBzY1JOQS1zZXEgZGF0YQoKLSBJbiBtdWx0aS1wYXRpZW50IGRhdGFzZXRzLCB3ZSBoYXZlIGEgaGllcmFyY2hpY2FsIGNvcnJlbGF0aW9uIHN0cnVjdHVyZS4KCi0gQ2VsbHMgYXJlIG5lc3RlZCB3aXRoaW4gcGF0aWVudCAkXHJpZ2h0YXJyb3ckIEV4cGVjdCBjb3JyZWxhdGlvbiBiZXR3ZWVuIGNlbGxzIGZyb20gdGhlIHNhbWUgcGF0aWVudC4KCmBgYHtyIHBzZXVkb3JlcGxpY2F0aW9uLCBmaWcuY2FwPSJJbWFnZSBjcmVkaXQgTWlsYW4gTWFsZmFpdCIsIGVjaG8gPSBGQUxTRSwgb3V0LndpZHRoPSIxMDAlIn0Ka25pdHI6OmluY2x1ZGVfZ3JhcGhpY3MoIi4vaW1hZ2VzX3NlcXVlbmNpbmcvbXVsdGktY2VsbC1tdWx0aS1wYXRpZW50LnBuZyIpCmBgYAoKPGJyLz4KCi0gV2hlbiBhc3Nlc3NpbmcgZGlmZmVyZW5jZXMgaW4gbWVhbnMgd2l0aGluIGNlbGwgdHlwZXMgYmV0d2VlbiBkaWZmZXJlbnQgdHJlYXRtZW50cywgd2UgY2FuIGJ1bGsgdGhlIGNlbGxzIG9mIHRoZSBzYW1lIGNlbGwgdHlwZXMgdG8gcGVyZm9ybSBwc2V1ZG9idWxrcyBwZXIgc3ViamVjdC4gCgotIFRoZXNlIHBzZXVkb2J1bGsgc2FtcGxlcyBjYW4gdGhhbiBiZSBhc3Nlc3NlZCB1c2luZyBjb252ZW50aW9uYWwgYnVsayBSTkEtc2VxIHRvb2xzLiAgCgoKCmBgYHtyIHBzZXVkb3JlcGxpY2F0aW9uMiwgZmlnLmNhcD0iQ3Jvd2VsbCBldCBhbC4gMjAyMCAoRE9JOiAxMC4xMDM4L3M0MTQ2Ny0wMjAtMTk4OTQtNCkiLCBlY2hvPUZBTFNFLCBvdXQud2lkdGg9IjgwJSIsIGZpZy5hbGlnbj0nY2VudGVyJ30Ka25pdHI6OmluY2x1ZGVfZ3JhcGhpY3MoIi4vaW1hZ2VzX3NlcXVlbmNpbmcvbXVzY2F0LnBuZyIpCmBgYAoKPGJyLz4KCmBgYHtyIHBzZXVkb1JlcGxpY2F0aW9uRlAsIGZpZy5jYXA9Ikp1bnRpbGxhIGV0IGFsLiAyMDIyIChET0kgMTAuMTA5My9iaWIvYmJhYzI4NikiLCBlY2hvPUZBTFNFLCBvdXQud2lkdGg9IjEwMCUifQprbml0cjo6aW5jbHVkZV9ncmFwaGljcygiLi9pbWFnZXNfc2VxdWVuY2luZy9wc2V1ZG9SZXBsaWNhdGlvbkZhbHNlUG9zaXRpdmVzLnBuZyIpCmBgYAoKPGJyLz4KCmBgYHtyIHBzZXVkb1JlcGxpY2F0aW9uQVVDLCBmaWcuY2FwPSJTcXVhaXIgZXQgYWwuIDIwMjEgKERPSSAxMC4xMDM4L3M0MTQ2Ny0wMjEtMjU5NjAtMikiLCBlY2hvPUZBTFNFLCBvdXQud2lkdGg9IjEwMCUifQprbml0cjo6aW5jbHVkZV9ncmFwaGljcygiLi9pbWFnZXNfc2VxdWVuY2luZy9wc2V1ZG9yZXBsaWNhdGlvbkNvbXBhcmlzb24ucG5nIikKYGBgCgo8YnIvPgoKLSBJbXBsZW1lbnRhdGlvbiBzZWUgW09TQ0EgQm9va10oaHR0cDovL2Jpb2NvbmR1Y3Rvci5vcmcvYm9va3MvMy4xNi9PU0NBLm11bHRpc2FtcGxlL211bHRpLXNhbXBsZS1jb21wYXJpc29ucy5odG1sI2NyZWF0aW5nLXBzZXVkby1idWxrLXNhbXBsZXMpCgo8YnIvPjxici8+CgojIyBEaWZmZXJlbnRpYWwgRGlzdHJpYnV0aW9ucwoKLSBBIGZldyBtZXRob2RzIGV4aXN0IHRoYXQgY29tcGFyZSBkaXN0cmlidXRpb25zIGJldHdlZW4gdHJlYXRtZW50cy4gCgotIEJ1dCwgdGhleSBkbyBub3QgYWxsb3cgdG8gaW50ZXJwcmV0IHRoZSBkaWZmZXJlbmNlIGluIHRoZSBkaXN0cmlidXRpb25zLgoKCiMgQWNrbm93bGVkZ2VtZW50cyB7LX0KClRoYW5rcyB0byBEYXZpZGUgUmlzc28gZm9yIHNoYXJpbmcgaGlzIG1hdGVyaWFscyBmcm9tIHRoZSBDU0FNQSAyMDIyIHdvcmtzaG9wLCB3aGljaCBJIHVzZWQgYXMgdGhlIHN0YXJ0aW5nIHBvaW50IGZvciB0aGUgUiBjb2RlIGluIHRoaXMgZG9jdW1lbnQu</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("sequencing_singleCell.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
